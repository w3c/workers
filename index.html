<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <title>Web Workers</title>
  <link href="https://www.w3.org/StyleSheets/TR/W3C-ED" rel="stylesheet" type="text/css">
<style data-fill-with="stylesheet">/******************************************************************************
 *                   Style sheet for the W3C specifications                   *
 *
 * Special classes handled by this style sheet include:
 *
 * Indices
 *   - .toc for the Table of Contents (<ol class="toc">)
 *     + <span class="secno"> for the section numbers
 *   - #toc for the Table of Contents (<nav id="toc">)
 *   - ul.index for Indices (<a href="#ref">term</a><span>, in §N.M</span>)
 *   - table.index for Index Tables (e.g. for properties or elements)
 *
 * Structural Markup
 *   - table.data for general data tables
 *     -> use 'scope' attribute, <colgroup>, <thead>, and <tbody> for best results !
 *     -> use <table class='complex data'> for extra-complex tables
 *     -> use <td class='long'> for paragraph-length cell content
 *     -> use <td class='pre'> when manual line breaks/indentation would help readability
 *   - dl.switch for switch statements
 *   - ol.algorithm for algorithms (helps to visualize nesting)
 *   - .figure and .caption (HTML4) and figure and figcaption (HTML5)
 *     -> .sidefigure for right-floated figures
 *   - ins/del
 *
 * Code
 *   - pre and code
 *
 * Special Sections
 *   - .note       for informative notes             (div, p, span, aside, details)
 *   - .example    for informative examples          (div, p, pre, span)
 *   - .issue      for issues                        (div, p, span)
 *   - .assertion  for assertions                    (div, p, span)
 *   - .advisement for loud normative statements     (div, p, strong)
 *   - .annoying-warning for spec obsoletion notices (div, aside, details)
 *
 * Definition Boxes
 *   - pre.def   for WebIDL definitions
 *   - table.def for tables that define other entities (e.g. CSS properties)
 *   - dl.def    for definition lists that define other entitles (e.g. HTML elements)
 *
 * Numbering
 *   - .secno for section numbers in .toc and headings (<span class='secno'>3.2</span>)
 *   - .marker for source-inserted example/figure/issue numbers (<span class='marker'>Issue 4</span>)
 *   - ::before styled for CSS-generated issue/example/figure numbers:
 *     -> Documents wishing to use this only need to add
 *        figcaption::before,
 *        .caption::before { content: "Figure "  counter(figure) " ";  }
 *        .example::before { content: "Example " counter(example) " "; }
 *        .issue::before   { content: "Issue "   counter(issue) " ";   }
 *
 * Header Stuff (ignore, just don't conflict with these classes)
 *   - .head for the header
 *   - .copyright for the copyright
 *
 * Miscellaneous
 *   - .overlarge for things that should be as wide as possible, even if
 *     that overflows the body text area. This can be used on an item or
 *     on its container, depending on the effect desired.
 *     Note that this styling basically doesn't help at all when printing,
 *     since A4 paper isn't much wider than the max-width here.
 *     It's better to design things to fit into a narrower measure if possible.
 *   - js-added ToC jump links (see fixup.js)
 *
 ******************************************************************************/

/******************************************************************************/
/*                                   Body                                     */
/******************************************************************************/

	body {
		counter-reset: example figure issue;

		/* Layout */
		max-width: 50em;               /* limit line length to 50em for readability   */
		margin: 0 auto;                /* center text within page                     */
		padding: 1.6em 1.5em 2em 50px; /* assume 16px font size for downlevel clients */
		padding: 1.6em 1.5em 2em calc(26px + 1.5em); /* leave space for status flag     */

		/* Typography */
		line-height: 1.5;
		font-family: sans-serif;
		widows: 2;
		orphans: 2;
		word-wrap: break-word;
		overflow-wrap: break-word;
		hyphens: auto;

		/* Colors */
		color: black;
		background: white top left fixed no-repeat;
		background-size: 25px auto;
	}


/******************************************************************************/
/*                         Front Matter & Navigation                          */
/******************************************************************************/

/** Header ********************************************************************/

	div.head { margin-bottom: 1em }
	div.head hr { border-style: solid; }

	div.head h1 {
		font-weight: bold;
		margin: 0 0 .1em;
		font-size: 220%;
	}

	div.head h2 { margin-bottom: 1.5em;}

/** W3C Logo ******************************************************************/

	.head .logo {
		float: right;
		margin: 0.4rem 0 0.2rem .4rem;
	}

	.head img[src*="logos/W3C"] {
		display: block;
		border: solid #1a5e9a;
		border-width: .65rem .7rem .6rem;
		border-radius: .4rem;
		background: #1a5e9a;
		color: white;
		font-weight: bold;
	}

	.head a:hover > img[src*="logos/W3C"],
	.head a:focus > img[src*="logos/W3C"] {
		opacity: .8;
	}

	.head a:active > img[src*="logos/W3C"] {
		background: #c00;
		border-color: #c00;
	}

	/* see also additional rules in Link Styling section */

/** Copyright *****************************************************************/

	p.copyright,
	p.copyright small { font-size: small }

/** Back to Top / ToC Toggle **************************************************/

	@media print {
		#toc-nav {
			display: none;
		}
	}
	@media not print {
		#toc-nav {
			position: fixed;
			z-index: 2;
			bottom: 0; left: 0;
			margin: 0;
			min-width: 1.33em;
			border-top-right-radius: 2rem;
			box-shadow: 0 0 2px;
			font-size: 1.5em;
			color: black;
		}
		#toc-nav > a {
			display: block;
			white-space: nowrap;

			height: 1.33em;
			padding: .1em 0.3em;
			margin: 0;

			background: white;
			box-shadow: 0 0 2px;
			border: none;
			border-top-right-radius: 1.33em;
			background: white;
		}
		#toc-nav > #toc-jump {
			padding-bottom: 2em;
			margin-bottom: -1.9em;
		}

		#toc-nav > a:hover,
		#toc-nav > a:focus {
			background: #f8f8f8;
		}
		#toc-nav > a:not(:hover):not(:focus) {
			color: #707070;
		}

		/* statusbar gets in the way on keyboard focus; remove once browsers fix */
		#toc-nav > a[href="#toc"]:not(:hover):focus:last-child {
			padding-bottom: 1.5rem;
		}

		#toc-nav:not(:hover) > a:not(:focus) > span + span {
			/* Ideally this uses :focus-within on #toc-nav */
			display: none;
		}
		#toc-nav > a > span + span {
			padding-right: 0.2em;
		}

		#toc-toggle-inline {
			vertical-align: 0.05em;
			font-size: 80%;
			color: gray;
			color: hsla(203,20%,40%,.7);
			border-style: none;
			background: transparent;
			position: relative;
		}
		#toc-toggle-inline:hover:not(:active),
		#toc-toggle-inline:focus:not(:active) {
			text-shadow: 1px 1px silver;
			top: -1px;
			left: -1px;
		}

		#toc-nav :active {
			color: #C00;
		}
	}

/** ToC Sidebar ***************************************************************/

	/* Floating sidebar */
	@media screen {
		body.toc-sidebar #toc {
			position: fixed;
			top: 0; bottom: 0;
			left: 0;
			width: 23.5em;
			max-width: 80%;
			max-width: calc(100% - 2em - 26px);
			overflow: auto;
			padding: 0 1em;
			padding-left: 42px;
			padding-left: calc(1em + 26px);
			background: inherit;
			background-color: #f7f8f9;
			z-index: 1;
			box-shadow: -.1em 0 .25em rgba(0,0,0,.1) inset;
		}
		body.toc-sidebar #toc h2 {
			margin-top: .8rem;
			font-variant: small-caps;
			font-variant: all-small-caps;
			text-transform: lowercase;
			font-weight: bold;
			color: gray;
			color: hsla(203,20%,40%,.7);
		}
		body.toc-sidebar #toc-jump:not(:focus) {
			width: 0;
			height: 0;
			padding: 0;
			position: absolute;
			overflow: hidden;
		}
	}
	/* Hide main scroller when only the ToC is visible anyway */
	@media screen and (max-width: 28em) {
		body.toc-sidebar {
			overflow: hidden;
		}
	}

	/* Sidebar with its own space */
	@media screen and (min-width: 78em) {
		body:not(.toc-inline) #toc {
			position: fixed;
			top: 0; bottom: 0;
			left: 0;
			width: 23.5em;
			overflow: auto;
			padding: 0 1em;
			padding-left: 42px;
			padding-left: calc(1em + 26px);
			background: inherit;
			background-color: #f7f8f9;
			z-index: 1;
			box-shadow: -.1em 0 .25em rgba(0,0,0,.1) inset;
		}
		body:not(.toc-inline) #toc h2 {
			margin-top: .8rem;
			font-variant: small-caps;
			font-variant: all-small-caps;
			text-transform: lowercase;
			font-weight: bold;
			color: gray;
			color: hsla(203,20%,40%,.7);
		}

		body:not(.toc-inline) {
			padding-left: 29em;
		}
		/* See also Overflow section at the bottom */

		body:not(.toc-inline) #toc-jump:not(:focus) {
			width: 0;
			height: 0;
			padding: 0;
			position: absolute;
			overflow: hidden;
		}
	}
	@media screen and (min-width: 90em) {
		body:not(.toc-inline) {
			margin: 0 4em;
		}
	}

/******************************************************************************/
/*                                Sectioning                                  */
/******************************************************************************/

/** Headings ******************************************************************/

	h1, h2, h3, h4, h5, h6, dt {
		page-break-after: avoid;
		page-break-inside: avoid;
		font: 100% sans-serif;   /* Reset all font styling to clear out UA styles */
		font-family: inherit;    /* Inherit the font family. */
		line-height: 1.2;        /* Keep wrapped headings compact */
		hyphens: manual;         /* Hyphenated headings look weird */
	}

	h2, h3, h4, h5, h6 {
		margin-top: 3rem;
	}

	h1, h2, h3 {
		color: #005A9C;
		background: transparent;
	}

	h1 { font-size: 170%; }
	h2 { font-size: 140%; }
	h3 { font-size: 120%; }
	h4 { font-weight: bold; }
	h5 { font-style: italic; }
	h6 { font-variant: small-caps; }
	dt { font-weight: bold; }

/** Subheadings ***************************************************************/

	h1 + h2,
	#subtitle {
		/* #subtitle is a subtitle in an H2 under the H1 */
		margin-top: 0;
	}
	h2 + h3,
	h3 + h4,
	h4 + h5,
	h5 + h6 {
		margin-top: 1.2em; /* = 1 x line-height */
	}

/** Section divider ***********************************************************/

	:not(.head) > hr {
		font-size: 1.5em;
		text-align: center;
		margin: 1em auto;
		height: auto;
		border: transparent solid 0;
		background: transparent;
	}
	:not(.head) > hr::before {
		content: "\2727\2003\2003\2727\2003\2003\2727";
	}

/******************************************************************************/
/*                            Paragraphs and Lists                            */
/******************************************************************************/

	p {
		margin: 1em 0;
	}

	dd > p:first-child,
	li > p:first-child {
		margin-top: 0;
	}

	ul, ol {
		margin-left: 0;
		padding-left: 2em;
	}

	li {
		margin: 0.25em 0 0.5em;
		padding: 0;
	}

	dl dd {
		margin: 0 0 .5em 2em;
	}

	.head dd + dd { /* compact for header */
		margin-top: -.5em;
	}

	/* Style for algorithms */
	ol.algorithm ol:not(.algorithm),
	.algorithm > ol ol:not(.algorithm) {
	 border-left: 0.5em solid #DEF;
	}

	/* Put nice boxes around each algorithm. */
	[data-algorithm]:not(.heading) {
	  padding: .5em;
	  border: thin solid #ddd; border-radius: .5em;
	  margin: .5em 0;
	}
	[data-algorithm]:not(.heading) > :first-child {
	  margin-top: 0;
	}
	[data-algorithm]:not(.heading) > :last-child {
	  margin-bottom: 0;
	}

	/* Style for switch/case <dl>s */
	dl.switch > dd > ol.only,
	dl.switch > dd > .only > ol {
	 margin-left: 0;
	}
	dl.switch > dd > ol.algorithm,
	dl.switch > dd > .algorithm > ol {
	 margin-left: -2em;
	}
	dl.switch {
	 padding-left: 2em;
	}
	dl.switch > dt {
	 text-indent: -1.5em;
	 margin-top: 1em;
	}
	dl.switch > dt + dt {
	 margin-top: 0;
	}
	dl.switch > dt::before {
	 content: '\21AA';
	 padding: 0 0.5em 0 0;
	 display: inline-block;
	 width: 1em;
	 text-align: right;
	 line-height: 0.5em;
	}

/** Terminology Markup ********************************************************/


/******************************************************************************/
/*                                 Inline Markup                              */
/******************************************************************************/

/** Terminology Markup ********************************************************/
	dfn   { /* Defining instance */
		font-weight: bolder;
	}
	a > i { /* Instance of term */
		font-style: normal;
	}
	dt dfn code, code.idl {
		font-size: normal;
	}
	dfn var {
		font-style: normal;
	}

/** Change Marking ************************************************************/

	del { color: red;  text-decoration: line-through; }
	ins { color: #080; text-decoration: underline;    }

/** Miscellaneous improvements to inline formatting ***************************/

	sup {
		vertical-align: super;
		font-size: 80%
	}

/******************************************************************************/
/*                                    Code                                    */
/******************************************************************************/

/** General monospace/pre rules ***********************************************/

	pre, code, samp {
		font-family: Menlo, Consolas, "DejaVu Sans Mono", Monaco, monospace;
		font-size: .9em;
		page-break-inside: avoid;
		hyphens: none;
		text-transform: none;
	}
	pre code,
	code code {
		font-size: 100%;
	}

	pre {
		margin-top: 1em;
		margin-bottom: 1em;
		overflow: auto;
	}

/** Inline Code fragments *****************************************************/

  /* Do something nice. */

/******************************************************************************/
/*                                    Links                                   */
/******************************************************************************/

/** General Hyperlinks ********************************************************/

	/* We hyperlink a lot, so make it less intrusive */
	a[href] {
		color: #034575;
		text-decoration: none;
		border-bottom: 1px solid #707070;
		/* Need a bit of extending for it to look okay */
		padding: 0 1px 0;
		margin: 0 -1px 0;
	}
	a:visited {
		border-bottom-color: #BBB;
	}

	/* Use distinguishing colors when user is interacting with the link */
	a[href]:focus,
	a[href]:hover {
		background: #f8f8f8;
		background: rgba(75%, 75%, 75%, .25);
		border-bottom-width: 3px;
		margin-bottom: -2px;
	}
	a[href]:active {
		color: #C00;
		border-color: #C00;
	}

	/* Backout above styling for W3C logo */
	.head .logo,
	.head .logo a {
		border: none;
		text-decoration: none;
		background: transparent;
	}

/******************************************************************************/
/*                                    Images                                  */
/******************************************************************************/

	img {
		border-style: none;
	}

	/* For autogen numbers, add
	   .caption::before, figcaption::before { content: "Figure " counter(figure) ". "; }
	*/

	figure, .figure, .sidefigure {
		page-break-inside: avoid;
		text-align: center;
		margin: 2.5em 0;
	}
	.figure img,    .sidefigure img,    figure img,
	.figure object, .sidefigure object, figure object {
		max-width: 100%;
		margin: auto;
	}
	.figure pre, .sidefigure pre, figure pre {
		text-align: left;
		display: table;
		margin: 1em auto;
	}
	.figure table, figure table {
		margin: auto;
	}
	@media screen and (min-width: 20em) {
		.sidefigure {
			float: right;
			width: 50%;
			margin: 0 0 0.5em 0.5em
		}
	}
	.caption, figcaption, caption {
		font-style: italic;
		font-size: 90%;
	}
	.caption::before, figcaption::before, figcaption > .marker {
		font-weight: bold;
	}
	.caption, figcaption {
		counter-increment: figure;
	}

	/* DL list is indented 2em, but figure inside it is not */
	dd > .figure, dd > figure { margin-left: -2em }

/******************************************************************************/
/*                             Colored Boxes                                  */
/******************************************************************************/

	.issue, .note, .example, .assertion, .advisement, blockquote {
		padding: .5em;
		border: .5em;
		border-left-style: solid;
		page-break-inside: avoid;
	}
	span.issue, span.note {
		padding: .1em .5em .15em;
		border-right-style: solid;
	}

	.issue,
	.note,
	.example,
	.advisement,
	.assertion,
	blockquote {
		margin: 1em auto;
	}
	.note  > p:first-child,
	.issue > p:first-child,
	blockquote > :first-child {
		margin-top: 0;
	}
	blockquote > :last-child {
		margin-bottom: 0;
	}

/** Blockquotes ***************************************************************/

	blockquote {
		border-color: silver;
	}

/** Open issue ****************************************************************/

	.issue {
		border-color: #E05252;
		background: #FBE9E9;
		counter-increment: issue;
		overflow: auto;
	}
	.issue::before, .issue > .marker {
		text-transform: uppercase;
		color: #AE1E1E;
		padding-right: 1em;
		text-transform: uppercase;
	}
	/* Add .issue::before { content: "Issue " counter(issue) " "; } for autogen numbers,
	   or use class="marker" to mark up the issue number in source. */

/** Example *******************************************************************/

	.example {
		border-color: #E0CB52;
		background: #FCFAEE;
		counter-increment: example;
		overflow: auto;
		clear: both;
	}
	.example::before, .example > .marker {
		text-transform: uppercase;
		color: #827017;
		min-width: 7.5em;
		display: block;
	}
	/* Add .example::before { content: "Example " counter(example) " "; } for autogen numbers,
	   or use class="marker" to mark up the example number in source. */

/** Non-normative Note ********************************************************/

	.note {
		border-color: #52E052;
		background: #E9FBE9;
		overflow: auto;
	}

	.note::before, .note > .marker,
	details.note > summary::before,
	details.note > summary > .marker {
		text-transform: uppercase;
		display: block;
		color: hsl(120, 70%, 30%);
	}
	/* Add .note::before { content: "Note"; } for autogen label,
	   or use class="marker" to mark up the label in source. */

	details.note > summary {
		display: block;
		color: hsl(120, 70%, 30%);
	}
	details.note[open] > summary {
		border-bottom: 1px silver solid;
	}

/** Assertion Box *************************************************************/
	/*  for assertions in algorithms */

	.assertion {
		border-color: #AAA;
		background: #EEE;
	}

/** Advisement Box ************************************************************/
	/*  for attention-grabbing normative statements */

	.advisement {
		border-color: orange;
		border-style: none solid;
		background: #FFEECC;
	}
	strong.advisement {
		display: block;
		text-align: center;
	}
	.advisement > .marker {
		color: #B35F00;
	}

/** Spec Obsoletion Notice ****************************************************/
	/* obnoxious obsoletion notice for older/abandoned specs. */

	details {
		display: block;
	}
	summary {
		font-weight: bolder;
	}

	.annoying-warning:not(details),
	details.annoying-warning:not([open]) > summary,
	details.annoying-warning[open] {
		background: #fdd;
		color: red;
		font-weight: bold;
		padding: .75em 1em;
		border: thick red;
		border-style: solid;
		border-radius: 1em;
	}
	.annoying-warning :last-child {
		margin-bottom: 0;
	}

@media not print {
	details.annoying-warning[open] {
		position: fixed;
		left: 1em;
		right: 1em;
		bottom: 1em;
		z-index: 1000;
	}
}

	details.annoying-warning:not([open]) > summary {
		text-align: center;
	}

/** Entity Definition Boxes ***************************************************/

	.def {
		padding: .5em 1em;
		background: #DEF;
		margin: 1.2em 0;
		border-left: 0.5em solid #8CCBF2;
	}

/******************************************************************************/
/*                                    Tables                                  */
/******************************************************************************/

	th, td {
		text-align: left;
		text-align: start;
	}

/** Property/Descriptor Definition Tables *************************************/

	table.def {
		/* inherits .def box styling, see above */
		width: 100%;
		border-spacing: 0;
	}

	table.def td,
	table.def th {
		padding: 0.5em;
		vertical-align: baseline;
		border-bottom: 1px solid #bbd7e9;
	}

	table.def > tbody > tr:last-child th,
	table.def > tbody > tr:last-child td {
		border-bottom: 0;
	}

	table.def th {
		font-style: italic;
		font-weight: normal;
		padding-left: 1em;
		width: 3em;
	}

	/* For when values are extra-complex and need formatting for readability */
	table td.pre {
		white-space: pre-wrap;
	}

	/* A footnote at the bottom of a def table */
	table.def           td.footnote {
		padding-top: 0.6em;
	}
	table.def           td.footnote::before {
		content: " ";
		display: block;
		height: 0.6em;
		width: 4em;
		border-top: thin solid;
	}

/** Data tables (and properly marked-up index tables) *************************/
	/*
		 <table class="data"> highlights structural relationships in a table
		 when correct markup is used (e.g. thead/tbody, th vs. td, scope attribute)

		 Use class="complex data" for particularly complicated tables --
		 (This will draw more lines: busier, but clearer.)

		 Use class="long" on table cells with paragraph-like contents
		 (This will adjust text alignment accordingly.)
		 Alternately use class="longlastcol" on tables, to have the last column assume "long".
	*/

	table {
		word-wrap: normal;
		overflow-wrap: normal;
		hyphens: manual;
	}

	table.data,
	table.index {
		margin: 1em auto;
		border-collapse: collapse;
		border: hidden;
		width: 100%;
	}
	table.data caption,
	table.index caption {
		max-width: 50em;
		margin: 0 auto 1em;
	}

	table.data td,  table.data th,
	table.index td, table.index th {
		padding: 0.5em 1em;
		border-width: 1px;
		border-color: silver;
		border-top-style: solid;
	}

	table.data thead td:empty {
		padding: 0;
		border: 0;
	}

	table.data  thead,
	table.index thead,
	table.data  tbody,
	table.index tbody {
		border-bottom: 2px solid;
	}

	table.data colgroup,
	table.index colgroup {
		border-left: 2px solid;
	}

	table.data  tbody th:first-child,
	table.index tbody th:first-child  {
		border-right: 2px solid;
		border-top: 1px solid silver;
		padding-right: 1em;
	}

	table.data th[colspan],
	table.data td[colspan] {
		text-align: center;
	}

	table.complex.data th,
	table.complex.data td {
		border: 1px solid silver;
		text-align: center;
	}

	table.data.longlastcol td:last-child,
	table.data td.long {
	 vertical-align: baseline;
	 text-align: left;
	}

	table.data img {
		vertical-align: middle;
	}


/*
Alternate table alignment rules

	table.data,
	table.index {
		text-align: center;
	}

	table.data  thead th[scope="row"],
	table.index thead th[scope="row"] {
		text-align: right;
	}

	table.data  tbody th:first-child,
	table.index tbody th:first-child  {
		text-align: right;
	}

Possible extra rowspan handling

	table.data  tbody th[rowspan]:not([rowspan='1']),
	table.index tbody th[rowspan]:not([rowspan='1']),
	table.data  tbody td[rowspan]:not([rowspan='1']),
	table.index tbody td[rowspan]:not([rowspan='1']) {
		border-left: 1px solid silver;
	}

	table.data  tbody th[rowspan]:first-child,
	table.index tbody th[rowspan]:first-child,
	table.data  tbody td[rowspan]:first-child,
	table.index tbody td[rowspan]:first-child{
		border-left: 0;
		border-right: 1px solid silver;
	}
*/

/******************************************************************************/
/*                                  Indices                                   */
/******************************************************************************/


/** Table of Contents *********************************************************/

	.toc a {
		/* More spacing; use padding to make it part of the click target. */
		padding-top: 0.1rem;
		/* Larger, more consistently-sized click target */
		display: block;
		/* Reverse color scheme */
		color: black;
		border-color: #3980B5;
	}
	.toc a:visited {
		border-color: #054572;
	}
	.toc a:not(:focus):not(:hover) {
		/* Allow colors to cascade through from link styling */
		border-bottom-color: transparent;
	}

	.toc, .toc ol, .toc ul, .toc li {
		list-style: none; /* Numbers must be inlined into source */
		/* because generated content isn't search/selectable and markers can't do multilevel yet */
		margin:  0;
		padding: 0;
		line-height: 1.1rem; /* consistent spacing */
	}

	/* ToC not indented until third level, but font style & margins show hierarchy */
	.toc > li             { font-weight: bold;   }
	.toc > li li          { font-weight: normal; }
	.toc > li li li       { font-size:   95%;    }
	.toc > li li li li    { font-size:   90%;    }
	.toc > li li li li li { font-size:   85%;    }

	.toc > li             { margin: 1.5rem 0;    }
	.toc > li li          { margin: 0.3rem 0;    }
	.toc > li li li       { margin-left: 2rem;   }

	/* Section numbers in a column of their own */
	.toc .secno {
		float: left;
		width: 4rem;
		white-space: nowrap;
	}
	.toc > li li li li .secno {
		font-size: 85%;
	}
	.toc > li li li li li .secno {
		font-size: 100%;
	}

	:not(li) > .toc              { margin-left:  5rem; }
	.toc .secno                  { margin-left: -5rem; }
	.toc > li li li .secno       { margin-left: -7rem; }
	.toc > li li li li .secno    { margin-left: -9rem; }
	.toc > li li li li li .secno { margin-left: -11rem; }

	/* Tighten up indentation in narrow ToCs */
	@media (max-width: 30em) {
		:not(li) > .toc              { margin-left:  4rem; }
		.toc .secno                  { margin-left: -4rem; }
		.toc > li li li              { margin-left:  1rem; }
		.toc > li li li .secno       { margin-left: -5rem; }
		.toc > li li li li .secno    { margin-left: -6rem; }
		.toc > li li li li li .secno { margin-left: -7rem; }
	}
	@media screen and (min-width: 78em) {
		body:not(.toc-inline) :not(li) > .toc              { margin-left:  4rem; }
		body:not(.toc-inline) .toc .secno                  { margin-left: -4rem; }
		body:not(.toc-inline) .toc > li li li              { margin-left:  1rem; }
		body:not(.toc-inline) .toc > li li li .secno       { margin-left: -5rem; }
		body:not(.toc-inline) .toc > li li li li .secno    { margin-left: -6rem; }
		body:not(.toc-inline) .toc > li li li li li .secno { margin-left: -7rem; }
	}
	body.toc-sidebar #toc :not(li) > .toc              { margin-left:  4rem; }
	body.toc-sidebar #toc .toc .secno                  { margin-left: -4rem; }
	body.toc-sidebar #toc .toc > li li li              { margin-left:  1rem; }
	body.toc-sidebar #toc .toc > li li li .secno       { margin-left: -5rem; }
	body.toc-sidebar #toc .toc > li li li li .secno    { margin-left: -6rem; }
	body.toc-sidebar #toc .toc > li li li li li .secno { margin-left: -7rem; }

	.toc li {
		clear: both;
	}


/** Index *********************************************************************/

	/* Index Lists: Layout */
	ul.index       { margin-left: 0; columns: 15em; text-indent: 1em hanging; }
	ul.index li    { margin-left: 0; list-style: none; break-inside: avoid; }
	ul.index li li { margin-left: 1em }
	ul.index dl    { margin-top: 0; }
	ul.index dt    { margin: .2em 0 .2em 20px;}
	ul.index dd    { margin: .2em 0 .2em 40px;}
	/* Index Lists: Typography */
	ul.index ul,
	ul.index dl { font-size: smaller; }
	@media not print {
		ul.index li span {
			white-space: nowrap;
			color: transparent; }
		ul.index li a:hover + span,
		ul.index li a:focus + span {
			color: #707070;
		}
	}

/** Index Tables *****************************************************/
	/* See also the data table styling section, which this effectively subclasses */

	table.index {
		font-size: small;
		border-collapse: collapse;
		border-spacing: 0;
		text-align: left;
		margin: 1em 0;
	}

	table.index td,
	table.index th {
		padding: 0.4em;
	}

	table.index tr:hover td:not([rowspan]),
	table.index tr:hover th:not([rowspan]) {
		background: #f7f8f9;
	}

	/* The link in the first column in the property table (formerly a TD) */
	table.index th:first-child a {
		font-weight: bold;
	}

/******************************************************************************/
/*                                    Print                                   */
/******************************************************************************/

	@media print {
		/* Pages have their own margins. */
		html {
			margin: 0;
		}
		/* Serif for print. */
		body {
			font-family: serif;
		}
	}
	@page {
		margin: 1.5cm 1.1cm;
	}

/******************************************************************************/
/*                                    Legacy                                  */
/******************************************************************************/

	/* This rule is inherited from past style sheets. No idea what it's for. */
	.hide { display: none }



/******************************************************************************/
/*                             Overflow Control                               */
/******************************************************************************/

	.figure .caption, .sidefigure .caption, figcaption {
		/* in case figure is overlarge, limit caption to 50em */
		max-width: 50rem;
		margin-left: auto;
		margin-right: auto;
	}
	.overlarge > table {
		/* limit preferred width of table */
		max-width: 50em;
		margin-left: auto;
		margin-right: auto;
	}

	@media (min-width: 55em) {
		.overlarge {
			margin-left: calc(13px + 26.5rem - 50vw);
			margin-right: calc(13px + 26.5rem - 50vw);
			max-width: none;
		}
	}
	@media screen and (min-width: 78em) {
		body:not(.toc-inline) .overlarge {
			/* 30.5em body padding 50em content area */
			margin-left: calc(40em - 50vw) !important;
			margin-right: calc(40em - 50vw) !important;
		}
	}
	@media screen and (min-width: 90em) {
		body:not(.toc-inline) .overlarge {
			/* 4em html margin 30.5em body padding 50em content area */
			margin-left: 0 !important;
			margin-right: calc(84.5em - 100vw) !important;
		}
	}

	@media not print {
		.overlarge {
			overflow-x: auto;
			/* See Lea Verou's explanation background-attachment:
			 * http://lea.verou.me/2012/04/background-attachment-local/
			 *
			background: top left  / 4em 100% linear-gradient(to right,  #ffffff, rgba(255, 255, 255, 0)) local,
			            top right / 4em 100% linear-gradient(to left, #ffffff, rgba(255, 255, 255, 0)) local,
			            top left  / 1em 100% linear-gradient(to right,  #c3c3c5, rgba(195, 195, 197, 0)) scroll,
			            top right / 1em 100% linear-gradient(to left, #c3c3c5, rgba(195, 195, 197, 0)) scroll,
			            white;
			background-repeat: no-repeat;
			*/
		}
	}
</style>
  <meta content="Bikeshed 1.0.0" name="generator">
<style>/* style-md-lists */

            /* This is a weird hack for me not yet following the commonmark spec
               regarding paragraph and lists. */
            [data-md] > :first-child {
                margin-top: 0;
            }
            [data-md] > :last-child {
                margin-bottom: 0;
            }</style>
<style>/* style-selflinks */

            .heading, .issue, .note, .example, li, dt {
                position: relative;
            }
            a.self-link {
                position: absolute;
                top: 0;
                left: calc(-1 * (3.5rem - 26px));
                width: calc(3.5rem - 26px);
                height: 2em;
                text-align: center;
                border: none;
                transition: opacity .2s;
                opacity: .5;
            }
            a.self-link:hover {
                opacity: 1;
            }
            .heading > a.self-link {
                font-size: 83%;
            }
            li > a.self-link {
                left: calc(-1 * (3.5rem - 26px) - 2em);
            }
            dfn > a.self-link {
                top: auto;
                left: auto;
                opacity: 0;
                width: 1.5em;
                height: 1.5em;
                background: gray;
                color: white;
                font-style: normal;
                transition: opacity .2s, background-color .2s, color .2s;
            }
            dfn:hover > a.self-link {
                opacity: 1;
            }
            dfn > a.self-link:hover {
                color: black;
            }

            a.self-link::before            { content: "¶"; }
            .heading > a.self-link::before { content: "§"; }
            dfn > a.self-link::before      { content: "#"; }</style>
<style>/* style-counters */

            body {
                counter-reset: example figure issue;
            }
            .issue {
                counter-increment: issue;
            }
            .issue:not(.no-marker)::before {
                content: "Issue " counter(issue);
            }

            .example {
                counter-increment: example;
            }
            .example:not(.no-marker)::before {
                content: "Example " counter(example);
            }
            .invalid.example:not(.no-marker)::before,
            .illegal.example:not(.no-marker)::before {
                content: "Invalid Example" counter(example);
            }

            figcaption {
                counter-increment: figure;
            }
            figcaption:not(.no-marker)::before {
                content: "Figure " counter(figure) " ";
            }</style>
<style>/* style-autolinks */

            .css.css, .property.property, .descriptor.descriptor {
                color: #005a9c;
                font-size: inherit;
                font-family: inherit;
            }
            .css::before, .property::before, .descriptor::before {
                content: "‘";
            }
            .css::after, .property::after, .descriptor::after {
                content: "’";
            }
            .property, .descriptor {
                /* Don't wrap property and descriptor names */
                white-space: nowrap;
            }
            .type { /* CSS value <type> */
                font-style: italic;
            }
            pre .property::before, pre .property::after {
                content: "";
            }
            [data-link-type="property"]::before,
            [data-link-type="propdesc"]::before,
            [data-link-type="descriptor"]::before,
            [data-link-type="value"]::before,
            [data-link-type="function"]::before,
            [data-link-type="at-rule"]::before,
            [data-link-type="selector"]::before,
            [data-link-type="maybe"]::before {
                content: "‘";
            }
            [data-link-type="property"]::after,
            [data-link-type="propdesc"]::after,
            [data-link-type="descriptor"]::after,
            [data-link-type="value"]::after,
            [data-link-type="function"]::after,
            [data-link-type="at-rule"]::after,
            [data-link-type="selector"]::after,
            [data-link-type="maybe"]::after {
                content: "’";
            }

            [data-link-type].production::before,
            [data-link-type].production::after,
            .prod [data-link-type]::before,
            .prod [data-link-type]::after {
                content: "";
            }

            [data-link-type=element],
            [data-link-type=element-attr] {
                font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
                font-size: .9em;
            }
            [data-link-type=element]::before { content: "<" }
            [data-link-type=element]::after  { content: ">" }

            [data-link-type=biblio] {
                white-space: pre;
            }</style>
<style>/* style-dfn-panel */

        .dfn-panel {
            position: absolute;
            z-index: 35;
            height: auto;
            width: -webkit-fit-content;
            width: fit-content;
            max-width: 300px;
            max-height: 500px;
            overflow: auto;
            padding: 0.5em 0.75em;
            font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
            background: #DDDDDD;
            color: black;
            border: outset 0.2em;
        }
        .dfn-panel:not(.on) { display: none; }
        .dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
        .dfn-panel > b { display: block; }
        .dfn-panel a { color: black; }
        .dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
        .dfn-panel > b + b { margin-top: 0.25em; }
        .dfn-panel ul { padding: 0; }
        .dfn-panel li { list-style: inside; }
        .dfn-panel.activated {
            display: inline-block;
            position: fixed;
            left: .5em;
            bottom: 2em;
            margin: 0 auto;
            max-width: calc(100vw - 1.5em - .4em - .5em);
            max-height: 30vh;
        }

        .dfn-paneled { cursor: pointer; }
        </style>
<style>/* style-syntax-highlighting */
pre.idl.highlight { color: #708090; }
        .highlight:not(.idl) { background: hsl(24, 20%, 95%); }
        code.highlight { padding: .1em; border-radius: .3em; }
        pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }
        .highlight .c { color: #708090 } /* Comment */
        .highlight .k { color: #990055 } /* Keyword */
        .highlight .l { color: #000000 } /* Literal */
        .highlight .n { color: #0077aa } /* Name */
        .highlight .o { color: #999999 } /* Operator */
        .highlight .p { color: #999999 } /* Punctuation */
        .highlight .cm { color: #708090 } /* Comment.Multiline */
        .highlight .cp { color: #708090 } /* Comment.Preproc */
        .highlight .c1 { color: #708090 } /* Comment.Single */
        .highlight .cs { color: #708090 } /* Comment.Special */
        .highlight .kc { color: #990055 } /* Keyword.Constant */
        .highlight .kd { color: #990055 } /* Keyword.Declaration */
        .highlight .kn { color: #990055 } /* Keyword.Namespace */
        .highlight .kp { color: #990055 } /* Keyword.Pseudo */
        .highlight .kr { color: #990055 } /* Keyword.Reserved */
        .highlight .kt { color: #990055 } /* Keyword.Type */
        .highlight .ld { color: #000000 } /* Literal.Date */
        .highlight .m { color: #000000 } /* Literal.Number */
        .highlight .s { color: #a67f59 } /* Literal.String */
        .highlight .na { color: #0077aa } /* Name.Attribute */
        .highlight .nc { color: #0077aa } /* Name.Class */
        .highlight .no { color: #0077aa } /* Name.Constant */
        .highlight .nd { color: #0077aa } /* Name.Decorator */
        .highlight .ni { color: #0077aa } /* Name.Entity */
        .highlight .ne { color: #0077aa } /* Name.Exception */
        .highlight .nf { color: #0077aa } /* Name.Function */
        .highlight .nl { color: #0077aa } /* Name.Label */
        .highlight .nn { color: #0077aa } /* Name.Namespace */
        .highlight .py { color: #0077aa } /* Name.Property */
        .highlight .nt { color: #669900 } /* Name.Tag */
        .highlight .nv { color: #222222 } /* Name.Variable */
        .highlight .ow { color: #999999 } /* Operator.Word */
        .highlight .mb { color: #000000 } /* Literal.Number.Bin */
        .highlight .mf { color: #000000 } /* Literal.Number.Float */
        .highlight .mh { color: #000000 } /* Literal.Number.Hex */
        .highlight .mi { color: #000000 } /* Literal.Number.Integer */
        .highlight .mo { color: #000000 } /* Literal.Number.Oct */
        .highlight .sb { color: #a67f59 } /* Literal.String.Backtick */
        .highlight .sc { color: #a67f59 } /* Literal.String.Char */
        .highlight .sd { color: #a67f59 } /* Literal.String.Doc */
        .highlight .s2 { color: #a67f59 } /* Literal.String.Double */
        .highlight .se { color: #a67f59 } /* Literal.String.Escape */
        .highlight .sh { color: #a67f59 } /* Literal.String.Heredoc */
        .highlight .si { color: #a67f59 } /* Literal.String.Interpol */
        .highlight .sx { color: #a67f59 } /* Literal.String.Other */
        .highlight .sr { color: #a67f59 } /* Literal.String.Regex */
        .highlight .s1 { color: #a67f59 } /* Literal.String.Single */
        .highlight .ss { color: #a67f59 } /* Literal.String.Symbol */
        .highlight .vc { color: #0077aa } /* Name.Variable.Class */
        .highlight .vg { color: #0077aa } /* Name.Variable.Global */
        .highlight .vi { color: #0077aa } /* Name.Variable.Instance */
        .highlight .il { color: #000000 } /* Literal.Number.Integer.Long */
        </style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="http://www.w3.org/"> <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2016/logos/W3C" width="72"> </a> </p>
   <h1 class="p-name no-ref" id="title">Web Workers</h1>
   <h2 class="no-num no-toc no-ref heading settled" id="subtitle"><span class="content">Editor’s Draft, <time class="dt-updated" datetime="2016-09-27">27 September 2016</time></span></h2>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>This version:
     <dd><a class="u-url" href="https://w3c.github.io/workers/">https://w3c.github.io/workers/</a>
     <dt>Feedback:
     <dd><span><a href="mailto:public-webapps@w3.org?subject=%5Bworkers%5D%20YOUR%20TOPIC%20HERE">public-webapps@w3.org</a> with subject line “<kbd>[workers] <i data-lt="">… message topic …</i></kbd>” (<a href="http://lists.w3.org/Archives/Public/public-webapps/" rel="discussion">archives</a>)</span>
     <dt>Issue Tracking:
     <dd><a href="https://github.com/w3c/workers/issues/">GitHub</a>
     <dt class="editor">Editor:
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-url url" href="http://sangwhan.com">Sangwhan Moon</a> (<span class="p-org org">Invited Expert</span>)
     <dt class="editor">Former Editor:
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:ian@hixie.ch">Ian Hickson</a> (<a class="p-org org" href="https://google.com">Google</a>)
     <dt>Participate:
     <dd><span><a href="https://github.com/w3c/workers/issues/new">File an Issue</a></span>
     <dd><span>(<a href="https://github.com/w3c/workers/issues">Open Issues</a>)</span>
    </dl>
   </div>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> © 2016 <a href="http://www.w3.org/"><abbr title="World Wide Web Consortium">W3C</abbr></a><sup>®</sup> (<a href="http://www.csail.mit.edu/"><abbr title="Massachusetts Institute of Technology">MIT</abbr></a>, <a href="http://www.ercim.eu/"><abbr title="European Research Consortium for Informatics and Mathematics">ERCIM</abbr></a>, <a href="http://www.keio.ac.jp/">Keio</a>, <a href="http://ev.buaa.edu.cn/">Beihang</a>). W3C <a href="http://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>, <a href="http://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a> and <a href="http://www.w3.org/Consortium/Legal/2015/copyright-software-and-document" rel="license">permissive document license</a> rules apply. </p>
   <hr title="Separator for header">
  </div>
  <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
  <div class="p-summary" data-fill-with="abstract">
   <p>This specification defines an API that allows Web application authors

to spawn background workers running scripts in parallel to their main
page. This allows for thread-like operation with message-passing as
the coordination mechanism.</p>
  </div>
  <h2 class="no-num no-toc no-ref heading settled" id="status"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p> This is a public copy of the editors’ draft.
  It is provided for discussion only and may change at any moment.
  Its publication here does not imply endorsement of its contents by W3C.
  Don’t cite this document other than as work in progress. </p>
   <p> <strong>Changes to this document may be tracked at <a href="https://github.com/w3c/workers">https://github.com/w3c/workers</a>.</strong> </p>
   <p> If you wish to make comments regarding this document, please send them to this specification’s <a href="https://github.com/w3c/workers">GitHub repository</a> or (<a href="http://lists.w3.org/Archives/Public/public-webapps/">archived</a>) public mailing list <a href="mailto:public-webapps@w3.org?Subject=%5Bworkers%5D%20PUT%20SUBJECT%20HERE">public-webapps@w3.org</a> (see <a href="http://www.w3.org/Mail/Request">instructions</a>). When sending e-mail, please put the text “workers” in the subject, preferably like this: “[workers] <em>…summary of comment…</em>. All comments are welcome. </p>
   <p> This document was produced by the <a href="https://www.w3.org/WebPlatform/WG/">Web Platform Working Group</a>. </p>
   <p> This document was produced by a group operating under
  the <a href="https://www.w3.org/Consortium/Patent-Policy-20040205/">5 February 2004 W3C Patent Policy</a>.
  W3C maintains a <a href="https://www.w3.org/2004/01/pp-impl/83482/status" rel="disclosure">public list of any patent disclosures</a> made in connection with the deliverables of the group;
  that page also includes instructions for disclosing a patent.
  An individual who has actual knowledge of a patent which the individual believes contains <a href="https://www.w3.org/Consortium/Patent-Policy-20040205/#def-essential">Essential Claim(s)</a> must disclose the information in accordance with <a href="https://www.w3.org/Consortium/Patent-Policy-20040205/#sec-Disclosure">section 6 of the W3C Patent Policy</a>. </p>
   <p> This document is governed by the <a href="https://www.w3.org/2015/Process-20150901/" id="w3c_process_revision">1 September 2015 W3C Process Document</a>. </p>
   <p></p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li>
     <a href="#intro"><span class="secno">1</span> <span class="content">Introduction</span></a>
     <ol class="toc">
      <li><a href="#scope"><span class="secno">1.1</span> <span class="content">Scope</span></a>
      <li>
       <a href="#examples"><span class="secno">1.2</span> <span class="content">Examples</span></a>
       <ol class="toc">
        <li><a href="#examples-1"><span class="secno">1.2.1</span> <span class="content">A background number-crunching worker</span></a>
        <li><a href="#examples-2"><span class="secno">1.2.2</span> <span class="content"><code class="idl"><span>Worker</span></code> used for background I/O</span></a>
        <li><a href="#examples-3"><span class="secno">1.2.3</span> <span class="content">Shared workers introduction</span></a>
        <li><a href="#examples-4"><span class="secno">1.2.4</span> <span class="content">Shared state using a shared worker</span></a>
        <li><a href="#examples-5"><span class="secno">1.2.5</span> <span class="content">Delegation</span></a>
       </ol>
      <li>
       <a href="#tutorials"><span class="secno">1.3</span> <span class="content">Tutorials</span></a>
       <ol class="toc">
        <li><a href="#tutorial-1"><span class="secno">1.3.1</span> <span class="content">Creating a dedicated worker</span></a>
        <li><a href="#tutorial-2"><span class="secno">1.3.2</span> <span class="content">Communicating with a dedicated worker</span></a>
        <li><a href="#tutorial-3"><span class="secno">1.3.3</span> <span class="content">Shared workers</span></a>
       </ol>
     </ol>
    <li><a href="#terminology"><span class="secno">2</span> <span class="content">Terminology</span></a>
    <li>
     <a href="#infrastructure"><span class="secno">3</span> <span class="content">Infrastructure</span></a>
     <ol class="toc">
      <li>
       <a href="#global-scope"><span class="secno">3.1</span> <span class="content">The global scope</span></a>
       <ol class="toc">
        <li><a href="#workerglobalscope"><span class="secno">3.1.1</span> <span class="content">The <code class="idl"><span>WorkerGlobalScope</span></code> common interface</span></a>
        <li><a href="#dedicated-workers"><span class="secno">3.1.2</span> <span class="content">Dedicated workers and the <code class="idl"><span>DedicatedWorkerGlobalScope</span></code> interface</span></a>
        <li><a href="#shared-workers"><span class="secno">3.1.3</span> <span class="content">Shared workers and the <code class="idl"><span>SharedWorkerGlobalScope</span></code> interface</span></a>
       </ol>
      <li><a href="#event-loop"><span class="secno">3.2</span> <span class="content">The event loop</span></a>
      <li><a href="#worker-lifetime"><span class="secno">3.3</span> <span class="content">The worker’s lifetime</span></a>
      <li><a href="#processing-model"><span class="secno">3.4</span> <span class="content">Processing model</span></a>
      <li><a href="#runtime-script-errors"><span class="secno">3.5</span> <span class="content">Runtime script errors</span></a>
      <li>
       <a href="#creating-workers"><span class="secno">3.6</span> <span class="content">Creating workers</span></a>
       <ol class="toc">
        <li><a href="#abstract-worker-interface"><span class="secno">3.6.1</span> <span class="content">The <code class="idl"><span>AbstractWorker</span></code> abstract interface</span></a>
        <li><a href="#script-settings"><span class="secno">3.6.2</span> <span class="content">Script settings for workers</span></a>
        <li><a href="#dedicated-workers-and-worker-interface"><span class="secno">3.6.3</span> <span class="content">Dedicated workers and the <code class="idl"><span>Worker</span></code> interface</span></a>
        <li><a href="#shared-workers-and-sharedworker-interface"><span class="secno">3.6.4</span> <span class="content">Shared workers and the <code class="idl"><span>SharedWorker</span></code> interface</span></a>
       </ol>
     </ol>
    <li>
     <a href="#apis"><span class="secno">4</span> <span class="content">APIs available to workers</span></a>
     <ol class="toc">
      <li><a href="#importing"><span class="secno">4.1</span> <span class="content">Importing scripts and libraries</span></a>
      <li><a href="#workernavigator-object"><span class="secno">4.2</span> <span class="content">The WorkerNavigator object</span></a>
      <li><a href="#worker-locations"><span class="secno">4.3</span> <span class="content"><code class="idl"><span>Worker</span></code> locations</span></a>
      <li><a href="#security-considerations"><span class="secno">4.4</span> <span class="content">Security Considerations {#security-considerations}</span></a>
     </ol>
    <li><a href="#acknowledgements"><span class="secno"></span> <span class="content">Acknowledgements</span></a>
    <li>
     <a href="#conformance"><span class="secno"></span> <span class="content">Conformance</span></a>
     <ol class="toc">
      <li><a href="#conventions"><span class="secno"></span> <span class="content">Document conventions</span></a>
      <li><a href="#conformant-algorithms"><span class="secno"></span> <span class="content">Conformant Algorithms</span></a>
     </ol>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
    <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL Index</span></a>
   </ol>
  </nav>
  <main>
   <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#intro"></a></h2>
   <h3 class="heading settled" data-level="1.1" id="scope"><span class="secno">1.1. </span><span class="content">Scope</span><a class="self-link" href="#scope"></a></h3>
   <p><em>This section is non-normative.</em></p>
   <p>This specification defines an API for running scripts in the background
independently of any user interface scripts.</p>
   <p>This allows for long-running scripts that are not interrupted by scripts that
respond to clicks or other user interactions, and allows long tasks to be
executed without yielding to keep the page responsive.</p>
   <p><code class="idl"><a data-link-type="idl" href="#worker" id="ref-for-worker-1">Worker</a></code>s (as these background scripts are called herein) are relatively
heavy-weight, and are not intended to be used in large numbers. For example,
it would be inappropriate to launch one worker for each pixel of a four
megapixel image. The examples below show some appropriate uses of workers.</p>
   <p>Generally, workers are expected to be long-lived, have a high start-up
performance cost, and a high per-instance memory cost.</p>
   <h3 class="heading settled" data-level="1.2" id="examples"><span class="secno">1.2. </span><span class="content">Examples</span><a class="self-link" href="#examples"></a></h3>
   <p><em>This section is non-normative.</em></p>
   <p>There are a variety of uses that workers can be put to. The following
subsections show various examples of this use.</p>
   <h4 class="heading settled" data-level="1.2.1" id="examples-1"><span class="secno">1.2.1. </span><span class="content">A background number-crunching worker</span><a class="self-link" href="#examples-1"></a></h4>
   <p><em>This section is non-normative.</em></p>
   <p>The simplest use of workers is for performing a computationally expensive task
without interrupting the user interface.</p>
   <p>In this example, the main document spawns a worker to (naïvely) compute prime
numbers, and progressively displays the most recently found prime number.</p>
   <p>The main page is as follows:</p>
<pre class="example lang-html highlight" id="example-07c9d540"><a class="self-link" href="#example-07c9d540"></a><span class="cp">&lt;!DOCTYPE HTML></span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">></span>
 <span class="p">&lt;</span><span class="nt">head</span><span class="p">></span>
  <span class="p">&lt;</span><span class="nt">title</span><span class="p">></span>Worker example: One-core computation<span class="p">&lt;</span><span class="p">/</span><span class="nt">title</span><span class="p">></span>
 <span class="p">&lt;</span><span class="p">/</span><span class="nt">head</span><span class="p">></span>
 <span class="p">&lt;</span><span class="nt">body</span><span class="p">></span>
  <span class="p">&lt;</span><span class="nt">p</span><span class="p">></span>The highest prime number discovered so far is: <span class="p">&lt;</span><span class="nt">output</span> <span class="na">id</span><span class="o">=</span><span class="s">"result"</span><span class="p">></span><span class="p">&lt;</span><span class="p">/</span><span class="nt">output</span><span class="p">></span><span class="p">&lt;</span><span class="p">/</span><span class="nt">p</span><span class="p">></span>
  <span class="p">&lt;</span><span class="nt">script</span><span class="p">></span>
   <span class="kd">var</span> worker <span class="o">=</span> <span class="k">new</span> Worker<span class="p">(</span><span class="s1">'worker.js'</span><span class="p">)</span><span class="p">;</span>
   worker<span class="p">.</span>onmessage <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span>event<span class="p">)</span> <span class="p">{</span>
     document<span class="p">.</span>getElementById<span class="p">(</span><span class="s1">'result'</span><span class="p">)</span><span class="p">.</span>textContent <span class="o">=</span> event<span class="p">.</span>data<span class="p">;</span>
   <span class="p">}</span><span class="p">;</span>
  <span class="p">&lt;</span><span class="p">/</span><span class="nt">script</span><span class="p">></span>
 <span class="p">&lt;</span><span class="p">/</span><span class="nt">body</span><span class="p">></span>
<span class="p">&lt;</span><span class="p">/</span><span class="nt">html</span><span class="p">></span>
</pre>
   <p>The <code class="idl"><a data-link-type="idl" href="#worker" id="ref-for-worker-2">Worker</a></code>() constructor call creates a worker and returns a <code class="idl"><a data-link-type="idl" href="#worker" id="ref-for-worker-3">Worker</a></code> object representing that worker, which is used to communicate with the worker.
That object’s <code class="idl"><a data-link-type="idl" href="#dom-dedicatedworkerglobalscope-onmessage" id="ref-for-dom-dedicatedworkerglobalscope-onmessage-1">onmessage</a></code> event handler allows the code to receive messages from
the worker.</p>
   <p>The worker itself is as follows:</p>
<pre class="example lang-js highlight" id="example-632564c3"><a class="self-link" href="#example-632564c3"></a><span class="kd">var</span> n <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
search<span class="o">:</span> <span class="k">while</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
  n <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> i <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> i <span class="o">&lt;=</span> Math<span class="p">.</span>sqrt<span class="p">(</span>n<span class="p">)</span><span class="p">;</span> i <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span>n <span class="o">%</span> i <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
     <span class="k">continue</span> search<span class="p">;</span>
  <span class="c1">// Found a prime!
</span>  postMessage<span class="p">(</span>n<span class="p">)</span><span class="p">;</span>
<span class="p">}</span>
</pre>
   <p>The bulk of this code is simply an unoptimised search for a prime number.
The <code class="idl"><a data-link-type="idl" href="#dom-dedicatedworkerglobalscope-postmessage" id="ref-for-dom-dedicatedworkerglobalscope-postmessage-1">postMessage()</a></code> method is used to send a message back to the page when a
prime is found.</p>
   <p><a href="https://whatwg.org/demos/workers/primes/page.html"> View this example online. </a></p>
   <h4 class="heading settled" data-level="1.2.2" id="examples-2"><span class="secno">1.2.2. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#worker" id="ref-for-worker-4">Worker</a></code> used for background I/O</span><a class="self-link" href="#examples-2"></a></h4>
   <p><em>This section is non-normative.</em></p>
   <p>In this example, the main document uses two workers, one for fetching stock
updates at regular intervals, and one for performing search queries that the
user requests.</p>
   <p>The main page is as follows:</p>
<pre class="lang-html highlight"><span class="cp">&lt;!DOCTYPE HTML></span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">></span>
 <span class="p">&lt;</span><span class="nt">head</span><span class="p">></span>
  <span class="p">&lt;</span><span class="nt">title</span><span class="p">></span>Worker example: Stock ticker<span class="p">&lt;</span><span class="p">/</span><span class="nt">title</span><span class="p">></span>
  <span class="p">&lt;</span><span class="nt">script</span><span class="p">></span>
   <span class="c1">// Ticker
</span>   <span class="kd">var</span> symbol <span class="o">=</span> <span class="s1">'GOOG'</span><span class="p">;</span> <span class="c1">// default symbol to watch
</span>   <span class="kd">var</span> ticker <span class="o">=</span> <span class="k">new</span> Worker<span class="p">(</span><span class="s1">'ticker.js'</span><span class="p">)</span><span class="p">;</span>

   <span class="c1">// Searcher
</span>   <span class="kd">var</span> searcher <span class="o">=</span> <span class="k">new</span> Worker<span class="p">(</span><span class="s1">'searcher.js'</span><span class="p">)</span><span class="p">;</span>
   <span class="kd">function</span> search<span class="p">(</span>query<span class="p">)</span> <span class="p">{</span>
     searcher<span class="p">.</span>postMessage<span class="p">(</span>query<span class="p">)</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="c1">// Symbol selection UI
</span>   <span class="kd">function</span> select<span class="p">(</span>newSymbol<span class="p">)</span> <span class="p">{</span>
     symbol <span class="o">=</span> newSymbol<span class="p">;</span>
     ticker<span class="p">.</span>postMessage<span class="p">(</span>symbol<span class="p">)</span><span class="p">;</span>
   <span class="p">}</span>
  <span class="p">&lt;</span><span class="p">/</span><span class="nt">script</span><span class="p">></span>
 <span class="p">&lt;</span><span class="p">/</span><span class="nt">head</span><span class="p">></span>
 <span class="p">&lt;</span><span class="nt">body</span> <span class="na">onload</span><span class="o">=</span><span class="s">"search('')"</span><span class="p">></span>
  <span class="p">&lt;</span><span class="nt">p</span><span class="p">></span><span class="p">&lt;</span><span class="nt">output</span> <span class="na">id</span><span class="o">=</span><span class="s">"symbol"</span><span class="p">></span><span class="p">&lt;</span><span class="p">/</span><span class="nt">output</span><span class="p">></span> <span class="p">&lt;</span><span class="nt">output</span> <span class="na">id</span><span class="o">=</span><span class="s">"value"</span><span class="p">></span><span class="p">&lt;</span><span class="p">/</span><span class="nt">output</span><span class="p">></span><span class="p">&lt;</span><span class="p">/</span><span class="nt">p</span><span class="p">></span>
  <span class="p">&lt;</span><span class="nt">script</span><span class="p">></span>
   ticker<span class="p">.</span>onmessage <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span>event<span class="p">)</span> <span class="p">{</span>
     <span class="kd">var</span> data <span class="o">=</span> event<span class="p">.</span>data<span class="p">.</span>split<span class="p">(</span><span class="s1">' '</span><span class="p">)</span><span class="p">;</span>
     document<span class="p">.</span>getElementById<span class="p">(</span><span class="s1">'symbol'</span><span class="p">)</span><span class="p">.</span>textContent <span class="o">=</span> data<span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="p">;</span>
     document<span class="p">.</span>getElementById<span class="p">(</span><span class="s1">'value'</span><span class="p">)</span><span class="p">.</span>textContent <span class="o">=</span> data<span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="p">;</span>
   <span class="p">}</span><span class="p">;</span>
   ticker<span class="p">.</span>postMessage<span class="p">(</span>symbol<span class="p">)</span><span class="p">;</span>
  <span class="p">&lt;</span><span class="p">/</span><span class="nt">script</span><span class="p">></span>
  <span class="p">&lt;</span><span class="nt">p</span><span class="p">></span><span class="p">&lt;</span><span class="nt">label</span><span class="p">></span>Search: <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">"text"</span> <span class="na">autofocus</span> <span class="na">oninput</span><span class="o">=</span><span class="s">"search(this.value)"</span><span class="p">></span><span class="p">&lt;</span><span class="p">/</span><span class="nt">label</span><span class="p">></span><span class="p">&lt;</span><span class="p">/</span><span class="nt">p</span><span class="p">></span>
  <span class="p">&lt;</span><span class="nt">ul</span> <span class="na">id</span><span class="o">=</span><span class="s">"results"</span><span class="p">></span><span class="p">&lt;</span><span class="p">/</span><span class="nt">ul</span><span class="p">></span>
  <span class="p">&lt;</span><span class="nt">script</span><span class="p">></span>
   searcher<span class="p">.</span>onmessage <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span>event<span class="p">)</span> <span class="p">{</span>
     <span class="kd">var</span> data <span class="o">=</span> event<span class="p">.</span>data<span class="p">.</span>split<span class="p">(</span><span class="s1">' '</span><span class="p">)</span><span class="p">;</span>
     <span class="kd">var</span> results <span class="o">=</span> document<span class="p">.</span>getElementById<span class="p">(</span><span class="s1">'results'</span><span class="p">)</span><span class="p">;</span>
     <span class="k">while</span> <span class="p">(</span>results<span class="p">.</span>hasChildNodes<span class="p">(</span><span class="p">)</span><span class="p">)</span> <span class="c1">// Clear previous results
</span>       results<span class="p">.</span>removeChild<span class="p">(</span>results<span class="p">.</span>firstChild<span class="p">)</span><span class="p">;</span>
     <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> i <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> i <span class="o">&lt;</span> data<span class="p">.</span>length<span class="p">;</span> i <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
       <span class="c1">// Add a list item with a button for each result
</span>       <span class="kd">var</span> li <span class="o">=</span> document<span class="p">.</span>createElement<span class="p">(</span><span class="s1">'li'</span><span class="p">)</span><span class="p">;</span>
       <span class="kd">var</span> button <span class="o">=</span> document<span class="p">.</span>createElement<span class="p">(</span><span class="s1">'button'</span><span class="p">)</span><span class="p">;</span>
       button<span class="p">.</span>value <span class="o">=</span> data<span class="p">[</span>i<span class="p">]</span><span class="p">;</span>
       button<span class="p">.</span>type <span class="o">=</span> <span class="s1">'button'</span><span class="p">;</span>
       button<span class="p">.</span>onclick <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="p">)</span> <span class="p">{</span> select<span class="p">(</span><span class="k">this</span><span class="p">.</span>value<span class="p">)</span><span class="p">;</span> <span class="p">}</span><span class="p">;</span>
       button<span class="p">.</span>textContent <span class="o">=</span> data<span class="p">[</span>i<span class="p">]</span><span class="p">;</span>
       li<span class="p">.</span>appendChild<span class="p">(</span>button<span class="p">)</span><span class="p">;</span>
       results<span class="p">.</span>appendChild<span class="p">(</span>li<span class="p">)</span><span class="p">;</span>
     <span class="p">}</span>
   <span class="p">}</span><span class="p">;</span>
  <span class="p">&lt;</span><span class="p">/</span><span class="nt">script</span><span class="p">></span>
  <span class="p">&lt;</span><span class="nt">p</span><span class="p">></span>(The data in this example is not real. Try searching for "Google" or "Apple".)<span class="p">&lt;</span><span class="p">/</span><span class="nt">p</span><span class="p">></span>
 <span class="p">&lt;</span><span class="p">/</span><span class="nt">body</span><span class="p">></span>
<span class="p">&lt;</span><span class="p">/</span><span class="nt">html</span><span class="p">></span>
</pre>
   <p>The two workers use a common library for performing the actual network calls.
This library is as follows:</p>
<pre class="example lang-js highlight" id="example-aa61174a"><a class="self-link" href="#example-aa61174a"></a><span class="kd">function</span> get<span class="p">(</span>url<span class="p">)</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">var</span> xhr <span class="o">=</span> <span class="k">new</span> XMLHttpRequest<span class="p">(</span><span class="p">)</span><span class="p">;</span>
    xhr<span class="p">.</span>open<span class="p">(</span><span class="s1">'GET'</span><span class="p">,</span> url<span class="p">,</span> <span class="kc">false</span><span class="p">)</span><span class="p">;</span>
    xhr<span class="p">.</span>send<span class="p">(</span><span class="p">)</span><span class="p">;</span>
    <span class="k">return</span> xhr<span class="p">.</span>responseText<span class="p">;</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span>e<span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s1">''</span><span class="p">;</span> <span class="c1">// Turn all errors into empty results
</span>  <span class="p">}</span>
<span class="p">}</span>
</pre>
   <p>The stock updater worker is as follows:</p>
<pre class="example lang-js highlight" id="example-4f4647c1"><a class="self-link" href="#example-4f4647c1"></a>importScripts<span class="p">(</span><span class="s1">'io.js'</span><span class="p">)</span><span class="p">;</span>
<span class="kd">var</span> timer<span class="p">;</span>
<span class="kd">var</span> symbol<span class="p">;</span>
<span class="kd">function</span> update<span class="p">(</span><span class="p">)</span> <span class="p">{</span>
  postMessage<span class="p">(</span>symbol <span class="o">+</span> <span class="s1">' '</span> <span class="o">+</span> get<span class="p">(</span><span class="s1">'stock.cgi?'</span> <span class="o">+</span> symbol<span class="p">)</span><span class="p">)</span><span class="p">;</span>
  timer <span class="o">=</span> setTimeout<span class="p">(</span>update<span class="p">,</span> <span class="mi">10000</span><span class="p">)</span><span class="p">;</span>
<span class="p">}</span>
onmessage <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span>event<span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span>timer<span class="p">)</span>
    clearTimeout<span class="p">(</span>timer<span class="p">)</span><span class="p">;</span>
  symbol <span class="o">=</span> event<span class="p">.</span>data<span class="p">;</span>
  update<span class="p">(</span><span class="p">)</span><span class="p">;</span>
<span class="p">}</span><span class="p">;</span>
</pre>
   <p>The search query worker is as follows:</p>
<pre class="example lang-js highlight" id="example-fa742fa7"><a class="self-link" href="#example-fa742fa7"></a>importScripts<span class="p">(</span><span class="s1">'io.js'</span><span class="p">)</span><span class="p">;</span>
onmessage <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span>event<span class="p">)</span> <span class="p">{</span>
  postMessage<span class="p">(</span>get<span class="p">(</span><span class="s1">'search.cgi?'</span> <span class="o">+</span> event<span class="p">.</span>data<span class="p">)</span><span class="p">)</span><span class="p">;</span>
<span class="p">}</span><span class="p">;</span>
</pre>
   <p><a href="https://www.whatwg.org/demos/workers/stocks/page.html"> View this example online. </a></p>
   <h4 class="heading settled" data-level="1.2.3" id="examples-3"><span class="secno">1.2.3. </span><span class="content">Shared workers introduction</span><a class="self-link" href="#examples-3"></a></h4>
   <p><em>This section is non-normative.</em></p>
   <p>This section introduces shared workers using a Hello World example. Shared
workers use slightly different APIs, since each worker can have multiple
connections.</p>
   <p>This first example shows how you connect to a worker and how a worker can send
a message back to the page when it connects to it. Received messages are
displayed in a log.</p>
   <p>Here is the HTML page:</p>
<pre class="example lang-html highlight" id="example-0a61f721"><a class="self-link" href="#example-0a61f721"></a><span class="cp">&lt;!DOCTYPE HTML></span>
<span class="p">&lt;</span><span class="nt">title</span><span class="p">></span>Shared workers: demo 1<span class="p">&lt;</span><span class="p">/</span><span class="nt">title</span><span class="p">></span>
<span class="p">&lt;</span><span class="nt">pre</span> <span class="na">id</span><span class="o">=</span><span class="s">"log"</span><span class="p">></span>Log:<span class="p">&lt;</span><span class="p">/</span><span class="nt">pre</span><span class="p">></span>
<span class="p">&lt;</span><span class="nt">script</span><span class="p">></span>
  <span class="kd">var</span> worker <span class="o">=</span> <span class="k">new</span> SharedWorker<span class="p">(</span><span class="s1">'test.js'</span><span class="p">)</span><span class="p">;</span>
  <span class="kd">var</span> log <span class="o">=</span> document<span class="p">.</span>getElementById<span class="p">(</span><span class="s1">'log'</span><span class="p">)</span><span class="p">;</span>
  worker<span class="p">.</span>port<span class="p">.</span>onmessage <span class="o">=</span> <span class="kd">function</span><span class="p">(</span>e<span class="p">)</span> <span class="p">{</span> <span class="c1">// Note: Not worker.onmessage!
</span>    log<span class="p">.</span>textContent <span class="o">+=</span> <span class="s1">'\n'</span> <span class="o">+</span> e<span class="p">.</span>data<span class="p">;</span>
  <span class="p">}</span>
<span class="p">&lt;</span><span class="p">/</span><span class="nt">script</span><span class="p">></span>
</pre>
   <p>Here is the JavaScript worker:</p>
<pre class="example lang-js highlight" id="example-2d160399"><a class="self-link" href="#example-2d160399"></a>onconnect <span class="o">=</span> <span class="kd">function</span><span class="p">(</span>e<span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> port <span class="o">=</span> e<span class="p">.</span>ports<span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="p">;</span>
  port<span class="p">.</span>postMessage<span class="p">(</span><span class="s1">'Hello World!'</span><span class="p">)</span><span class="p">;</span>
<span class="p">}</span>
</pre>
   <p><a href="https://www.whatwg.org/demos/workers/shared/001/test.html"> View this example online. </a></p>
   <p>This second example extends the first one by changing two things: first,
messages are received using <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#dom-eventtarget-addeventlistener">addEventListener()</a></code> instead of an event handler
IDL attribute, and second, a message is sent to the worker, causing the
worker to send another message in return. Received messages are again
displayed in a log.</p>
   <p>Here is the HTML page:</p>
<pre class="example lang-html highlight" id="example-79752e23"><a class="self-link" href="#example-79752e23"></a><span class="cp">&lt;!DOCTYPE HTML></span>
<span class="p">&lt;</span><span class="nt">title</span><span class="p">></span>Shared workers: demo 2<span class="p">&lt;</span><span class="p">/</span><span class="nt">title</span><span class="p">></span>
<span class="p">&lt;</span><span class="nt">pre</span> <span class="na">id</span><span class="o">=</span><span class="s">"log"</span><span class="p">></span>Log:<span class="p">&lt;</span><span class="p">/</span><span class="nt">pre</span><span class="p">></span>
<span class="p">&lt;</span><span class="nt">script</span><span class="p">></span>
  <span class="kd">var</span> worker <span class="o">=</span> <span class="k">new</span> SharedWorker<span class="p">(</span><span class="s1">'test.js'</span><span class="p">)</span><span class="p">;</span>
  <span class="kd">var</span> log <span class="o">=</span> document<span class="p">.</span>getElementById<span class="p">(</span><span class="s1">'log'</span><span class="p">)</span><span class="p">;</span>
  worker<span class="p">.</span>port<span class="p">.</span>addEventListener<span class="p">(</span><span class="s1">'message'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span>e<span class="p">)</span> <span class="p">{</span>
    log<span class="p">.</span>textContent <span class="o">+=</span> <span class="s1">'\n'</span> <span class="o">+</span> e<span class="p">.</span>data<span class="p">;</span>
  <span class="p">}</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span><span class="p">;</span>
  worker<span class="p">.</span>port<span class="p">.</span>start<span class="p">(</span><span class="p">)</span><span class="p">;</span> <span class="c1">// Note: Needed when using addEventListener
</span>  worker<span class="p">.</span>port<span class="p">.</span>postMessage<span class="p">(</span><span class="s1">'ping'</span><span class="p">)</span><span class="p">;</span>
<span class="p">&lt;</span><span class="p">/</span><span class="nt">script</span><span class="p">></span>
</pre>
   <p>Here is the JavaScript worker:</p>
<pre class="example lang-js highlight" id="example-bf29cb8f"><a class="self-link" href="#example-bf29cb8f"></a>onconnect <span class="o">=</span> <span class="kd">function</span><span class="p">(</span>e<span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> port <span class="o">=</span> e<span class="p">.</span>ports<span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="p">;</span>
  port<span class="p">.</span>postMessage<span class="p">(</span><span class="s1">'Hello World!'</span><span class="p">)</span><span class="p">;</span>
  port<span class="p">.</span>onmessage <span class="o">=</span> <span class="kd">function</span><span class="p">(</span>e<span class="p">)</span> <span class="p">{</span>
    port<span class="p">.</span>postMessage<span class="p">(</span><span class="s1">'pong'</span><span class="p">)</span><span class="p">;</span> <span class="c1">// Not e.ports[0].postMessage!
</span>    <span class="c1">// e.target.postMessage('pong'); // Also works
</span>  <span class="p">}</span>
<span class="p">}</span>
</pre>
   <p><a href="https://www.whatwg.org/demos/workers/shared/002/test.html"> View this example online. </a></p>
   <p>Finally, the example is extended to show how two pages can connect to the same
worker; in this case, the second page is merely in an iframe on the first page,
but the same principle would apply to an entirely separate page in a separate
top-level browsing context.</p>
   <p>Here is the outer HTML page:</p>
<pre class="example lang-html highlight" id="example-0d9039c8"><a class="self-link" href="#example-0d9039c8"></a><span class="cp">&lt;!DOCTYPE HTML></span>
<span class="p">&lt;</span><span class="nt">title</span><span class="p">></span>Shared workers: demo 3<span class="p">&lt;</span><span class="p">/</span><span class="nt">title</span><span class="p">></span>
<span class="p">&lt;</span><span class="nt">pre</span> <span class="na">id</span><span class="o">=</span><span class="s">"log"</span><span class="p">></span>Log:<span class="p">&lt;</span><span class="p">/</span><span class="nt">pre</span><span class="p">></span>
<span class="p">&lt;</span><span class="nt">script</span><span class="p">></span>
  <span class="kd">var</span> worker <span class="o">=</span> <span class="k">new</span> SharedWorker<span class="p">(</span><span class="s1">'test.js'</span><span class="p">)</span><span class="p">;</span>
  <span class="kd">var</span> log <span class="o">=</span> document<span class="p">.</span>getElementById<span class="p">(</span><span class="s1">'log'</span><span class="p">)</span><span class="p">;</span>
  worker<span class="p">.</span>port<span class="p">.</span>addEventListener<span class="p">(</span><span class="s1">'message'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span>e<span class="p">)</span> <span class="p">{</span>
    log<span class="p">.</span>textContent <span class="o">+=</span> <span class="s1">'\n'</span> <span class="o">+</span> e<span class="p">.</span>data<span class="p">;</span>
  <span class="p">}</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span><span class="p">;</span>
  worker<span class="p">.</span>port<span class="p">.</span>start<span class="p">(</span><span class="p">)</span><span class="p">;</span>
  worker<span class="p">.</span>port<span class="p">.</span>postMessage<span class="p">(</span><span class="s1">'ping'</span><span class="p">)</span><span class="p">;</span>
<span class="p">&lt;</span><span class="p">/</span><span class="nt">script</span><span class="p">></span>
<span class="p">&lt;</span><span class="nt">iframe</span> <span class="na">src</span><span class="o">=</span><span class="s">"inner.html"</span><span class="p">></span><span class="p">&lt;</span><span class="p">/</span><span class="nt">iframe</span><span class="p">></span>
</pre>
   <p>Here is the inner HTML page:</p>
<pre class="example lang-html highlight" id="example-ef1c3b16"><a class="self-link" href="#example-ef1c3b16"></a><span class="cp">&lt;!DOCTYPE HTML></span>
<span class="p">&lt;</span><span class="nt">title</span><span class="p">></span>Shared workers: demo 3 inner frame<span class="p">&lt;</span><span class="p">/</span><span class="nt">title</span><span class="p">></span>
<span class="p">&lt;</span><span class="nt">pre</span> <span class="na">id</span><span class="o">=</span><span class="s">log</span><span class="p">></span>Inner log:<span class="p">&lt;</span><span class="p">/</span><span class="nt">pre</span><span class="p">></span>
<span class="p">&lt;</span><span class="nt">script</span><span class="p">></span>
  <span class="kd">var</span> worker <span class="o">=</span> <span class="k">new</span> SharedWorker<span class="p">(</span><span class="s1">'test.js'</span><span class="p">)</span><span class="p">;</span>
  <span class="kd">var</span> log <span class="o">=</span> document<span class="p">.</span>getElementById<span class="p">(</span><span class="s1">'log'</span><span class="p">)</span><span class="p">;</span>
  worker<span class="p">.</span>port<span class="p">.</span>onmessage <span class="o">=</span> <span class="kd">function</span><span class="p">(</span>e<span class="p">)</span> <span class="p">{</span>
   log<span class="p">.</span>textContent <span class="o">+=</span> <span class="s1">'\n'</span> <span class="o">+</span> e<span class="p">.</span>data<span class="p">;</span>
  <span class="p">}</span>
<span class="p">&lt;</span><span class="p">/</span><span class="nt">script</span><span class="p">></span>
</pre>
   <p>Here is the JavaScript worker:</p>
<pre class="example lang-js highlight" id="example-f96d732f"><a class="self-link" href="#example-f96d732f"></a><span class="kd">var</span> count <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
onconnect <span class="o">=</span> <span class="kd">function</span><span class="p">(</span>e<span class="p">)</span> <span class="p">{</span>
  count <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="kd">var</span> port <span class="o">=</span> e<span class="p">.</span>ports<span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="p">;</span>
  port<span class="p">.</span>postMessage<span class="p">(</span><span class="s1">'Hello World! You are connection #'</span> <span class="o">+</span> count<span class="p">)</span><span class="p">;</span>
  port<span class="p">.</span>onmessage <span class="o">=</span> <span class="kd">function</span><span class="p">(</span>e<span class="p">)</span> <span class="p">{</span>
    port<span class="p">.</span>postMessage<span class="p">(</span><span class="s1">'pong'</span><span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre>
   <p><a href="https://www.whatwg.org/demos/workers/shared/003/test.html"> View this example online. </a></p>
   <h4 class="heading settled" data-level="1.2.4" id="examples-4"><span class="secno">1.2.4. </span><span class="content">Shared state using a shared worker</span><a class="self-link" href="#examples-4"></a></h4>
   <p><em>This section is non-normative.</em></p>
   <p>In this example, multiple windows (viewers) can be opened that are all
viewing the same map. All the windows share the same map information, with a
single worker coordinating all the viewers. Each viewer can move around
independently, but if they set any data on the map, all the viewers are
updated.</p>
   <p>The main page isn’t interesting, it merely provides a way to open the viewers:</p>
<pre class="example lang-html highlight" id="example-0c68fc5a"><a class="self-link" href="#example-0c68fc5a"></a><span class="cp">&lt;!DOCTYPE HTML></span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">></span>
 <span class="p">&lt;</span><span class="nt">head</span><span class="p">></span>
  <span class="p">&lt;</span><span class="nt">title</span><span class="p">></span>Workers example: Multiviewer<span class="p">&lt;</span><span class="p">/</span><span class="nt">title</span><span class="p">></span>
  <span class="p">&lt;</span><span class="nt">script</span><span class="p">></span>
   <span class="kd">function</span> openViewer<span class="p">(</span><span class="p">)</span> <span class="p">{</span>
     window<span class="p">.</span>open<span class="p">(</span><span class="s1">'viewer.html'</span><span class="p">)</span><span class="p">;</span>
   <span class="p">}</span>
  <span class="p">&lt;</span><span class="p">/</span><span class="nt">script</span><span class="p">></span>
 <span class="p">&lt;</span><span class="p">/</span><span class="nt">head</span><span class="p">></span>
 <span class="p">&lt;</span><span class="nt">body</span><span class="p">></span>
  <span class="p">&lt;</span><span class="nt">p</span><span class="p">></span><span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">button</span> <span class="na">onclick</span><span class="o">=</span><span class="s">"openViewer()"</span><span class="p">></span>Open a new
  viewer<span class="p">&lt;</span><span class="p">/</span><span class="nt">button</span><span class="p">></span><span class="p">&lt;</span><span class="p">/</span><span class="nt">p</span><span class="p">></span>
  <span class="p">&lt;</span><span class="nt">p</span><span class="p">></span>Each viewer opens in a new window. You can have as many viewers
  as you like, they all view the same data.<span class="p">&lt;</span><span class="p">/</span><span class="nt">p</span><span class="p">></span>
 <span class="p">&lt;</span><span class="p">/</span><span class="nt">body</span><span class="p">></span>
<span class="p">&lt;</span><span class="p">/</span><span class="nt">html</span><span class="p">></span>
</pre>
   <p>The viewer is more involved:</p>
<pre class="example lang-html highlight" id="example-ab41dbc8"><a class="self-link" href="#example-ab41dbc8"></a><span class="cp">&lt;!DOCTYPE HTML></span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">></span>
 <span class="p">&lt;</span><span class="nt">head</span><span class="p">></span>
  <span class="p">&lt;</span><span class="nt">title</span><span class="p">></span>Workers example: Multiviewer viewer<span class="p">&lt;</span><span class="p">/</span><span class="nt">title</span><span class="p">></span>
  <span class="p">&lt;</span><span class="nt">script</span><span class="p">></span>
   <span class="kd">var</span> worker <span class="o">=</span> <span class="k">new</span> SharedWorker<span class="p">(</span><span class="s1">'worker.js'</span><span class="p">,</span> <span class="s1">'core'</span><span class="p">)</span><span class="p">;</span>

   <span class="c1">// Configuration
</span>   <span class="kd">function</span> configure<span class="p">(</span>event<span class="p">)</span> <span class="p">{</span>
     <span class="k">if</span> <span class="p">(</span>event<span class="p">.</span>data<span class="p">.</span>substr<span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">'cfg '</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
     <span class="kd">var</span> name <span class="o">=</span> event<span class="p">.</span>data<span class="p">.</span>substr<span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="p">.</span>split<span class="p">(</span><span class="s1">' '</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="p">;</span>
     <span class="c1">// update display to mention our name is name
</span>     document<span class="p">.</span>getElementsByTagName<span class="p">(</span><span class="s1">'h1'</span><span class="p">)</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="p">.</span>textContent <span class="o">+=</span> <span class="s1">' '</span> <span class="o">+</span> name<span class="p">;</span>
     <span class="c1">// no longer need this listener
</span>     worker<span class="p">.</span>port<span class="p">.</span>removeEventListener<span class="p">(</span><span class="s1">'message'</span><span class="p">,</span> configure<span class="p">,</span> <span class="kc">false</span><span class="p">)</span><span class="p">;</span>
   <span class="p">}</span>
   worker<span class="p">.</span>port<span class="p">.</span>addEventListener<span class="p">(</span><span class="s1">'message'</span><span class="p">,</span> configure<span class="p">,</span> <span class="kc">false</span><span class="p">)</span><span class="p">;</span>

   <span class="c1">// Map
</span>   <span class="kd">function</span> paintMap<span class="p">(</span>event<span class="p">)</span> <span class="p">{</span>
     <span class="k">if</span> <span class="p">(</span>event<span class="p">.</span>data<span class="p">.</span>substr<span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">'map '</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
     <span class="kd">var</span> data <span class="o">=</span> event<span class="p">.</span>data<span class="p">.</span>substr<span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="p">.</span>split<span class="p">(</span><span class="s1">','</span><span class="p">)</span><span class="p">;</span>
     <span class="c1">// Display tiles data[0] .. data[8]
</span>     <span class="kd">var</span> canvas <span class="o">=</span> document<span class="p">.</span>getElementById<span class="p">(</span><span class="s1">'map'</span><span class="p">)</span><span class="p">;</span>
     <span class="kd">var</span> context <span class="o">=</span> canvas<span class="p">.</span>getContext<span class="p">(</span><span class="s1">'2d'</span><span class="p">)</span><span class="p">;</span>
     <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> y <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> y <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> y <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
       <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> x <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> x <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> x <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
         <span class="kd">var</span> tile <span class="o">=</span> data<span class="p">[</span>y <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> x<span class="p">]</span><span class="p">;</span>
         <span class="k">if</span> <span class="p">(</span>tile <span class="o">==</span> <span class="s1">'0'</span><span class="p">)</span>
           context<span class="p">.</span>fillStyle <span class="o">=</span> <span class="s1">'green'</span><span class="p">;</span>
         <span class="k">else</span>
           context<span class="p">.</span>fillStyle <span class="o">=</span> <span class="s1">'maroon'</span><span class="p">;</span>
         context<span class="p">.</span>fillRect<span class="p">(</span>x <span class="o">*</span> <span class="mi">50</span><span class="p">,</span> y <span class="o">*</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span><span class="p">;</span>
       <span class="p">}</span>
     <span class="p">}</span>
   <span class="p">}</span>
   worker<span class="p">.</span>port<span class="p">.</span>addEventListener<span class="p">(</span><span class="s1">'message'</span><span class="p">,</span> paintMap<span class="p">,</span> <span class="kc">false</span><span class="p">)</span><span class="p">;</span>

   <span class="c1">// Public chat
</span>   <span class="kd">function</span> updatePublicChat<span class="p">(</span>event<span class="p">)</span> <span class="p">{</span>
     <span class="k">if</span> <span class="p">(</span>event<span class="p">.</span>data<span class="p">.</span>substr<span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">'txt '</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
     <span class="kd">var</span> name <span class="o">=</span> event<span class="p">.</span>data<span class="p">.</span>substr<span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="p">.</span>split<span class="p">(</span><span class="s1">' '</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="p">;</span>
     <span class="kd">var</span> message <span class="o">=</span> event<span class="p">.</span>data<span class="p">.</span>substr<span class="p">(</span><span class="mi">4</span> <span class="o">+</span> name<span class="p">.</span>length <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="p">;</span>
     <span class="c1">// display "&lt;name> message" in public chat
</span>     <span class="kd">var</span> <span class="kr">public</span> <span class="o">=</span> document<span class="p">.</span>getElementById<span class="p">(</span><span class="s1">'public'</span><span class="p">)</span><span class="p">;</span>
     <span class="kd">var</span> p <span class="o">=</span> document<span class="p">.</span>createElement<span class="p">(</span><span class="s1">'p'</span><span class="p">)</span><span class="p">;</span>
     <span class="kd">var</span> n <span class="o">=</span> document<span class="p">.</span>createElement<span class="p">(</span><span class="s1">'button'</span><span class="p">)</span><span class="p">;</span>
     n<span class="p">.</span>textContent <span class="o">=</span> <span class="s1">'&lt;'</span> <span class="o">+</span> name <span class="o">+</span> <span class="s1">'> '</span><span class="p">;</span>
     n<span class="p">.</span>onclick <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="p">)</span> <span class="p">{</span> worker<span class="p">.</span>port<span class="p">.</span>postMessage<span class="p">(</span><span class="s1">'msg '</span> <span class="o">+</span> name<span class="p">)</span><span class="p">;</span> <span class="p">}</span><span class="p">;</span>
     p<span class="p">.</span>appendChild<span class="p">(</span>n<span class="p">)</span><span class="p">;</span>
     <span class="kd">var</span> m <span class="o">=</span> document<span class="p">.</span>createElement<span class="p">(</span><span class="s1">'span'</span><span class="p">)</span><span class="p">;</span>
     m<span class="p">.</span>textContent <span class="o">=</span> message<span class="p">;</span>
     p<span class="p">.</span>appendChild<span class="p">(</span>m<span class="p">)</span><span class="p">;</span>
     <span class="kr">public</span><span class="p">.</span>appendChild<span class="p">(</span>p<span class="p">)</span><span class="p">;</span>
   <span class="p">}</span>
   worker<span class="p">.</span>port<span class="p">.</span>addEventListener<span class="p">(</span><span class="s1">'message'</span><span class="p">,</span> updatePublicChat<span class="p">,</span> <span class="kc">false</span><span class="p">)</span><span class="p">;</span>

   <span class="c1">// Private chat
</span>   <span class="kd">function</span> startPrivateChat<span class="p">(</span>event<span class="p">)</span> <span class="p">{</span>
     <span class="k">if</span> <span class="p">(</span>event<span class="p">.</span>data<span class="p">.</span>substr<span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">'msg '</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
     <span class="kd">var</span> name <span class="o">=</span> event<span class="p">.</span>data<span class="p">.</span>substr<span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="p">.</span>split<span class="p">(</span><span class="s1">' '</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="p">;</span>
     <span class="kd">var</span> port <span class="o">=</span> event<span class="p">.</span>ports<span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="p">;</span>
     <span class="c1">// Display a private chat UI
</span>     <span class="kd">var</span> ul <span class="o">=</span> document<span class="p">.</span>getElementById<span class="p">(</span><span class="s1">'private'</span><span class="p">)</span><span class="p">;</span>
     <span class="kd">var</span> li <span class="o">=</span> document<span class="p">.</span>createElement<span class="p">(</span><span class="s1">'li'</span><span class="p">)</span><span class="p">;</span>
     <span class="kd">var</span> h3 <span class="o">=</span> document<span class="p">.</span>createElement<span class="p">(</span><span class="s1">'h3'</span><span class="p">)</span><span class="p">;</span>
     h3<span class="p">.</span>textContent <span class="o">=</span> <span class="s1">'Private chat with '</span> <span class="o">+</span> name<span class="p">;</span>
     li<span class="p">.</span>appendChild<span class="p">(</span>h3<span class="p">)</span><span class="p">;</span>
     <span class="kd">var</span> div <span class="o">=</span> document<span class="p">.</span>createElement<span class="p">(</span><span class="s1">'div'</span><span class="p">)</span><span class="p">;</span>
     <span class="kd">var</span> addMessage <span class="o">=</span> <span class="kd">function</span><span class="p">(</span>name<span class="p">,</span> message<span class="p">)</span> <span class="p">{</span>
       <span class="kd">var</span> p <span class="o">=</span> document<span class="p">.</span>createElement<span class="p">(</span><span class="s1">'p'</span><span class="p">)</span><span class="p">;</span>
       <span class="kd">var</span> n <span class="o">=</span> document<span class="p">.</span>createElement<span class="p">(</span><span class="s1">'strong'</span><span class="p">)</span><span class="p">;</span>
       n<span class="p">.</span>textContent <span class="o">=</span> <span class="s1">'&lt;'</span> <span class="o">+</span> name <span class="o">+</span> <span class="s1">'> '</span><span class="p">;</span>
       p<span class="p">.</span>appendChild<span class="p">(</span>n<span class="p">)</span><span class="p">;</span>
       <span class="kd">var</span> t <span class="o">=</span> document<span class="p">.</span>createElement<span class="p">(</span><span class="s1">'span'</span><span class="p">)</span><span class="p">;</span>
       t<span class="p">.</span>textContent <span class="o">=</span> message<span class="p">;</span>
       p<span class="p">.</span>appendChild<span class="p">(</span>t<span class="p">)</span><span class="p">;</span>
       div<span class="p">.</span>appendChild<span class="p">(</span>p<span class="p">)</span><span class="p">;</span>
     <span class="p">}</span><span class="p">;</span>
     port<span class="p">.</span>onmessage <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span>event<span class="p">)</span> <span class="p">{</span>
       addMessage<span class="p">(</span>name<span class="p">,</span> event<span class="p">.</span>data<span class="p">)</span><span class="p">;</span>
     <span class="p">}</span><span class="p">;</span>
     li<span class="p">.</span>appendChild<span class="p">(</span>div<span class="p">)</span><span class="p">;</span>
     <span class="kd">var</span> form <span class="o">=</span> document<span class="p">.</span>createElement<span class="p">(</span><span class="s1">'form'</span><span class="p">)</span><span class="p">;</span>
     <span class="kd">var</span> p <span class="o">=</span> document<span class="p">.</span>createElement<span class="p">(</span><span class="s1">'p'</span><span class="p">)</span><span class="p">;</span>
     <span class="kd">var</span> input <span class="o">=</span> document<span class="p">.</span>createElement<span class="p">(</span><span class="s1">'input'</span><span class="p">)</span><span class="p">;</span>
     input<span class="p">.</span>size <span class="o">=</span> <span class="mi">50</span><span class="p">;</span>
     p<span class="p">.</span>appendChild<span class="p">(</span>input<span class="p">)</span><span class="p">;</span>
     p<span class="p">.</span>appendChild<span class="p">(</span>document<span class="p">.</span>createTextNode<span class="p">(</span><span class="s1">' '</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
     <span class="kd">var</span> button <span class="o">=</span> document<span class="p">.</span>createElement<span class="p">(</span><span class="s1">'button'</span><span class="p">)</span><span class="p">;</span>
     button<span class="p">.</span>textContent <span class="o">=</span> <span class="s1">'Post'</span><span class="p">;</span>
     p<span class="p">.</span>appendChild<span class="p">(</span>button<span class="p">)</span><span class="p">;</span>
     form<span class="p">.</span>onsubmit <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="p">)</span> <span class="p">{</span>
       port<span class="p">.</span>postMessage<span class="p">(</span>input<span class="p">.</span>value<span class="p">)</span><span class="p">;</span>
       addMessage<span class="p">(</span><span class="s1">'me'</span><span class="p">,</span> input<span class="p">.</span>value<span class="p">)</span><span class="p">;</span>
       input<span class="p">.</span>value <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
       <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
     <span class="p">}</span><span class="p">;</span>
     form<span class="p">.</span>appendChild<span class="p">(</span>p<span class="p">)</span><span class="p">;</span>
     li<span class="p">.</span>appendChild<span class="p">(</span>form<span class="p">)</span><span class="p">;</span>
     ul<span class="p">.</span>appendChild<span class="p">(</span>li<span class="p">)</span><span class="p">;</span>
   <span class="p">}</span>
   worker<span class="p">.</span>port<span class="p">.</span>addEventListener<span class="p">(</span><span class="s1">'message'</span><span class="p">,</span> startPrivateChat<span class="p">,</span> <span class="kc">false</span><span class="p">)</span><span class="p">;</span>

   worker<span class="p">.</span>port<span class="p">.</span>start<span class="p">(</span><span class="p">)</span><span class="p">;</span>
  <span class="p">&lt;</span><span class="p">/</span><span class="nt">script</span><span class="p">></span>
 <span class="p">&lt;</span><span class="p">/</span><span class="nt">head</span><span class="p">></span>
 <span class="p">&lt;</span><span class="nt">body</span><span class="p">></span>
  <span class="p">&lt;</span><span class="nt">h1</span><span class="p">></span>Viewer<span class="p">&lt;</span><span class="p">/</span><span class="nt">h1</span><span class="p">></span>
  <span class="p">&lt;</span><span class="nt">h2</span><span class="p">></span>Map<span class="p">&lt;</span><span class="p">/</span><span class="nt">h2</span><span class="p">></span>
  <span class="p">&lt;</span><span class="nt">p</span><span class="p">></span><span class="p">&lt;</span><span class="nt">canvas</span> <span class="na">id</span><span class="o">=</span><span class="s">"map"</span> <span class="na">height</span><span class="o">=</span><span class="s">150</span> <span class="na">width</span><span class="o">=</span><span class="s">150</span><span class="p">></span><span class="p">&lt;</span><span class="p">/</span><span class="nt">canvas</span><span class="p">></span><span class="p">&lt;</span><span class="p">/</span><span class="nt">p</span><span class="p">></span>
  <span class="p">&lt;</span><span class="nt">p</span><span class="p">></span>
   <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">button</span> <span class="na">onclick</span><span class="o">=</span><span class="s">"worker.port.postMessage('mov left')"</span><span class="p">></span>Left<span class="p">&lt;</span><span class="p">/</span><span class="nt">button</span><span class="p">></span>
   <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">button</span> <span class="na">onclick</span><span class="o">=</span><span class="s">"worker.port.postMessage('mov up')"</span><span class="p">></span>Up<span class="p">&lt;</span><span class="p">/</span><span class="nt">button</span><span class="p">></span>
   <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">button</span> <span class="na">onclick</span><span class="o">=</span><span class="s">"worker.port.postMessage('mov down')"</span><span class="p">></span>Down<span class="p">&lt;</span><span class="p">/</span><span class="nt">button</span><span class="p">></span>
   <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">button</span> <span class="na">onclick</span><span class="o">=</span><span class="s">"worker.port.postMessage('mov right')"</span><span class="p">></span>Right<span class="p">&lt;</span><span class="p">/</span><span class="nt">button</span><span class="p">></span>
   <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">button</span> <span class="na">onclick</span><span class="o">=</span><span class="s">"worker.port.postMessage('set 0')"</span><span class="p">></span>Set 0<span class="p">&lt;</span><span class="p">/</span><span class="nt">button</span><span class="p">></span>
   <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">button</span> <span class="na">onclick</span><span class="o">=</span><span class="s">"worker.port.postMessage('set 1')"</span><span class="p">></span>Set 1<span class="p">&lt;</span><span class="p">/</span><span class="nt">button</span><span class="p">></span>
  <span class="p">&lt;</span><span class="p">/</span><span class="nt">p</span><span class="p">></span>
  <span class="p">&lt;</span><span class="nt">h2</span><span class="p">></span>Public Chat<span class="p">&lt;</span><span class="p">/</span><span class="nt">h2</span><span class="p">></span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">"public"</span><span class="p">></span><span class="p">&lt;</span><span class="p">/</span><span class="nt">div</span><span class="p">></span>
  <span class="p">&lt;</span><span class="nt">form</span> <span class="na">onsubmit</span><span class="o">=</span><span class="s">"worker.port.postMessage('txt ' + message.value); message.value = ''; return false;"</span><span class="p">></span>
   <span class="p">&lt;</span><span class="nt">p</span><span class="p">></span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">"text"</span> <span class="na">name</span><span class="o">=</span><span class="s">"message"</span> <span class="na">size</span><span class="o">=</span><span class="s">"50"</span><span class="p">></span>
    <span class="p">&lt;</span><span class="nt">button</span><span class="p">></span>Post<span class="p">&lt;</span><span class="p">/</span><span class="nt">button</span><span class="p">></span>
   <span class="p">&lt;</span><span class="p">/</span><span class="nt">p</span><span class="p">></span>
  <span class="p">&lt;</span><span class="p">/</span><span class="nt">form</span><span class="p">></span>
  <span class="p">&lt;</span><span class="nt">h2</span><span class="p">></span>Private Chat<span class="p">&lt;</span><span class="p">/</span><span class="nt">h2</span><span class="p">></span>
  <span class="p">&lt;</span><span class="nt">ul</span> <span class="na">id</span><span class="o">=</span><span class="s">"private"</span><span class="p">></span><span class="p">&lt;</span><span class="p">/</span><span class="nt">ul</span><span class="p">></span>
 <span class="p">&lt;</span><span class="p">/</span><span class="nt">body</span><span class="p">></span>
<span class="p">&lt;</span><span class="p">/</span><span class="nt">html</span><span class="p">></span>
</pre>
   <p>There are several key things worth noting about the way the viewer is written.</p>
   <p>Multiple listeners. Instead of a single message processing function, the code
here attaches multiple event listeners, each one performing a quick check to
see if it is relevant for the message. In this example it doesn’t make much
difference, but if multiple authors wanted to collaborate using a single port
to communicate with a worker, it would allow for independent code instead of
changes having to all be made to a single event handling function.</p>
   <p>Registering event listeners in this way also allows you to unregister
specific listeners when you are done with them, as is done with the
configure() method in this example. (FIXME: configure() method doesn’t exist...)</p>
   <p>Finally, the worker:</p>
<pre class="example lang-js highlight" id="example-5bfa3959"><a class="self-link" href="#example-5bfa3959"></a><span class="kd">var</span> nextName <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kd">function</span> getNextName<span class="p">(</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// This could use more friendly names
</span>  <span class="c1">// But for now just return a number
</span>  <span class="k">return</span> nextName<span class="o">++</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">var</span> map <span class="o">=</span> <span class="p">[</span>
 <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="p">,</span>
 <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="p">,</span>
 <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="p">,</span>
 <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="p">,</span>
 <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="p">,</span>
 <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="p">,</span>
 <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="p">,</span>
<span class="p">]</span><span class="p">;</span>

<span class="kd">function</span> wrapX<span class="p">(</span>x<span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span>x <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> wrapX<span class="p">(</span>x <span class="o">+</span> map<span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="p">.</span>length<span class="p">)</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span>x <span class="o">>=</span> map<span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="p">.</span>length<span class="p">)</span> <span class="k">return</span> wrapX<span class="p">(</span>x <span class="o">-</span> map<span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="p">.</span>length<span class="p">)</span><span class="p">;</span>
  <span class="k">return</span> x<span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> wrapY<span class="p">(</span>y<span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span>y <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> wrapY<span class="p">(</span>y <span class="o">+</span> map<span class="p">.</span>length<span class="p">)</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span>y <span class="o">>=</span> map<span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="p">.</span>length<span class="p">)</span> <span class="k">return</span> wrapY<span class="p">(</span>y <span class="o">-</span> map<span class="p">.</span>length<span class="p">)</span><span class="p">;</span>
  <span class="k">return</span> y<span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> wrap<span class="p">(</span>val<span class="p">,</span> min<span class="p">,</span> max<span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span>val <span class="o">&lt;</span> min<span class="p">)</span>
    <span class="k">return</span> val <span class="o">+</span> <span class="p">(</span>max<span class="o">-</span>min<span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span>val <span class="o">></span> max<span class="p">)</span>
    <span class="k">return</span> val <span class="o">-</span> <span class="p">(</span>max<span class="o">-</span>min<span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="k">return</span> val<span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> sendMapData<span class="p">(</span>viewer<span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> data <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> y <span class="o">=</span> viewer<span class="p">.</span>y<span class="o">-</span><span class="mi">1</span><span class="p">;</span> y <span class="o">&lt;=</span> viewer<span class="p">.</span>y<span class="o">+</span><span class="mi">1</span><span class="p">;</span> y <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> x <span class="o">=</span> viewer<span class="p">.</span>x<span class="o">-</span><span class="mi">1</span><span class="p">;</span> x <span class="o">&lt;=</span> viewer<span class="p">.</span>x<span class="o">+</span><span class="mi">1</span><span class="p">;</span> x <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span>data <span class="o">!=</span> <span class="s1">''</span><span class="p">)</span>
        data <span class="o">+=</span> <span class="s1">','</span><span class="p">;</span>
      data <span class="o">+=</span> map<span class="p">[</span>wrap<span class="p">(</span>y<span class="p">,</span> <span class="mi">0</span><span class="p">,</span> map<span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="p">.</span>length<span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="p">]</span><span class="p">[</span>wrap<span class="p">(</span>x<span class="p">,</span> <span class="mi">0</span><span class="p">,</span> map<span class="p">.</span>length<span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="p">]</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  viewer<span class="p">.</span>port<span class="p">.</span>postMessage<span class="p">(</span><span class="s1">'map '</span> <span class="o">+</span> data<span class="p">)</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">var</span> viewers <span class="o">=</span> <span class="p">{</span><span class="p">}</span><span class="p">;</span>
onconnect <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span>event<span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> name <span class="o">=</span> getNextName<span class="p">(</span><span class="p">)</span><span class="p">;</span>
  event<span class="p">.</span>ports<span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="p">.</span>_data <span class="o">=</span> <span class="p">{</span> port<span class="o">:</span> event<span class="p">.</span>ports<span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="p">,</span> name<span class="o">:</span> name<span class="p">,</span> x<span class="o">:</span> <span class="mi">0</span><span class="p">,</span> y<span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="p">}</span><span class="p">;</span>
  viewers<span class="p">[</span>name<span class="p">]</span> <span class="o">=</span> event<span class="p">.</span>ports<span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="p">.</span>_data<span class="p">;</span>
  event<span class="p">.</span>ports<span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="p">.</span>postMessage<span class="p">(</span><span class="s1">'cfg '</span> <span class="o">+</span> name<span class="p">)</span><span class="p">;</span>
  event<span class="p">.</span>ports<span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="p">.</span>onmessage <span class="o">=</span> getMessage<span class="p">;</span>
  sendMapData<span class="p">(</span>event<span class="p">.</span>ports<span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="p">.</span>_data<span class="p">)</span><span class="p">;</span>
<span class="p">}</span><span class="p">;</span>

<span class="kd">function</span> getMessage<span class="p">(</span>event<span class="p">)</span> <span class="p">{</span>
  <span class="k">switch</span> <span class="p">(</span>event<span class="p">.</span>data<span class="p">.</span>substr<span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="s1">'mov '</span><span class="o">:</span>
      <span class="kd">var</span> direction <span class="o">=</span> event<span class="p">.</span>data<span class="p">.</span>substr<span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="p">;</span>
      <span class="kd">var</span> dx <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="kd">var</span> dy <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">switch</span> <span class="p">(</span>direction<span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="s1">'up'</span><span class="o">:</span> dy <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="s1">'down'</span><span class="o">:</span> dy <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="s1">'left'</span><span class="o">:</span> dx <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="s1">'right'</span><span class="o">:</span> dx <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>
      event<span class="p">.</span>target<span class="p">.</span>_data<span class="p">.</span>x <span class="o">=</span> wrapX<span class="p">(</span>event<span class="p">.</span>target<span class="p">.</span>_data<span class="p">.</span>x <span class="o">+</span> dx<span class="p">)</span><span class="p">;</span>
      event<span class="p">.</span>target<span class="p">.</span>_data<span class="p">.</span>y <span class="o">=</span> wrapY<span class="p">(</span>event<span class="p">.</span>target<span class="p">.</span>_data<span class="p">.</span>y <span class="o">+</span> dy<span class="p">)</span><span class="p">;</span>
      sendMapData<span class="p">(</span>event<span class="p">.</span>target<span class="p">.</span>_data<span class="p">)</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="s1">'set '</span><span class="o">:</span>
      <span class="kd">var</span> value <span class="o">=</span> event<span class="p">.</span>data<span class="p">.</span>substr<span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="p">;</span>
      map<span class="p">[</span>event<span class="p">.</span>target<span class="p">.</span>_data<span class="p">.</span>y<span class="p">]</span><span class="p">[</span>event<span class="p">.</span>target<span class="p">.</span>_data<span class="p">.</span>x<span class="p">]</span> <span class="o">=</span> value<span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> viewer <span class="k">in</span> viewers<span class="p">)</span>
        sendMapData<span class="p">(</span>viewers<span class="p">[</span>viewer<span class="p">]</span><span class="p">)</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="s1">'txt '</span><span class="o">:</span>
      <span class="kd">var</span> name <span class="o">=</span> event<span class="p">.</span>target<span class="p">.</span>_data<span class="p">.</span>name<span class="p">;</span>
      <span class="kd">var</span> message <span class="o">=</span> event<span class="p">.</span>data<span class="p">.</span>substr<span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> viewer <span class="k">in</span> viewers<span class="p">)</span>
        viewers<span class="p">[</span>viewer<span class="p">]</span><span class="p">.</span>port<span class="p">.</span>postMessage<span class="p">(</span><span class="s1">'txt '</span> <span class="o">+</span> name <span class="o">+</span> <span class="s1">' '</span> <span class="o">+</span> message<span class="p">)</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="s1">'msg '</span><span class="o">:</span>
      <span class="kd">var</span> party1 <span class="o">=</span> event<span class="p">.</span>target<span class="p">.</span>_data<span class="p">;</span>
      <span class="kd">var</span> party2 <span class="o">=</span> viewers<span class="p">[</span>event<span class="p">.</span>data<span class="p">.</span>substr<span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="p">.</span>split<span class="p">(</span><span class="s1">' '</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="p">]</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span>party2<span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> channel <span class="o">=</span> <span class="k">new</span> MessageChannel<span class="p">(</span><span class="p">)</span><span class="p">;</span>
        party1<span class="p">.</span>port<span class="p">.</span>postMessage<span class="p">(</span><span class="s1">'msg '</span> <span class="o">+</span> party2<span class="p">.</span>name<span class="p">,</span> <span class="p">[</span>channel<span class="p">.</span>port1<span class="p">]</span><span class="p">)</span><span class="p">;</span>
        party2<span class="p">.</span>port<span class="p">.</span>postMessage<span class="p">(</span><span class="s1">'msg '</span> <span class="o">+</span> party1<span class="p">.</span>name<span class="p">,</span> <span class="p">[</span>channel<span class="p">.</span>port2<span class="p">]</span><span class="p">)</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre>
   <p>Connecting to multiple pages. The script uses the <code class="idl"><a data-link-type="idl" href="#dom-sharedworkerglobalscope-onconnect" id="ref-for-dom-sharedworkerglobalscope-onconnect-1">onconnect</a></code> event listener
to listen for multiple connections.</p>
   <p>Direct channels. When the worker receives a "msg" message from one viewer
naming another viewer, it sets up a direct connection between the two, so
that the two viewers can communicate directly without the worker having to
proxy all the messages.</p>
   <p><a href="https://www.whatwg.org/demos/workers/multiviewer/page.html"> View this example online. </a></p>
   <h4 class="heading settled" data-level="1.2.5" id="examples-5"><span class="secno">1.2.5. </span><span class="content">Delegation</span><a class="self-link" href="#examples-5"></a></h4>
   <p><em>This section is non-normative.</em></p>
   <p>With multicore CPUs becoming prevalent, one way to obtain better performance
is to split computationally expensive tasks amongst multiple workers. In this
example, a computationally expensive task that is to be performed for every
number from 1 to 10,000,000 is farmed out to ten subworkers.</p>
   <p>The main page is as follows, it just reports the result:</p>
<pre class="example lang-html highlight" id="example-02ec9ddd"><a class="self-link" href="#example-02ec9ddd"></a><span class="cp">&lt;!DOCTYPE HTML></span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">></span>
 <span class="p">&lt;</span><span class="nt">head</span><span class="p">></span>
  <span class="p">&lt;</span><span class="nt">title</span><span class="p">></span>Worker example: Multicore computation<span class="p">&lt;</span><span class="p">/</span><span class="nt">title</span><span class="p">></span>
 <span class="p">&lt;</span><span class="p">/</span><span class="nt">head</span><span class="p">></span>
 <span class="p">&lt;</span><span class="nt">body</span><span class="p">></span>
  <span class="p">&lt;</span><span class="nt">p</span><span class="p">></span>Result: <span class="p">&lt;</span><span class="nt">output</span> <span class="na">id</span><span class="o">=</span><span class="s">"result"</span><span class="p">></span><span class="p">&lt;</span><span class="p">/</span><span class="nt">output</span><span class="p">></span><span class="p">&lt;</span><span class="p">/</span><span class="nt">p</span><span class="p">></span>
  <span class="p">&lt;</span><span class="nt">script</span><span class="p">></span>
   <span class="kd">var</span> worker <span class="o">=</span> <span class="k">new</span> Worker<span class="p">(</span><span class="s1">'worker.js'</span><span class="p">)</span><span class="p">;</span>
   worker<span class="p">.</span>onmessage <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span>event<span class="p">)</span> <span class="p">{</span>
     document<span class="p">.</span>getElementById<span class="p">(</span><span class="s1">'result'</span><span class="p">)</span><span class="p">.</span>textContent <span class="o">=</span> event<span class="p">.</span>data<span class="p">;</span>
   <span class="p">}</span><span class="p">;</span>
  <span class="p">&lt;</span><span class="p">/</span><span class="nt">script</span><span class="p">></span>
 <span class="p">&lt;</span><span class="p">/</span><span class="nt">body</span><span class="p">></span>
<span class="p">&lt;</span><span class="p">/</span><span class="nt">html</span><span class="p">></span>
</pre>
   <p>The worker itself is as follows:</p>
<pre class="example lang-js highlight" id="example-c374d6f2"><a class="self-link" href="#example-c374d6f2"></a><span class="c1">// Settings
</span><span class="kd">var</span> num_workers <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
<span class="kd">var</span> items_per_worker <span class="o">=</span> <span class="mi">1000000</span><span class="p">;</span>

<span class="c1">// Start the workers
</span><span class="kd">var</span> result <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kd">var</span> pending_workers <span class="o">=</span> num_workers<span class="p">;</span>
<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> i <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> i <span class="o">&lt;</span> num_workers<span class="p">;</span> i <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> worker <span class="o">=</span> <span class="k">new</span> Worker<span class="p">(</span><span class="s1">'core.js'</span><span class="p">)</span><span class="p">;</span>
  worker<span class="p">.</span>postMessage<span class="p">(</span>i <span class="o">*</span> items_per_worker<span class="p">)</span><span class="p">;</span>
  worker<span class="p">.</span>postMessage<span class="p">(</span><span class="p">(</span>i<span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> items_per_worker<span class="p">)</span><span class="p">;</span>
  worker<span class="p">.</span>onmessage <span class="o">=</span> storeResult<span class="p">;</span>
<span class="p">}</span>

<span class="c1">// handle the results
</span><span class="kd">function</span> storeResult<span class="p">(</span>event<span class="p">)</span> <span class="p">{</span>
  result <span class="o">+=</span> <span class="mi">1</span><span class="o">*</span>event<span class="p">.</span>data<span class="p">;</span>
  pending_workers <span class="o">-=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span>pending_workers <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span>
    postMessage<span class="p">(</span>result<span class="p">)</span><span class="p">;</span> <span class="c1">// Finished!
</span><span class="p">}</span>
</pre>
   <p>It consists of a loop to start the subworkers, and then a handler that waits
for all the subworkers to respond.</p>
   <p>The subworkers are implemented as follows:</p>
<pre class="example lang-js highlight" id="example-a2bf8ff1"><a class="self-link" href="#example-a2bf8ff1"></a><span class="kd">var</span> start<span class="p">;</span>
onmessage <span class="o">=</span> getStart<span class="p">;</span>
<span class="kd">function</span> getStart<span class="p">(</span>event<span class="p">)</span> <span class="p">{</span>
  start <span class="o">=</span> <span class="mi">1</span><span class="o">*</span>event<span class="p">.</span>data<span class="p">;</span>
  <span class="p">{</span><span class="p">{</span>onmessage<span class="p">}</span><span class="p">}</span> <span class="o">=</span> getEnd<span class="p">;</span>
<span class="p">}</span>

<span class="kd">var</span> end<span class="p">;</span>
<span class="kd">function</span> getEnd<span class="p">(</span>event<span class="p">)</span> <span class="p">{</span>
  end <span class="o">=</span> <span class="mi">1</span><span class="o">*</span>event<span class="p">.</span>data<span class="p">;</span>
  <span class="p">{</span><span class="p">{</span>onmessage<span class="p">}</span><span class="p">}</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  work<span class="p">(</span><span class="p">)</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> work<span class="p">(</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> result <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> i <span class="o">=</span> start<span class="p">;</span> i <span class="o">&lt;</span> end<span class="p">;</span> i <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Perform some complex calculation here
</span>    result <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  postMessage<span class="p">(</span>result<span class="p">)</span><span class="p">;</span>
  close<span class="p">(</span><span class="p">)</span><span class="p">;</span>
<span class="p">}</span>
</pre>
   <p>They receive two numbers in two events, perform the computation for the range
of numbers thus specified, and then report the result back to the parent.</p>
   <p><a href="https://www.whatwg.org/demos/workers/multicore/page.html"> View this example online. </a></p>
   <h3 class="heading settled" data-level="1.3" id="tutorials"><span class="secno">1.3. </span><span class="content">Tutorials</span><a class="self-link" href="#tutorials"></a></h3>
   <h4 class="heading settled" data-level="1.3.1" id="tutorial-1"><span class="secno">1.3.1. </span><span class="content">Creating a dedicated worker</span><a class="self-link" href="#tutorial-1"></a></h4>
   <p><em>This section is non-normative.</em></p>
   <p>Creating a worker requires a URL to a JavaScript file. The <code class="idl"><a data-link-type="idl" href="#dom-worker-worker" id="ref-for-dom-worker-worker-1">Worker()</a></code> constructor is invoked with the URL to that file as its only argument; a
worker is then created and returned:</p>
<pre class="example lang-js highlight" id="example-72d8b534"><a class="self-link" href="#example-72d8b534"></a><span class="kd">var</span> worker <span class="o">=</span> <span class="k">new</span> Worker<span class="p">(</span><span class="s1">'helper.js'</span><span class="p">)</span><span class="p">;</span>
</pre>
   <h4 class="heading settled" data-level="1.3.2" id="tutorial-2"><span class="secno">1.3.2. </span><span class="content">Communicating with a dedicated worker</span><a class="self-link" href="#tutorial-2"></a></h4>
   <p><em>This section is non-normative.</em></p>
   <p>Dedicated workers use <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#messageport">MessagePort</a></code> objects behind the scenes, and thus
support all the same features, such as sending structured data, transferring
binary data, and transferring other ports.</p>
   <p>To receive messages from a dedicated worker, use the <code class="idl"><a data-link-type="idl" href="#dom-dedicatedworkerglobalscope-onmessage" id="ref-for-dom-dedicatedworkerglobalscope-onmessage-2">onmessage</a></code> event
handler IDL attribute on the <code class="idl"><a data-link-type="idl" href="#worker" id="ref-for-worker-5">Worker</a></code> object:</p>
<pre class="example lang-js highlight" id="example-3839641d"><a class="self-link" href="#example-3839641d"></a>worker<span class="p">.</span>onmessage <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span>event<span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span><span class="p">;</span>
</pre>
   <p>You can also use the <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#dom-eventtarget-addeventlistener">addEventListener()</a></code> method.</p>
   <p class="note" role="note"> The implicit <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#messageport">MessagePort</a></code> used by dedicated workers has its port message
queue implicitly enabled when it is created, so there is no equivalent to the
MessagePort interface’s <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#dom-messageport-start">start()</a></code> method on the <code class="idl"><a data-link-type="idl" href="#worker" id="ref-for-worker-6">Worker</a></code> interface. </p>
   <p>To send data to a worker, use the <code class="idl"><a data-link-type="idl" href="#dom-dedicatedworkerglobalscope-postmessage" id="ref-for-dom-dedicatedworkerglobalscope-postmessage-2">postMessage()</a></code> method. Structured data
can be sent over this communication channel. To send <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-ArrayBuffer">ArrayBuffer</a></code> objects
efficiently (by transferring them rather than cloning them), list them in an
array in the second argument.</p>
<pre class="example lang-js highlight" id="example-b15cd20d"><a class="self-link" href="#example-b15cd20d"></a>worker<span class="p">.</span>postMessage<span class="p">(</span><span class="p">{</span>
  operation<span class="o">:</span> <span class="s1">'find-edges'</span><span class="p">,</span>
  input<span class="o">:</span> buffer<span class="p">,</span> <span class="c1">// An {{ArrayBuffer}} object
</span>  threshold<span class="o">:</span> <span class="mf">0.6</span><span class="p">,</span>
<span class="p">}</span><span class="p">,</span> <span class="p">[</span>buffer<span class="p">]</span><span class="p">)</span><span class="p">;</span>
</pre>
   <p>To receive a message inside the worker, the <code class="idl"><a data-link-type="idl" href="#dom-dedicatedworkerglobalscope-onmessage" id="ref-for-dom-dedicatedworkerglobalscope-onmessage-3">onmessage</a></code> event handler IDL
attribute is used.</p>
<pre class="example lang-js highlight" id="example-808cf9ac"><a class="self-link" href="#example-808cf9ac"></a>onmessage <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span>event<span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span><span class="p">;</span>
</pre>
   <p>You can again also use the <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#dom-eventtarget-addeventlistener">addEventListener()</a></code> method.</p>
   <p>In either case, the data is provided in the event object’s data attribute.</p>
   <p>To send messages back, you again use postMessage(). It supports the
structured data in the same manner.</p>
<pre class="example lang-js highlight" id="example-63961be0"><a class="self-link" href="#example-63961be0"></a>postMessage<span class="p">(</span>event<span class="p">.</span>data<span class="p">.</span>input<span class="p">,</span> <span class="p">[</span>event<span class="p">.</span>data<span class="p">.</span>input<span class="p">]</span><span class="p">)</span><span class="p">;</span> <span class="c1">// Transfer the buffer back
</span></pre>
   <h4 class="heading settled" data-level="1.3.3" id="tutorial-3"><span class="secno">1.3.3. </span><span class="content">Shared workers</span><a class="self-link" href="#tutorial-3"></a></h4>
   <p><em>This section is non-normative.</em></p>
   <p>Shared workers are identified by the URL of the script used to create it,
optionally with an explicit name. The name allows multiple instances of a
particular shared worker to be started.</p>
   <p>Shared workers are scoped by origin. Two different sites using the same names
will not collide. However, if a page tries to use the same shared worker name
as another page on the same site, but with a different script URL, it will
fail.</p>
   <p>Creating shared workers is done using the <code class="idl"><a data-link-type="idl" href="#dom-sharedworker-sharedworker" id="ref-for-dom-sharedworker-sharedworker-1">SharedWorker()</a></code> constructor. This
constructor takes the URL to the script to use for its first argument, and
the name of the worker, if any, as the second argument.</p>
<pre class="example lang-js highlight" id="example-ee49a0bc"><a class="self-link" href="#example-ee49a0bc"></a><span class="kd">var</span> worker <span class="o">=</span> <span class="k">new</span> SharedWorker<span class="p">(</span><span class="s1">'service.js'</span><span class="p">)</span><span class="p">;</span>
</pre>
   <p>Communicating with shared workers is done with explicit <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#messageport">MessagePort</a></code> objects. The object returned by the SharedWorker() constructor holds a
reference to the port on its port attribute.</p>
<pre class="example lang-js highlight" id="example-5a910211"><a class="self-link" href="#example-5a910211"></a>worker<span class="p">.</span>port<span class="p">.</span>onmessage <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span>event<span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span><span class="p">;</span>
worker<span class="p">.</span>port<span class="p">.</span>postMessage<span class="p">(</span><span class="s1">'some message'</span><span class="p">)</span><span class="p">;</span>
worker<span class="p">.</span>port<span class="p">.</span>postMessage<span class="p">(</span><span class="p">{</span> foo<span class="o">:</span> <span class="s1">'structured'</span><span class="p">,</span> bar<span class="o">:</span> <span class="p">[</span><span class="s1">'data'</span><span class="p">,</span> <span class="s1">'also'</span><span class="p">,</span> <span class="s1">'possible'</span><span class="p">]</span><span class="p">}</span><span class="p">)</span><span class="p">;</span>
</pre>
   <p>Inside the shared worker, new clients of the worker are announced using the
connect event. The port for the new client is given by the event object’s
source attribute.</p>
<pre class="example lang-js highlight" id="example-3492db3d"><a class="self-link" href="#example-3492db3d"></a>onconnect <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span>event<span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> newPort <span class="o">=</span> event<span class="p">.</span>source<span class="p">;</span>
  <span class="c1">// Setup a listener
</span>  newPort<span class="p">.</span>onmessage <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span>event<span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span><span class="p">;</span>
  <span class="c1">// Send a message back to the port
</span>  newPort<span class="p">.</span>postMessage<span class="p">(</span><span class="s1">'ready!'</span><span class="p">)</span><span class="p">;</span> <span class="c1">// Can also send structured data
</span><span class="p">}</span><span class="p">;</span>
</pre>
   <h2 class="heading settled" data-level="2" id="terminology"><span class="secno">2. </span><span class="content">Terminology</span><a class="self-link" href="#terminology"></a></h2>
   <p>The construction "a Foo object", where Foo is actually an interface, is
sometimes used instead of the more accurate "an object implementing the
interface Foo".</p>
   <p>The term DOM is used to refer to the API set made available to scripts in Web
applications, and does not necessarily imply the existence of an actual
Document object or of any other Node objects as defined in the DOM
specifications. <a data-link-type="biblio" href="#biblio-dom">[DOM]</a></p>
   <p>An IDL attribute is said to be getting when its value is being retrieved
(e.g. by author script), and is said to be setting when a new value is
assigned to it.</p>
   <p>The term "JavaScript" is used to refer to ECMA262, rather than the official
term ECMAScript, since the term JavaScript is more widely known. <a data-link-type="biblio" href="#biblio-ecma-262">[ECMA-262]</a></p>
   <h2 class="heading settled" data-level="3" id="infrastructure"><span class="secno">3. </span><span class="content">Infrastructure</span><a class="self-link" href="#infrastructure"></a></h2>
   <p>There are two kinds of workers; dedicated workers, and shared workers.
Dedicated workers, once created, are linked to their creator; but message
ports can be used to communicate from a dedicated worker to multiple other
browsing contexts or workers. Shared workers, on the other hand, are named,
and once created any script running in the same origin can obtain a reference
to that worker and communicate with it.</p>
   <h3 class="heading settled" data-level="3.1" id="global-scope"><span class="secno">3.1. </span><span class="content">The global scope</span><a class="self-link" href="#global-scope"></a></h3>
   <p>The global scope is the "inside" of a worker.</p>
   <h4 class="heading settled" data-level="3.1.1" id="workerglobalscope"><span class="secno">3.1.1. </span><span class="content">The <code class="idl"><a data-link-type="idl" href="#workerglobalscope0" id="ref-for-workerglobalscope0-1">WorkerGlobalScope</a></code> common interface</span><a class="self-link" href="#workerglobalscope"></a></h4>
<pre class="idl highlight def">[<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed">Exposed</a>=<span class="n">Worker</span>]
<span class="kt">interface</span> <dfn class="nv dfn-paneled idl-code" data-dfn-type="interface" data-export="" id="workerglobalscope0">WorkerGlobalScope</dfn> : <a class="n" data-link-type="idl-name" href="https://dom.spec.whatwg.org/#eventtarget">EventTarget</a> {
  <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="#workerglobalscope0" id="ref-for-workerglobalscope0-2">WorkerGlobalScope</a> <dfn class="nv dfn-paneled idl-code" data-dfn-for="WorkerGlobalScope" data-dfn-type="attribute" data-export="" data-readonly="" data-type="WorkerGlobalScope" id="dom-workerglobalscope-self">self</dfn>;
  <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="#workerlocation" id="ref-for-workerlocation-1">WorkerLocation</a> <dfn class="nv dfn-paneled idl-code" data-dfn-for="WorkerGlobalScope" data-dfn-type="attribute" data-export="" data-readonly="" data-type="WorkerLocation" id="dom-workerglobalscope-location">location</dfn>;

  <span class="kt">void</span> <dfn class="nv dfn-paneled idl-code" data-dfn-for="WorkerGlobalScope" data-dfn-type="method" data-export="" data-lt="close()" id="dom-workerglobalscope-close">close</dfn>();
           <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#onerroreventhandler">OnErrorEventHandler</a> <dfn class="nv idl-code" data-dfn-for="WorkerGlobalScope" data-dfn-type="attribute" data-export="" data-type="OnErrorEventHandler" id="dom-workerglobalscope-onerror">onerror<a class="self-link" href="#dom-workerglobalscope-onerror"></a></dfn>;
           <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler">EventHandler</a> <dfn class="nv idl-code" data-dfn-for="WorkerGlobalScope" data-dfn-type="attribute" data-export="" data-type="EventHandler" id="dom-workerglobalscope-onlanguagechange">onlanguagechange<a class="self-link" href="#dom-workerglobalscope-onlanguagechange"></a></dfn>;
           <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler">EventHandler</a> <dfn class="nv idl-code" data-dfn-for="WorkerGlobalScope" data-dfn-type="attribute" data-export="" data-type="EventHandler" id="dom-workerglobalscope-onoffline">onoffline<a class="self-link" href="#dom-workerglobalscope-onoffline"></a></dfn>;
           <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler">EventHandler</a> <dfn class="nv idl-code" data-dfn-for="WorkerGlobalScope" data-dfn-type="attribute" data-export="" data-type="EventHandler" id="dom-workerglobalscope-ononline">ononline<a class="self-link" href="#dom-workerglobalscope-ononline"></a></dfn>;
};
</pre>
   <p>The <code class="idl"><a data-link-type="idl" href="#dom-workerglobalscope-self" id="ref-for-dom-workerglobalscope-self-1">self</a></code> attribute must return the <code class="idl"><a data-link-type="idl" href="#workerglobalscope0" id="ref-for-workerglobalscope0-3">WorkerGlobalScope</a></code> object itself.</p>
   <p>The <code class="idl"><a data-link-type="idl" href="#dom-workerglobalscope-location" id="ref-for-dom-workerglobalscope-location-1">location</a></code> attribute must return the <code class="idl"><a data-link-type="idl" href="#workerlocation" id="ref-for-workerlocation-2">WorkerLocation</a></code> object created for
the <code class="idl"><a data-link-type="idl" href="#workerglobalscope0" id="ref-for-workerglobalscope0-4">WorkerGlobalScope</a></code> object when the worker was creatored. It represents
the absolute URL of the script that was used to initialise the worker, after
any redirects.</p>
   <p>When a script invokes the <code class="idl"><a data-link-type="idl" href="#dom-workerglobalscope-close" id="ref-for-dom-workerglobalscope-close-1">close()</a></code> method on a <code class="idl"><a data-link-type="idl" href="#workerglobalscope0" id="ref-for-workerglobalscope0-5">WorkerGlobalScope</a></code> object,
the user agent must run the following steps (atomically):</p>
   <ol>
    <li data-md="">
     <p>Discard any tasks that have been added to the <code class="idl"><a data-link-type="idl" href="#workerglobalscope0" id="ref-for-workerglobalscope0-6">WorkerGlobalScope</a></code> object’s event loop’s task queues.</p>
    <li data-md="">
     <p>Set the worker’s <code class="idl"><a data-link-type="idl" href="#workerglobalscope0" id="ref-for-workerglobalscope0-7">WorkerGlobalScope</a></code> object’s <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/workers.html#dom-workerglobalscope-closing">closing</a></code> flag to true.
(This prevents any further tasks from being queued.)</p>
   </ol>
   <p>The following are the event handlers (and their corresponding event handler
event types) that must be supported, as event handler IDL attributes, by
objects implementing the <code class="idl"><a data-link-type="idl" href="#workerglobalscope0" id="ref-for-workerglobalscope0-8">WorkerGlobalScope</a></code> interface:</p>
   <table>
    <thead>
     <tr>
      <th> <span title="event handlers">Event handler</span> 
      <th> <span>Event handler event type</span> 
    <tbody>
     <tr>
      <td> <dfn data-dfn-type="dfn" data-lt="onerror" data-noexport="" id="handler-workerglobalscope-onerror" title="handler-WorkerGlobalScope-onerror"> <code>onerror</code> <a class="self-link" href="#handler-workerglobalscope-onerror"></a></dfn> 
      <td> <code title="event-error">error</code> 
     <tr>
      <td> <dfn data-dfn-type="dfn" data-lt="onlanguagechange" data-noexport="" id="handler-workerglobalscope-onlanguagechange" title="handler-WorkerGlobalScope-onlanguagechange"> <code>onlanguagechange</code> <a class="self-link" href="#handler-workerglobalscope-onlanguagechange"></a></dfn> 
      <td> <code title="event-languagechange">languagechange</code> 
     <tr>
      <td> <dfn data-dfn-type="dfn" data-lt="onoffline" data-noexport="" id="handler-workerglobalscope-onoffline" title="handler-WorkerGlobalScope-onoffline"> <code>onoffline</code> <a class="self-link" href="#handler-workerglobalscope-onoffline"></a></dfn> 
      <td> <code title="event-offline">offline</code> 
     <tr>
      <td> <dfn data-dfn-type="dfn" data-lt="ononline" data-noexport="" id="handler-workerglobalscope-ononline" title="handler-WorkerGlobalScope-ononline"> <code>ononline</code> <a class="self-link" href="#handler-workerglobalscope-ononline"></a></dfn> 
      <td> <code title="event-online">online</code> 
   </table>
   <p class="note" role="note"> For <code>data:</code> URLs, this is the origin specified by the entry
  settings object when the constructor was called. For other URLs, this is the
  origin of the value of the absolute URL given in the worker’s location
  attribute. </p>
   <h4 class="heading settled" data-level="3.1.2" id="dedicated-workers"><span class="secno">3.1.2. </span><span class="content">Dedicated workers and the <code class="idl"><a data-link-type="idl" href="#dedicatedworkerglobalscope" id="ref-for-dedicatedworkerglobalscope-1">DedicatedWorkerGlobalScope</a></code> interface</span><a class="self-link" href="#dedicated-workers"></a></h4>
<pre class="idl highlight def">[<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Global">Global</a>=<a class="n" data-link-type="idl-name" href="#worker" id="ref-for-worker-7">Worker</a>,<a class="nv idl-code" data-link-type="extended-attribute">DedicatedWorker</a>]
/*sealed*/ <span class="kt">interface</span> <dfn class="nv dfn-paneled idl-code" data-dfn-type="interface" data-export="" id="dedicatedworkerglobalscope">DedicatedWorkerGlobalScope</dfn> : <a class="n" data-link-type="idl-name" href="#workerglobalscope0" id="ref-for-workerglobalscope0-9">WorkerGlobalScope</a> {
  <span class="kt">void</span> <dfn class="nv dfn-paneled idl-code" data-dfn-for="DedicatedWorkerGlobalScope" data-dfn-type="method" data-export="" data-lt="postMessage(message, transfer)|postMessage(message)" id="dom-dedicatedworkerglobalscope-postmessage">postMessage</dfn>(<span class="kt">any</span> <dfn class="nv idl-code" data-dfn-for="DedicatedWorkerGlobalScope/postMessage(message, transfer), DedicatedWorkerGlobalScope/postMessage(message)" data-dfn-type="argument" data-export="" id="dom-dedicatedworkerglobalscope-postmessage-message-transfer-message">message<a class="self-link" href="#dom-dedicatedworkerglobalscope-postmessage-message-transfer-message"></a></dfn>, <span class="kt">optional</span> <span class="kt">sequence</span>&lt;<a class="n" data-link-type="idl-name">Transferable</a>> <dfn class="nv idl-code" data-dfn-for="DedicatedWorkerGlobalScope/postMessage(message, transfer), DedicatedWorkerGlobalScope/postMessage(message)" data-dfn-type="argument" data-export="" id="dom-dedicatedworkerglobalscope-postmessage-message-transfer-transfer">transfer<a class="self-link" href="#dom-dedicatedworkerglobalscope-postmessage-message-transfer-transfer"></a></dfn>);
           <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler">EventHandler</a> <dfn class="nv dfn-paneled idl-code" data-dfn-for="DedicatedWorkerGlobalScope" data-dfn-type="attribute" data-export="" data-type="EventHandler" id="dom-dedicatedworkerglobalscope-onmessage">onmessage</dfn>;
};
</pre>
   <p><code class="idl"><a data-link-type="idl" href="#dedicatedworkerglobalscope" id="ref-for-dedicatedworkerglobalscope-2">DedicatedWorkerGlobalScope</a></code> objects act as if they had an implicit MessagePort
associated with them. This port is part of a channel that is set up when the
worker is created, but it is not exposed. This object must never be garbage
collected before the <code class="idl"><a data-link-type="idl" href="#dedicatedworkerglobalscope" id="ref-for-dedicatedworkerglobalscope-3">DedicatedWorkerGlobalScope</a></code> object.</p>
   <p>All messages received by that port must immediately be retargeted at the
DedicatedWorkerGlobalScope object.</p>
   <p>The <code class="idl"><a data-link-type="idl" href="#dom-dedicatedworkerglobalscope-postmessage" id="ref-for-dom-dedicatedworkerglobalscope-postmessage-3">postMessage()</a></code> method on <code class="idl"><a data-link-type="idl" href="#dedicatedworkerglobalscope" id="ref-for-dedicatedworkerglobalscope-4">DedicatedWorkerGlobalScope</a></code> objects must
act as if, when invoked, it immediately invoked the method of the same name on
the port, with the same arguments, and returned the same return value.</p>
   <p>The following are the event handlers (and their corresponding event handler
event types) that must be supported, as event handler IDL attributes, by
objects implementing the <code class="idl"><a data-link-type="idl" href="#dedicatedworkerglobalscope" id="ref-for-dedicatedworkerglobalscope-5">DedicatedWorkerGlobalScope</a></code> interface:</p>
   <table>
    <thead>
     <tr>
      <th> <span title="event handlers">Event handler</span> 
      <th> <span>Event handler event type</span> 
    <tbody>
     <tr>
      <td> <dfn data-dfn-type="dfn" data-lt="onmessage" data-noexport="" id="handler-dedicatedworkerglobalscope-onmessage" title="handler-DedicatedWorkerGlobalScope-onmessage"> <code>onmessage</code> <a class="self-link" href="#handler-dedicatedworkerglobalscope-onmessage"></a></dfn> 
      <td> <code title="event-message">message</code> 
   </table>
   <p>For the purposes of the application cache networking model, a dedicated
worker is an extension of the cache host from which it was created.</p>
   <h4 class="heading settled" data-level="3.1.3" id="shared-workers"><span class="secno">3.1.3. </span><span class="content">Shared workers and the <code class="idl"><a data-link-type="idl" href="#sharedworkerglobalscope" id="ref-for-sharedworkerglobalscope-1">SharedWorkerGlobalScope</a></code> interface</span><a class="self-link" href="#shared-workers"></a></h4>
<pre class="idl highlight def">[<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Global">Global</a>=<a class="n" data-link-type="idl-name" href="#worker" id="ref-for-worker-8">Worker</a>,<a class="nv idl-code" data-link-type="extended-attribute">SharedWorker</a>]
/*sealed*/ <span class="kt">interface</span> <dfn class="nv dfn-paneled idl-code" data-dfn-type="interface" data-export="" id="sharedworkerglobalscope">SharedWorkerGlobalScope</dfn> : <a class="n" data-link-type="idl-name" href="#workerglobalscope0" id="ref-for-workerglobalscope0-10">WorkerGlobalScope</a> {
  <span class="kt">readonly</span> <span class="kt">attribute</span> <span class="kt">DOMString</span> <dfn class="nv idl-code" data-dfn-for="SharedWorkerGlobalScope" data-dfn-type="attribute" data-export="" data-readonly="" data-type="DOMString" id="dom-sharedworkerglobalscope-name">name<a class="self-link" href="#dom-sharedworkerglobalscope-name"></a></dfn>;
  <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/browsers.html#applicationcache">ApplicationCache</a> <dfn class="nv idl-code" data-dfn-for="SharedWorkerGlobalScope" data-dfn-type="attribute" data-export="" data-readonly="" data-type="ApplicationCache" id="dom-sharedworkerglobalscope-applicationcache">applicationCache<a class="self-link" href="#dom-sharedworkerglobalscope-applicationcache"></a></dfn>;
           <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler">EventHandler</a> <dfn class="nv dfn-paneled idl-code" data-dfn-for="SharedWorkerGlobalScope" data-dfn-type="attribute" data-export="" data-type="EventHandler" id="dom-sharedworkerglobalscope-onconnect">onconnect</dfn>;
};
</pre>
   <p>Shared workers receive message ports through connect events on their <code class="idl"><a data-link-type="idl" href="#sharedworkerglobalscope" id="ref-for-sharedworkerglobalscope-2">SharedWorkerGlobalScope</a></code> object for each connection.</p>
   <p>The name attribute must return the value it was assigned when the <code class="idl"><a data-link-type="idl" href="#sharedworkerglobalscope" id="ref-for-sharedworkerglobalscope-3">SharedWorkerGlobalScope</a></code> object was created by the "run a worker" algorithm.
Its value represents the name that can be used to obtain a reference to the
worker using the <code class="idl"><a data-link-type="idl" href="#sharedworker" id="ref-for-sharedworker-1">SharedWorker</a></code> constructor.</p>
   <p>The following are the event handlers (and their corresponding event handler
event types) that must be supported, as event handler IDL attributes, by
objects implementing the <code class="idl"><a data-link-type="idl" href="#sharedworkerglobalscope" id="ref-for-sharedworkerglobalscope-4">SharedWorkerGlobalScope</a></code> interface:</p>
   <table>
    <thead>
     <tr>
      <th> <span title="event handlers">Event handler</span> 
      <th> <span>Event handler event type</span> 
    <tbody>
     <tr>
      <td> <dfn data-dfn-type="dfn" data-lt="onconnect" data-noexport="" id="handler-sharedworkerglobalscope-onconnect" title="handler-SharedWorkerGlobalScope-onconnect"> <code>onconnect</code> <a class="self-link" href="#handler-sharedworkerglobalscope-onconnect"></a></dfn> 
      <td> <code title="event-connect">connect</code> 
   </table>
   <p>For the purposes of the application cache networking model, a shared worker
is its own cache host. The run a worker algorithm takes care of associating
the worker with an application cache.</p>
   <p class="note" role="note"> The applicationCache attribute returns the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/browsers.html#applicationcache">ApplicationCache</a></code> object for the
worker. </p>
   <h3 class="heading settled" data-level="3.2" id="event-loop"><span class="secno">3.2. </span><span class="content">The event loop</span><a class="self-link" href="#event-loop"></a></h3>
   <p>Each <code class="idl"><a data-link-type="idl" href="#workerglobalscope0" id="ref-for-workerglobalscope0-11">WorkerGlobalScope</a></code> object has a distinct event loop, separate from
those used by units of related similar-origin browsing contexts. This event
loop has no associated browsing context, and its task queues only have events,
callbacks, and networking activity as tasks. These event loops are created by
the run a worker algorithm.</p>
   <p>Each <code class="idl"><a data-link-type="idl" href="#workerglobalscope0" id="ref-for-workerglobalscope0-12">WorkerGlobalScope</a></code> object also has a <dfn data-dfn-type="dfn" data-noexport="" id="closing">closing<a class="self-link" href="#closing"></a></dfn> flag, which
must initially be false, but which can get set to true by the algorithms in the
processing model section below.</p>
   <p>Once the WorkerGlobalScope’s <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/workers.html#dom-workerglobalscope-closing">closing</a></code> flag is set to true, the event loop’s
task queues must discard any further tasks that would be added to them (tasks
already on the queue are unaffected except where otherwise specified).
Effectively, once the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/workers.html#dom-workerglobalscope-closing">closing</a></code> flag is true, timers stop firing, notifications
for all pending asynchronous operations are dropped, etc.</p>
   <h3 class="heading settled" data-level="3.3" id="worker-lifetime"><span class="secno">3.3. </span><span class="content">The worker’s lifetime</span><a class="self-link" href="#worker-lifetime"></a></h3>
   <p>Workers communicate with other workers and with browsing contexts through
message channels and their <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#messageport">MessagePort</a></code> objects.</p>
   <p>Each <code class="idl"><a data-link-type="idl" href="#workerglobalscope0" id="ref-for-workerglobalscope0-13">WorkerGlobalScope</a></code> <em>worker global scope</em> has a list of the worker’s ports,
which consists of all the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#messageport">MessagePort</a></code> objects that are entangled with
another port and that have one (but only one) port owned by worker global
scope. This list includes the implicit <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#messageport">MessagePort</a></code> in the case of dedicated
workers.</p>
   <p>Each <code class="idl"><a data-link-type="idl" href="#workerglobalscope0" id="ref-for-workerglobalscope0-14">WorkerGlobalScope</a></code> also has a list of the worker’s workers. Initially
this list is empty; it is populated when the worker creates or obtains
further workers.</p>
   <p>Finally, each <code class="idl"><a data-link-type="idl" href="#workerglobalscope0" id="ref-for-workerglobalscope0-15">WorkerGlobalScope</a></code> also has a list of the worker’s Documents.
Initially this list is empty; it is populated when the worker is created.</p>
   <p>Whenever a <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document">Document</a></code> d is added to the worker’s <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document">Document</a></code>s, the user
agent must, for each worker q in the list of the worker’s workers whose list
of the worker’s <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document">Document</a></code>s  does not contain d, add d to q’s <code class="idl"><a data-link-type="idl" href="#workerglobalscope0" id="ref-for-workerglobalscope0-16">WorkerGlobalScope</a></code> owner’s list of the worker’s Documents.</p>
   <p>Whenever a <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document">Document</a></code> object is discarded, it must be removed from the list
of the worker’s <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document">Document</a></code>s  of each worker whose list contains that
Document.</p>
   <p>Given a settings object o when creating or obtaining a worker, the list of
relevant <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document">Document</a></code> objects to add depends on the type of global object
specified by o’s. If o specifies a global object that is a WorkerGlobalScope
object (i.e. if we are creating a nested worker), then the relevant Documents
are the the worker’s <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document">Document</a></code>s  of the global object specified by o.
Otherwise, o specifies a global object that is a Window object, and the
relevant <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document">Document</a></code> is just the responsible document specified by o.</p>
   <p>A worker is said to be a permissible worker if its list of the worker’s <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document">Document</a></code>s  is not empty.</p>
   <p>A worker is said to be an active needed worker if any of the <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document">Document</a></code> objects in the worker’s <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document">Document</a></code>s are fully active.</p>
   <p>A worker is said to be a protected worker if it is an active needed worker
and either it has outstanding timers, database transactions, or network
connections, or its list of the worker’s ports is not empty, or its <code class="idl"><a data-link-type="idl" href="#workerglobalscope0" id="ref-for-workerglobalscope0-17">WorkerGlobalScope</a></code> is actually a <code class="idl"><a data-link-type="idl" href="#sharedworkerglobalscope" id="ref-for-sharedworkerglobalscope-5">SharedWorkerGlobalScope</a></code> object (i.e.
the worker is a shared worker).</p>
   <p>A worker is said to be a suspendable worker if it is not an active needed
worker but it is a permissible worker.</p>
   <h3 class="heading settled" data-level="3.4" id="processing-model"><span class="secno">3.4. </span><span class="content">Processing model</span><a class="self-link" href="#processing-model"></a></h3>
   <p>When a user agent is to run a worker for a script with URL url and a script
settings object settings object, it must run the following steps:</p>
   <ol>
    <li data-md="">
     <p>Create a separate parallel execution environment (i.e. a separate thread
or process or equivalent construct), and run the rest of these steps
asynchronously in that context.</p>
     <p>For the purposes of timing APIs, this is the official moment of creation
of the worker.</p>
    <li data-md="">
     <p>Let <em>worker global scope</em> be the global object specified by settings object.</p>
    <li data-md="">
     <p>If <em>worker global scope</em> is actually a <code class="idl"><a data-link-type="idl" href="#sharedworkerglobalscope" id="ref-for-sharedworkerglobalscope-6">SharedWorkerGlobalScope</a></code> object
(i.e. the worker is a shared worker), and there are any relevant
application caches that are identified by a manifest URL with the same
origin as url and that have url as one of their entries, not excluding
entries marked as foreign, then associate the <em>worker global scope</em> with the
most appropriate application cache of those that match.</p>
    <li data-md="">
     <p>Attempt to fetch the resource identified by url, from the origin specified
by settings object, using the responsible document specified by settings
object as the referrer source (not the specified API referrer source!),
and with the synchronous flag set and the force same-origin flag set.</p>
     <p>If the attempt fails, then for each <code class="idl"><a data-link-type="idl" href="#worker" id="ref-for-worker-9">Worker</a></code> or <code class="idl"><a data-link-type="idl" href="#sharedworker" id="ref-for-sharedworker-2">SharedWorker</a></code> object
associated with <em>worker global scope</em>, queue a task to fire a simple event
named error at that object. Abort these steps.</p>
     <p>If the attempt succeeds, then let source be the result of running the
UTF-8 decode algorithm on the script resource.</p>
     <p>Let language be JavaScript.</p>
     <p class="note" role="note"> As with script elements, the MIME type of the script is ignored. Unlike
with script elements, there is no way to override the type. It’s always
assumed to be JavaScript. </p>
    <li data-md="">
     <p>In the newly created execution environment, create a JavaScript global
environment whose global object is <em>worker global scope</em>. If worker global
scope is a <code class="idl"><a data-link-type="idl" href="#dedicatedworkerglobalscope" id="ref-for-dedicatedworkerglobalscope-6">DedicatedWorkerGlobalScope</a></code> object, then this is a dedicated
worker environment. Otherwise, <em>worker global scope</em> is a <code class="idl"><a data-link-type="idl" href="#sharedworkerglobalscope" id="ref-for-sharedworkerglobalscope-7">SharedWorkerGlobalScope</a></code> object, and this is a shared worker
environment. (In either case, by definition, it is a worker environment.)</p>
    <li data-md="">
     <p>Let script be a new script.</p>
     <p>Obtain the appropriate script execution environment for the scripting
language language from settings object.</p>
     <p>Parse/compile/initialise source using that script execution environment,
as appropriate for language, and thus obtain a code entry-point. If the
script was not compiled successfully, let the code entry-point be a no-op
script, and act as if a corresponding uncaught script error had occurred.</p>
     <p>Let script’s settings object be settings object.</p>
    <li data-md="">
     <p>Closing orphan workers: Start monitoring the worker such that no sooner
than it stops being a protected worker, and no later than it stops being a
permissible worker, <em>worker global scope</em>’s <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/workers.html#dom-workerglobalscope-closing">closing</a></code> flag is set to true.</p>
    <li data-md="">
     <p>Suspending workers: Start monitoring the worker, such that whenever worker
global scope’s <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/workers.html#dom-workerglobalscope-closing">closing</a></code> flag is false and the worker is a suspendable
worker, the user agent suspends execution of script in that worker until
such time as either the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/workers.html#dom-workerglobalscope-closing">closing</a></code> flag switches to true or the worker stops
being a suspendable worker.</p>
    <li data-md="">
     <p>Jump to the script’s code entry-point, and let that run until it either
returns, fails to catch an exception, or gets prematurely aborted by the
"kill a worker" or "terminate a worker" algorithms defined below.</p>
    <li data-md="">
     <p>If <em>worker global scope</em> is actually a <code class="idl"><a data-link-type="idl" href="#dedicatedworkerglobalscope" id="ref-for-dedicatedworkerglobalscope-7">DedicatedWorkerGlobalScope</a></code> object
 (i.e. the worker is a dedicated worker), then enable the port message
 queue of the worker’s implicit port.</p>
    <li data-md="">
     <p>Event loop: Run the responsible event loop specified by settings object
 until it is destroyed.</p>
     <p class="note" role="note"> The handling of events or the execution of callbacks by tasks run by the
 event loop might get prematurely aborted by the "kill a worker" or
 "terminate a worker" algorithms defined below. </p>
     <p>The worker processing model remains on this step until the event loop
 is destroyed, which happens after the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/workers.html#dom-workerglobalscope-closing">closing</a></code> flag is set to true, as
 described in the event loop processing model.</p>
     <p></p>
    <li data-md="">
     <p>Empty the <em>worker global scope</em>’s list of active timers.</p>
    <li data-md="">
     <p>Disentangle all the ports in the list of the worker’s ports.</p>
    <li data-md="">
     <p>Empty the worker’s list of the worker’s Documents.</p>
   </ol>
   <p>When a user agent is to kill a worker it must run the following steps in
parallel with the worker’s main loop (the "run a worker" processing model
defined above):</p>
   <ol>
    <li data-md="">
     <p>Set the worker’s <code class="idl"><a data-link-type="idl" href="#workerglobalscope0" id="ref-for-workerglobalscope0-18">WorkerGlobalScope</a></code> object’s <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/workers.html#dom-workerglobalscope-closing">closing</a></code> flag to true.</p>
    <li data-md="">
     <p>If there are any tasks queued in the <code class="idl"><a data-link-type="idl" href="#workerglobalscope0" id="ref-for-workerglobalscope0-19">WorkerGlobalScope</a></code> object’s event
loop’s task queues, discard them without processing them.</p>
    <li data-md="">
     <p>Wait a user-agent-defined amount of time.</p>
    <li data-md="">
     <p>Abort the script currently running in the worker.</p>
   </ol>
   <p>User agents may invoke the "kill a worker" processing model on a worker at
any time, e.g. in response to user requests, in response to CPU quota
management, or when a worker stops being an active needed worker if the
worker continues executing even after its <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/workers.html#dom-workerglobalscope-closing">closing</a></code> flag was set to true.</p>
   <p>When a user agent is to terminate a worker it must run the following steps in
parallel with the worker’s main loop (the "run a worker" processing model
defined above):</p>
   <ol>
    <li data-md="">
     <p>Set the worker’s <code class="idl"><a data-link-type="idl" href="#workerglobalscope0" id="ref-for-workerglobalscope0-20">WorkerGlobalScope</a></code> object’s <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/workers.html#dom-workerglobalscope-closing">closing</a></code> flag to true.</p>
    <li data-md="">
     <p>If there are any tasks queued in the <code class="idl"><a data-link-type="idl" href="#workerglobalscope0" id="ref-for-workerglobalscope0-21">WorkerGlobalScope</a></code> object’s event
loop’s task queues, discard them without processing them.</p>
    <li data-md="">
     <p>Abort the script currently running in the worker.</p>
    <li data-md="">
     <p>If the worker’s <code class="idl"><a data-link-type="idl" href="#workerglobalscope0" id="ref-for-workerglobalscope0-22">WorkerGlobalScope</a></code> object is actually a <code class="idl"><a data-link-type="idl" href="#dedicatedworkerglobalscope" id="ref-for-dedicatedworkerglobalscope-8">DedicatedWorkerGlobalScope</a></code> object (i.e. the worker is a dedicated
worker), then empty the port message queue of the port that the worker’s
implicit port is entangled with.</p>
   </ol>
   <p>The task source for the tasks mentioned above is the DOM manipulation task
source.</p>
   <h3 class="heading settled" data-level="3.5" id="runtime-script-errors"><span class="secno">3.5. </span><span class="content">Runtime script errors</span><a class="self-link" href="#runtime-script-errors"></a></h3>
   <p>Whenever an uncaught runtime script error occurs in one of the worker’s
scripts, if the error did not occur while handling a previous script error,
the user agent must report the error for that script, with the position (line
number and column number) where the error occurred, using the
WorkerGlobalScope object as the target. <a data-link-type="biblio" href="#biblio-html">[HTML]</a></p>
   <p>For shared workers, if the error is still not handled afterwards, the error
may be reported to the user. <a data-link-type="biblio" href="#biblio-html">[HTML]</a></p>
   <p>For dedicated workers, if the error is still not handled afterwards, the user
agent must queue a task to fire a trusted event that uses the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/webappapis.html#errorevent">ErrorEvent</a></code> interface, with the name error, that doesn’t bubble and is cancelable, with
its message, filename, lineno, colno, attributes initialized appropriately,
and with the error attribute initialized to null, at the <code class="idl"><a data-link-type="idl" href="#worker" id="ref-for-worker-10">Worker</a></code> object
associated with the worker. If the event is not canceled, the user agent must
act as if the uncaught runtime script error had occurred in the global scope
that the <code class="idl"><a data-link-type="idl" href="#worker" id="ref-for-worker-11">Worker</a></code> object is in, thus repeating the entire runtime script
error reporting process one level up.</p>
   <p>If the implicit port connecting the worker to its <code class="idl"><a data-link-type="idl" href="#worker" id="ref-for-worker-12">Worker</a></code> object has been
disentangled (i.e. if the parent worker has been terminated), then the user
agent must act as if the <code class="idl"><a data-link-type="idl" href="#worker" id="ref-for-worker-13">Worker</a></code> object had no <code>error</code> event
handler and as if that worker’s onerror attribute was null, but must otherwise
act as described above.</p>
   <p class="note" role="note"> Thus, error reports propagate up to the chain of dedicated workers up to the
original <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document">Document</a></code>, even if some of the workers along this chain have been
terminated and garbage collected. </p>
   <p>The task source for the task mentioned above is the DOM manipulation task
source.</p>
   <h3 class="heading settled" data-level="3.6" id="creating-workers"><span class="secno">3.6. </span><span class="content">Creating workers</span><a class="self-link" href="#creating-workers"></a></h3>
   <h4 class="heading settled" data-level="3.6.1" id="abstract-worker-interface"><span class="secno">3.6.1. </span><span class="content">The <code class="idl"><a data-link-type="idl" href="#abstractworker" id="ref-for-abstractworker-1">AbstractWorker</a></code> abstract interface</span><a class="self-link" href="#abstract-worker-interface"></a></h4>
<pre class="idl highlight def">[<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#NoInterfaceObject">NoInterfaceObject</a>, <a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed">Exposed</a>=<span class="n">Window</span>,<a class="nv idl-code" data-link-type="extended-attribute">Worker</a>]
<span class="kt">interface</span> <dfn class="nv dfn-paneled idl-code" data-dfn-type="interface" data-export="" id="abstractworker">AbstractWorker</dfn> {
           <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler">EventHandler</a> <dfn class="nv idl-code" data-dfn-for="AbstractWorker" data-dfn-type="attribute" data-export="" data-type="EventHandler" id="dom-abstractworker-onerror">onerror<a class="self-link" href="#dom-abstractworker-onerror"></a></dfn>;
};
</pre>
   <p>The following are the event handlers (and their corresponding event handler
event types) that must be supported, as event handler IDL attributes, by
objects implementing the <code class="idl"><a data-link-type="idl" href="#abstractworker" id="ref-for-abstractworker-2">AbstractWorker</a></code> interface:</p>
   <h4 class="heading settled" data-level="3.6.2" id="script-settings"><span class="secno">3.6.2. </span><span class="content">Script settings for workers</span><a class="self-link" href="#script-settings"></a></h4>
   <p>When the user agent is required to set up a worker script settings object,
given a <em>worker global scope</em> and a URL script address, it must run the
following steps:</p>
   <ol>
    <li data-md="">
     <p>Let <em>inherited responsible browsing context</em>be the responsible browsing
context specified by the incumbent settings object.</p>
    <li data-md="">
     <p>Let <em>inherited responsible document</em> be the responsible document specified
by the incumbent settings object.</p>
    <li data-md="">
     <p>Let inherited origin be the origin specified by the incumbent settings
object.</p>
    <li data-md="">
     <p>Let <em>worker event loop</em> be a newly created event loop.</p>
    <li data-md="">
     <p>Let settings object be a new script settings object whose algorithms are
defined as follows:</p>
     <dl>
      <dt data-md="">
       <p>The script execution environments</p>
      <dd data-md="">
       <p>When the script settings object is created, for each language supported by the user agent, create an appropriate execution environment as defined by the relevant specification.</p>
      <dd data-md="">
       <p>When a script execution environment is needed, return the appropriate one from those created when the script settings object was created.</p>
      <dd data-md="">
       <p class="note" role="note">Currently, workers only support JavaScript, so only a JavaScript execution environment is actually needed here.</p>
      <dt data-md="">
       <p>The global object</p>
      <dd data-md="">
       <p>Return <em>worker global scope</em>.</p>
      <dt data-md="">
       <p>The responsible browsing context</p>
      <dd data-md="">
       <p>Return <em>inherited responsible browsing context</em>.</p>
      <dt data-md="">
       <p>The responsible document</p>
      <dd data-md="">
       <p>Return <em>inherited responsible document</em>.</p>
      <dt data-md="">
       <p>The responsible event loop</p>
      <dd data-md="">
       <p>Return <em>worker event loop</em>.</p>
      <dt data-md="">
       <p>The API referrer source</p>
      <dd data-md="">
       <p>Return <em>script address</em>.</p>
      <dt data-md="">
       <p>The API URL character encoding</p>
      <dd data-md="">
       <p>Return UTF-8.</p>
      <dt data-md="">
       <p>The API base URL</p>
      <dd data-md="">
       <p>Return <em>worker URL</em>.</p>
      <dt data-md="">
       <p>The origin and effective script origin</p>
      <dd data-md="">
       <p>Return <em>inherited origin</em>.</p>
     </dl>
    <li data-md="">
     <p>Return <em>settings</em> object.</p>
   </ol>
   <h4 class="heading settled" data-level="3.6.3" id="dedicated-workers-and-worker-interface"><span class="secno">3.6.3. </span><span class="content">Dedicated workers and the <code class="idl"><a data-link-type="idl" href="#worker" id="ref-for-worker-14">Worker</a></code> interface</span><a class="self-link" href="#dedicated-workers-and-worker-interface"></a></h4>
<pre class="idl highlight def">[<dfn class="nv dfn-paneled idl-code" data-dfn-for="Worker" data-dfn-type="constructor" data-export="" data-lt="Worker(scriptURL)" id="dom-worker-worker">Constructor</dfn>(<span class="kt">DOMString</span> <dfn class="nv dfn-paneled idl-code" data-dfn-for="Worker/Worker(scriptURL)" data-dfn-type="argument" data-export="" id="dom-worker-worker-scripturl-scripturl">scriptURL</dfn>), <a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed">Exposed</a>=<span class="n">Window</span>,<a class="nv idl-code" data-link-type="extended-attribute">Worker</a>]
<span class="kt">interface</span> <dfn class="nv dfn-paneled idl-code" data-dfn-type="interface" data-export="" id="worker">Worker</dfn> : <a class="n" data-link-type="idl-name" href="https://dom.spec.whatwg.org/#eventtarget">EventTarget</a> {
  <span class="kt">void</span> <dfn class="nv dfn-paneled idl-code" data-dfn-for="Worker" data-dfn-type="method" data-export="" data-lt="terminate()" id="dom-worker-terminate">terminate</dfn>();

  <span class="kt">void</span> <dfn class="nv idl-code" data-dfn-for="Worker" data-dfn-type="method" data-export="" data-lt="postMessage(message, transfer)|postMessage(message)" id="dom-worker-postmessage">postMessage<a class="self-link" href="#dom-worker-postmessage"></a></dfn>(<span class="kt">any</span> <dfn class="nv idl-code" data-dfn-for="Worker/postMessage(message, transfer), Worker/postMessage(message)" data-dfn-type="argument" data-export="" id="dom-worker-postmessage-message-transfer-message">message<a class="self-link" href="#dom-worker-postmessage-message-transfer-message"></a></dfn>, <span class="kt">optional</span> <span class="kt">sequence</span>&lt;<a class="n" data-link-type="idl-name">Transferable</a>> <dfn class="nv idl-code" data-dfn-for="Worker/postMessage(message, transfer), Worker/postMessage(message)" data-dfn-type="argument" data-export="" id="dom-worker-postmessage-message-transfer-transfer">transfer<a class="self-link" href="#dom-worker-postmessage-message-transfer-transfer"></a></dfn>);
           <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler">EventHandler</a> <dfn class="nv idl-code" data-dfn-for="Worker" data-dfn-type="attribute" data-export="" data-type="EventHandler" id="dom-worker-onmessage">onmessage<a class="self-link" href="#dom-worker-onmessage"></a></dfn>;
};
<a class="n" data-link-type="idl-name" href="#worker" id="ref-for-worker-15">Worker</a> <span class="kt">implements</span> <a class="n" data-link-type="idl-name" href="#abstractworker" id="ref-for-abstractworker-3">AbstractWorker</a> ;
</pre>
   <p>The <code class="idl"><a data-link-type="idl" href="#dom-worker-terminate" id="ref-for-dom-worker-terminate-1">terminate()</a></code> method, when invoked, must cause the "terminate a worker"
algorithm to be run on the worker with which the object is associated.</p>
   <p>Worker objects act as if they had an implicit <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#messageport">MessagePort</a></code> associated with
them. This port is part of a channel that is set up when the worker is
created, but it is not exposed. This object must never be garbage collected
before the <code class="idl"><a data-link-type="idl" href="#worker" id="ref-for-worker-16">Worker</a></code> object.</p>
   <p>All messages received by that port must immediately be retargeted at the
Worker object.</p>
   <p>The <code class="idl"><a data-link-type="idl" href="#dom-dedicatedworkerglobalscope-postmessage" id="ref-for-dom-dedicatedworkerglobalscope-postmessage-4">postMessage()</a></code> method on <code class="idl"><a data-link-type="idl" href="#worker" id="ref-for-worker-17">Worker</a></code> objects must act as if, when
invoked, it immediately invoked the method of the same name on the port, with
the same arguments, and returned the same return value.</p>
   <p>The <code class="idl"><a data-link-type="idl" href="#dom-dedicatedworkerglobalscope-postmessage" id="ref-for-dom-dedicatedworkerglobalscope-postmessage-5">postMessage()</a></code> method’s first argument can be structured data:</p>
<pre class="lang-js example highlight" id="example-02526d2f"><a class="self-link" href="#example-02526d2f"></a>worker<span class="p">.</span>postMessage<span class="p">(</span><span class="p">{</span>opcode<span class="o">:</span> <span class="s1">'activate'</span><span class="p">,</span> device<span class="o">:</span> <span class="mi">1938</span><span class="p">,</span> parameters<span class="o">:</span> <span class="p">[</span><span class="mi">23</span><span class="p">,</span> <span class="mi">102</span><span class="p">]</span><span class="p">}</span><span class="p">)</span><span class="p">;</span>
</pre>
   <p>The following are the event handlers (and their corresponding event handler
event types) that must be supported, as event handler IDL attributes, by
objects implementing the <code class="idl"><a data-link-type="idl" href="#worker" id="ref-for-worker-18">Worker</a></code> interface:</p>
   <p>When the <code class="idl"><a data-link-type="idl" href="#dom-worker-worker" id="ref-for-dom-worker-worker-2">Worker(scriptURL)</a></code> constructor is invoked, the user agent must run
the following steps:</p>
   <ol>
    <li data-md="">
     <p>The user agent may throw a SecurityError exception and abort these steps
if the request violates a policy decision (e.g. if the user agent is
configured to not allow the page to start dedicated workers).</p>
    <li data-md="">
     <p>Resolve the scriptURL argument relative to the API base URL specified by
the entry settings object when the method was invoked.</p>
    <li data-md="">
     <p>If this fails, throw a <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#syntaxerror">SyntaxError</a></code> exception and abort these steps.</p>
    <li data-md="">
     <p>Let worker URL be the resulting absolute URL.</p>
    <li data-md="">
     <p>If the scheme component of worker URL is not "data", and the origin of
worker URL is not the same as the origin specified by the incumbent
settings object, then throw a <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#securityerror">SecurityError</a></code> exception and abort these
steps.</p>
     <p class="note" role="note"> For example, scripts can be external files with the same scheme, host,
and port as the original page, or data: URLs, or same-origin blob: URLs.
Thus, an https: page couldn’t start workers using scripts with http: URLs. <a data-link-type="biblio" href="#biblio-fileapi">[FILEAPI]</a>. </p>
    <li data-md="">
     <p>Create a new <code class="idl"><a data-link-type="idl" href="#dedicatedworkerglobalscope" id="ref-for-dedicatedworkerglobalscope-9">DedicatedWorkerGlobalScope</a></code> object. Let <em>worker global scope</em> be this new object.</p>
    <li data-md="">
     <p>Set up a worker script settings object with <em>worker global scope</em> and worker
URL, and let settings object be the result.</p>
    <li data-md="">
     <p>Create a new <code class="idl"><a data-link-type="idl" href="#worker" id="ref-for-worker-19">Worker</a></code> object, associated with <em>worker global scope</em>. Let
worker be this new object.</p>
    <li data-md="">
     <p>Create a new <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#messageport">MessagePort</a></code> object whose owner is the incumbent settings
object. Let this be the outside port.</p>
    <li data-md="">
     <p>Associate the outside port with worker.</p>
    <li data-md="">
     <p>Create a new <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#messageport">MessagePort</a></code> object whose owner is script settings. Let
 inside port be this new object.</p>
    <li data-md="">
     <p>Associate inside port with <em>worker global scope</em>.</p>
    <li data-md="">
     <p>Entangle outside port and inside port.</p>
    <li data-md="">
     <p>Return worker, and run the following steps asynchronously.</p>
    <li data-md="">
     <p>Enable outside port’s port message queue.</p>
    <li data-md="">
     <p>Let docs be the list of relevant <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document">Document</a></code> objects to add given the
 incumbent settings object.</p>
    <li data-md="">
     <p>Add to <em>worker global scope</em>’s list of the worker’s <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document">Document</a></code>s the <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document">Document</a></code> objects in docs.</p>
    <li data-md="">
     <p>If the global object specified by the incumbent settings object is a <code class="idl"><a data-link-type="idl" href="#workerglobalscope0" id="ref-for-workerglobalscope0-23">WorkerGlobalScope</a></code> object (i.e. we are creating a nested worker), add <em>worker global scope</em> to the list of the worker’s workers of the <code class="idl"><a data-link-type="idl" href="#workerglobalscope0" id="ref-for-workerglobalscope0-24">WorkerGlobalScope</a></code> object that is the global object specified by the
 incumbent settings object.</p>
    <li data-md="">
     <p>Run a worker for the script with URL worker URL and the script settings
 object settings object.</p>
   </ol>
   <h4 class="heading settled" data-level="3.6.4" id="shared-workers-and-sharedworker-interface"><span class="secno">3.6.4. </span><span class="content">Shared workers and the <code class="idl"><a data-link-type="idl" href="#sharedworker" id="ref-for-sharedworker-3">SharedWorker</a></code> interface</span><a class="self-link" href="#shared-workers-and-sharedworker-interface"></a></h4>
<pre class="idl highlight def">[<dfn class="nv dfn-paneled idl-code" data-dfn-for="SharedWorker" data-dfn-type="constructor" data-export="" data-lt="SharedWorker(scriptURL, name)|SharedWorker(scriptURL)" id="dom-sharedworker-sharedworker">Constructor</dfn>(<span class="kt">DOMString</span> <dfn class="nv idl-code" data-dfn-for="SharedWorker/SharedWorker(scriptURL, name)" data-dfn-type="argument" data-export="" id="dom-sharedworker-sharedworker-scripturl-name-scripturl">scriptURL<a class="self-link" href="#dom-sharedworker-sharedworker-scripturl-name-scripturl"></a></dfn>, <span class="kt">optional</span> <span class="kt">DOMString</span> <dfn class="nv idl-code" data-dfn-for="SharedWorker/SharedWorker(scriptURL, name)" data-dfn-type="argument" data-export="" id="dom-sharedworker-sharedworker-scripturl-name-name">name<a class="self-link" href="#dom-sharedworker-sharedworker-scripturl-name-name"></a></dfn>), <a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed">Exposed</a>=<span class="n">Window</span>,<a class="nv idl-code" data-link-type="extended-attribute">Worker</a>]
<span class="kt">interface</span> <dfn class="nv dfn-paneled idl-code" data-dfn-type="interface" data-export="" id="sharedworker">SharedWorker</dfn> : <a class="n" data-link-type="idl-name" href="https://dom.spec.whatwg.org/#eventtarget">EventTarget</a> {
  <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/comms.html#messageport">MessagePort</a> <dfn class="nv idl-code" data-dfn-for="SharedWorker" data-dfn-type="attribute" data-export="" data-readonly="" data-type="MessagePort" id="dom-sharedworker-port">port<a class="self-link" href="#dom-sharedworker-port"></a></dfn>;
};
<a class="n" data-link-type="idl-name" href="#sharedworker" id="ref-for-sharedworker-4">SharedWorker</a> <span class="kt">implements</span> <a class="n" data-link-type="idl-name" href="#abstractworker" id="ref-for-abstractworker-4">AbstractWorker</a> ;
</pre>
   <p>The port attribute must return the value it was assigned by the object’s
constructor. It represents the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#messageport">MessagePort</a></code> for communicating with the shared
worker.</p>
   <p>When the <code class="idl"><a data-link-type="idl" href="#dom-sharedworker-sharedworker" id="ref-for-dom-sharedworker-sharedworker-2">SharedWorker(scriptURL, name)</a></code> constructor is invoked, the user
agent must run the following steps:</p>
   <ol>
    <li data-md="">
     <p>The user agent may throw a SecurityError exception and abort these steps
if the request violates a policy decision (e.g. if the user agent is
configured to not allow the page to start shared workers).</p>
    <li data-md="">
     <p>Resolve the <code class="idl"><a data-link-type="idl" href="#dom-worker-worker-scripturl-scripturl" id="ref-for-dom-worker-worker-scripturl-scripturl-1">scriptURL</a></code> argument.</p>
    <li data-md="">
     <p>If this fails, throw a <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#syntaxerror">SyntaxError</a></code> exception and abort these steps.</p>
    <li data-md="">
     <p>Let scriptURL be the resulting absolute URL and parsed <code class="idl"><a data-link-type="idl" href="#dom-worker-worker-scripturl-scripturl" id="ref-for-dom-worker-worker-scripturl-scripturl-2">scriptURL</a></code> be the
resulting parsed URL.</p>
    <li data-md="">
     <p>Let name be the value of the second argument, or the empty string if the
second argument was omitted.</p>
    <li data-md="">
     <p>If the scheme component of parsed <code class="idl"><a data-link-type="idl" href="#dom-worker-worker-scripturl-scripturl" id="ref-for-dom-worker-worker-scripturl-scripturl-3">scriptURL</a></code> is not "data", and the
origin of scriptURL is not the same as the origin specified by the
incumbent settings object, then throw a <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#securityerror">SecurityError</a></code> exception and
abort these steps.</p>
     <p class="note" role="note"> Thus, scripts must either be external files with the same scheme, host,
and port as the original page, or data: URLs. For example, an https: page
couldn’t start workers using scripts with http: URLs. </p>
    <li data-md="">
     <p>Let docs be the list of relevant <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document">Document</a></code> objects to add given the
incumbent settings object.</p>
    <li data-md="">
     <p>Execute the following substeps atomically:</p>
     <ol>
      <li> Create a new <code class="idl"><a data-link-type="idl" href="#sharedworker" id="ref-for-sharedworker-5">SharedWorker</a></code> object, which will shortly be associated with
a <code class="idl"><a data-link-type="idl" href="#sharedworkerglobalscope" id="ref-for-sharedworkerglobalscope-8">SharedWorkerGlobalScope</a></code> object. Let this <code class="idl"><a data-link-type="idl" href="#sharedworker" id="ref-for-sharedworker-6">SharedWorker</a></code> object be
worker. 
      <li> Create a new <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#messageport">MessagePort</a></code> object whose owner is the incumbent settings
object. Let this be the outside port. 
      <li> Assign outside port to the port attribute of worker. 
      <li> Let <em>worker global scope</em> be null. 
      <li>
        If name is not the empty string and there exists a <code class="idl"><a data-link-type="idl" href="#sharedworkerglobalscope" id="ref-for-sharedworkerglobalscope-9">SharedWorkerGlobalScope</a></code> object whose <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/workers.html#dom-workerglobalscope-closing">closing</a></code> flag is false, whose
name attribute is exactly equal to name, and that is the global object
specified by a script settings object that specifies as its origin the same
origin as the origin of <code class="idl"><a data-link-type="idl" href="#dom-worker-worker-scripturl-scripturl" id="ref-for-dom-worker-worker-scripturl-scripturl-4">scriptURL</a></code>, then let <em>worker global scope</em> be that <code class="idl"><a data-link-type="idl" href="#sharedworkerglobalscope" id="ref-for-sharedworkerglobalscope-10">SharedWorkerGlobalScope</a></code> object. 
       <p>Otherwise, if name is the empty string and there exists a <code class="idl"><a data-link-type="idl" href="#sharedworkerglobalscope" id="ref-for-sharedworkerglobalscope-11">SharedWorkerGlobalScope</a></code> object whose <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/workers.html#dom-workerglobalscope-closing">closing</a></code> flag is false, whose
name attribute is the empty string, and whose location attribute represents
an absolute URL that is exactly equal to <code class="idl"><a data-link-type="idl" href="#dom-worker-worker-scripturl-scripturl" id="ref-for-dom-worker-worker-scripturl-scripturl-5">scriptURL</a></code>, then let worker
global scope be that <code class="idl"><a data-link-type="idl" href="#sharedworkerglobalscope" id="ref-for-sharedworkerglobalscope-12">SharedWorkerGlobalScope</a></code> object.</p>
      <li>
        If <em>worker global scope</em> is not null, but the user agent has been configured
to disallow communication between the worker represented by the worker
global scope and the scripts whose settings objects are the incumbent
settings object, then set <em>worker global scope</em> to null. 
       <p class="note" role="note"> For example, a user agent could have a development mode that isolates a
particular top-level browsing context from all other pages, and scripts in
that development mode could be blocked from connecting to shared workers
running in the normal browser mode. </p>
      <li>
        If <em>worker global scope</em> is not null, then run these steps: 
       <ol>
        <li> If <em>worker global scope</em>’s location attribute represents an absolute
URL that is not exactly equal to <code class="idl"><a data-link-type="idl" href="#dom-worker-worker-scripturl-scripturl" id="ref-for-dom-worker-worker-scripturl-scripturl-6">scriptURL</a></code>, then throw a <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#urlmismatcherror">URLMismatchError</a></code> exception and abort all these steps. 
        <li> Associate worker with <em>worker global scope</em>. 
        <li> Let settings object be the script settings object whose global object
is <em>worker global scope</em>. 
        <li> Create a new <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#messageport">MessagePort</a></code> object whose owner is settings object. Let
this be the inside port. 
        <li> Entangle outside port and inside port. 
        <li> Create a trusted event that uses the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#messageevent">MessageEvent</a></code> interface, with the
name connect, which does not bubble, is not cancelable, has no default
action, has a <code class="idl"><a data-link-type="idl">data</a></code> attribute whose value is initialized to the empty
string, has a ports attribute whose value is initialized to a read only
array containing only the newly created port, and has a source attribute
whose value is initialized to the newly created port, and queue a task to
dispatch the event at <em>worker global scope</em>. 
        <li> Add to <em>worker global scope</em>’s list of the worker’s <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document">Document</a></code>s  the <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document">Document</a></code> objects in docs. 
        <li> If the global object specified by the incumbent settings object is a <code class="idl"><a data-link-type="idl" href="#workerglobalscope0" id="ref-for-workerglobalscope0-25">WorkerGlobalScope</a></code> object, add <em>worker global scope</em> to the list of the
worker’s workers of the <code class="idl"><a data-link-type="idl" href="#workerglobalscope0" id="ref-for-workerglobalscope0-26">WorkerGlobalScope</a></code> object that is the global
object specified by the incumbent settings object. 
        <li> Return worker and abort all these steps. 
       </ol>
      <li> Create a new <code class="idl"><a data-link-type="idl" href="#sharedworkerglobalscope" id="ref-for-sharedworkerglobalscope-13">SharedWorkerGlobalScope</a></code> object. Let <em>worker global scope</em> be
this new object. 
      <li> Set up a worker script settings object with <em>worker global scope</em> and <code class="idl"><a data-link-type="idl" href="#dom-worker-worker-scripturl-scripturl" id="ref-for-dom-worker-worker-scripturl-scripturl-7">scriptURL</a></code>, and let settings object be the result. 
      <li> Associate worker with <em>worker global scope</em>. 
      <li> Set the name attribute of <em>worker global scope</em> to name. 
      <li> Create a new <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#messageport">MessagePort</a></code> object whose owner is settings object. Let
inside port be this new object. 
      <li> Entangle outside port and inside port. 
      <li data-md="">
       <p>Return worker and perform the remaining steps asynchronously.</p>
      <li data-md="">
       <p>Create a trusted event that uses the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#messageevent">MessageEvent</a></code> interface, with the
 name connect, which does not bubble, is not cancelable, has no default
 action, has a <code class="idl"><a data-link-type="idl">data</a></code> attribute whose value is initialized to the empty
 string, has a ports attribute whose value is initialized to a read only
 array containing only the newly created port, and has a source attribute
 whose value is initialized to the newly created port, and queue a task to
 dispatch the event at <em>worker global scope</em>.</p>
      <li data-md="">
       <p>Add to <em>worker global scope</em>’s list of the worker’s <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document">Document</a></code>s the <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document">Document</a></code> objects in docs.</p>
      <li data-md="">
       <p>If the global object specified by the incumbent settings object is a <code class="idl"><a data-link-type="idl" href="#workerglobalscope0" id="ref-for-workerglobalscope0-27">WorkerGlobalScope</a></code> object, add <em>worker global scope</em> to the list of the
 worker’s workers of the <code class="idl"><a data-link-type="idl" href="#workerglobalscope0" id="ref-for-workerglobalscope0-28">WorkerGlobalScope</a></code> object that is the global
 object specified by the incumbent settings object.</p>
      <li data-md="">
       <p>Run a worker for the script with URL <code class="idl"><a data-link-type="idl" href="#dom-worker-worker-scripturl-scripturl" id="ref-for-dom-worker-worker-scripturl-scripturl-8">scriptURL</a></code> and the script settings
 object settings object.</p>
     </ol>
     <p>The task source for the tasks mentioned above is the DOM manipulation task
source.</p>
     <h2 class="heading settled" data-level="4" id="apis"><span class="secno">4. </span><span class="content">APIs available to workers</span><a class="self-link" href="#apis"></a></h2>
<pre class="idl highlight def">[<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed">Exposed</a>=<span class="n">Worker</span>]
<span class="kt">partial</span> <span class="kt">interface</span> <a class="nv idl-code" data-link-type="interface" href="#workerglobalscope0" id="ref-for-workerglobalscope0-29">WorkerGlobalScope</a> {
  <span class="kt">void</span> <dfn class="nv idl-code" data-dfn-for="WorkerGlobalScope" data-dfn-type="method" data-export="" data-lt="importScripts(urls...)|importScripts()" id="dom-workerglobalscope-importscripts">importScripts<a class="self-link" href="#dom-workerglobalscope-importscripts"></a></dfn>(<span class="kt">DOMString</span>... <dfn class="nv idl-code" data-dfn-for="WorkerGlobalScope/importScripts(urls...), WorkerGlobalScope/importScripts(urls)" data-dfn-type="argument" data-export="" id="dom-workerglobalscope-importscripts-urls-urls">urls<a class="self-link" href="#dom-workerglobalscope-importscripts-urls-urls"></a></dfn>);
  <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="#workernavigator" id="ref-for-workernavigator-1">WorkerNavigator</a> <dfn class="nv idl-code" data-dfn-for="WorkerGlobalScope" data-dfn-type="attribute" data-export="" data-readonly="" data-type="WorkerNavigator" id="dom-workerglobalscope-navigator">navigator<a class="self-link" href="#dom-workerglobalscope-navigator"></a></dfn>;
};
<a class="n" data-link-type="idl-name" href="#workerglobalscope0" id="ref-for-workerglobalscope0-30">WorkerGlobalScope</a> <span class="kt">implements</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#windoworworkerglobalscope">WindowOrWorkerGlobalScope</a>;
</pre>
     <h3 class="heading settled" data-level="4.1" id="importing"><span class="secno">4.1. </span><span class="content">Importing scripts and libraries</span><a class="self-link" href="#importing"></a></h3>
     <p>When a script invokes the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/workers.html#dom-workerglobalscope-importscripts">importScripts(urls)</a></code> method on a <code class="idl"><a data-link-type="idl" href="#workerglobalscope0" id="ref-for-workerglobalscope0-31">WorkerGlobalScope</a></code> object, the user agent must run the following steps:</p>
     <ol>
      <li data-md="">
       <p>If there are no arguments, return without doing anything. Abort these steps.</p>
      <li data-md="">
       <p>Let settings object be the incumbent settings object.</p>
      <li data-md="">
       <p>Resolve each argument.</p>
      <li data-md="">
       <p>If any fail, throw a <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#syntaxerror">SyntaxError</a></code> exception and abort these steps.</p>
      <li data-md="">
       <p>Attempt to fetch each resource identified by the resulting absolute URLs,
from the origin specified by settings object, using the API referrer source
specified by settings object, and with the synchronous flag set.</p>
      <li data-md="">
       <p>For each argument in turn, in the order given, starting with the first one,
run these substeps:</p>
       <ol>
        <li>
          Wait for the fetching attempt for the corresponding resource to complete. 
         <p>If the fetching attempt failed, throw a <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#networkerror">NetworkError</a></code> exception and
abort all these steps.</p>
         <p>If the attempt succeeds, then let source be the result of running the
UTF-8 decode algorithm on the script resource.</p>
         <p>Let language be JavaScript.</p>
         <p class="note" role="note"> As with the worker’s script, the script here is always assumed to be
JavaScript, regardless of the MIME type. </p>
        <li>
          Create a script using source as the script source, the URL from which
source was obtained, language as the scripting language, and settings
object as the script settings object. 
         <p>If the script came from a resource whose URL does not have the same origin
as the origin specified by the incumbent settings object, then pass the
muted errors flag to the create a script algorithm as well.</p>
         <p>Let the newly created script run until it either returns, fails to parse,
fails to catch an exception, or gets prematurely aborted by the "kill a
worker" or "terminate a worker" algorithms defined above.</p>
         <p>If it failed to parse, then throw an ECMAScript SyntaxError exception and
abort all these steps. <a data-link-type="biblio" href="#biblio-ecma-262">[ECMA-262]</a></p>
         <p>If an exception was thrown or if the script was prematurely aborted, then
abort all these steps, letting the exception or aborting continue to be
processed by the calling script.</p>
       </ol>
     </ol>
     <p>If the "kill a worker" or "terminate a worker" algorithms abort the script
then abort all these steps.</p>
     <h3 class="heading settled" data-level="4.2" id="workernavigator-object"><span class="secno">4.2. </span><span class="content">The WorkerNavigator object</span><a class="self-link" href="#workernavigator-object"></a></h3>
     <p>The navigator attribute of the <code class="idl"><a data-link-type="idl" href="#workerglobalscope0" id="ref-for-workerglobalscope0-32">WorkerGlobalScope</a></code> interface must return an
instance of the WorkerNavigator interface, which represents the identity
and state of the user agent (the client):</p>
<pre class="idl highlight def">[<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed">Exposed</a>=<span class="n">Worker</span>]
<span class="kt">interface</span> <dfn class="nv dfn-paneled idl-code" data-dfn-type="interface" data-export="" id="workernavigator">WorkerNavigator</dfn> {};
<a class="n" data-link-type="idl-name" href="#workernavigator" id="ref-for-workernavigator-2">WorkerNavigator</a> <span class="kt">implements</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#navigatorid">NavigatorID</a>;
<a class="n" data-link-type="idl-name" href="#workernavigator" id="ref-for-workernavigator-3">WorkerNavigator</a> <span class="kt">implements</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#navigatorlanguage">NavigatorLanguage</a>;
<a class="n" data-link-type="idl-name" href="#workernavigator" id="ref-for-workernavigator-4">WorkerNavigator</a> <span class="kt">implements</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/browsers.html#navigatoronline">NavigatorOnLine</a>;
</pre>
     <h3 class="heading settled" data-level="4.3" id="worker-locations"><span class="secno">4.3. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#worker" id="ref-for-worker-20">Worker</a></code> locations</span><a class="self-link" href="#worker-locations"></a></h3>
<pre class="idl highlight def">[<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed">Exposed</a>=<span class="n">Worker</span>]
<span class="kt">interface</span> <dfn class="nv dfn-paneled idl-code" data-dfn-type="interface" data-export="" id="workerlocation">WorkerLocation</dfn> { };
<a class="n" data-link-type="idl-name" href="#workerlocation" id="ref-for-workerlocation-3">WorkerLocation</a> <span class="kt">implements</span> <a class="n" data-link-type="idl-name">URLUtilsReadOnly</a>; // FIXME: This has been pulled up
</pre>
     <p>A <code class="idl"><a data-link-type="idl" href="#workerlocation" id="ref-for-workerlocation-4">WorkerLocation</a></code> object represents an absolute URL set at its creation.</p>
     <p>The <code class="idl"><a data-link-type="idl" href="#workerlocation" id="ref-for-workerlocation-5">WorkerLocation</a></code> interface supports the <code class="idl"><a data-link-type="idl">URLUtilsReadOnly</a></code> interface. <a data-link-type="biblio" href="#biblio-url">[URL]</a></p>
     <p>When the object is created, the user agent must invoke the element’s <code class="idl"><a data-link-type="idl">URLUtilsReadOnly</a></code> interface’s set the input algorithm with the absolute URL
that the <code class="idl"><a data-link-type="idl" href="#workerlocation" id="ref-for-workerlocation-6">WorkerLocation</a></code> object represents as the given value.</p>
     <p>The element’s <code class="idl"><a data-link-type="idl">URLUtilsReadOnly</a></code> interface’s get the base algorithm must
return null.</p>
     <h3 class="heading settled" data-level="4.4" id="security-considerations"><span class="secno">4.4. </span><span class="content">Security Considerations {#security-considerations}</span><a class="self-link" href="#security-considerations"></a></h3>
     <p>There are no known security implications directly related to this standard as
of today.</p>
     <section>
      <h2 class="no-num heading settled" id="acknowledgements"><span class="content">Acknowledgements</span><a class="self-link" href="#acknowledgements"></a></h2>
       For inestimable work, and the drive to keep HTML up to date, particular
  thanks are due to Ian Hickson, and the other editors of the WHATWG:
  Anne van Kesteren, Domenic Denicola, Philip Jägenstedt, Simon Pieters. 
      <p>Thanks to Aaron Boodman, Алексей Проскуряков (Alexey Proskuryakov),
  Ben Turner, Dmitry Titov, Drew Wilson, Jeremy Orlow, Jonas Sicking,
  Justin James, Kevin Hakanson, Maciej Stachowiak, Michael Nordman,
  Mike Smith, and Philip Taylor for their useful and substantial comments.</p>
      <p>Huge thanks to the whole Gears team, who pioneered this technology and whose
  experience has been a huge influence on this specification.</p>
     </section>
   </ol>
  </main>
  <div data-fill-with="conformance">
   <h2 class="no-ref no-num heading settled" id="conformance"><span class="content">Conformance</span><a class="self-link" href="#conformance"></a></h2>
   <h3 class="no-ref no-num heading settled" id="conventions"><span class="content">Document conventions</span><a class="self-link" href="#conventions"></a></h3>
   <p>Conformance requirements are expressed with a combination of
    descriptive assertions and RFC 2119 terminology. The key words “MUST”,
    “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”,
    “RECOMMENDED”, “MAY”, and “OPTIONAL” in the normative parts of this
    document are to be interpreted as described in RFC 2119.
    However, for readability, these words do not appear in all uppercase
    letters in this specification. </p>
   <p>All of the text of this specification is normative except sections
    explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119">[RFC2119]</a></p>
   <p>Examples in this specification are introduced with the words “for example”
    or are set apart from the normative text with <code>class="example"</code>,
    like this: </p>
   <div class="example" id="example-f839f6c8">
    <a class="self-link" href="#example-f839f6c8"></a> 
    <p>This is an example of an informative example.</p>
   </div>
   <p>Informative notes begin with the word “Note” and are set apart from the
    normative text with <code>class="note"</code>, like this: </p>
   <p class="note" role="note">Note, this is an informative note.</p>
   <h3 class="no-ref no-num heading settled" id="conformant-algorithms"><span class="content">Conformant Algorithms</span><a class="self-link" href="#conformant-algorithms"></a></h3>
   <p>Requirements phrased in the imperative as part of algorithms (such as
    "strip any leading space characters" or "return false and abort these
    steps") are to be interpreted with the meaning of the key word ("must",
    "should", "may", etc) used in introducing the algorithm.</p>
   <p>Conformance requirements phrased as algorithms or specific steps can be
    implemented in any manner, so long as the end result is <dfn data-dfn-type="dfn" data-lt="processing equivalence" data-noexport="" id="dfn-processing-equivalence">equivalent<a class="self-link" href="#dfn-processing-equivalence"></a></dfn>. In
    particular, the algorithms defined in this specification are intended to
    be easy to understand and are not intended to be performant. Implementers
    are encouraged to optimize.</p>
  </div>
<script src="https://www.w3.org/scripts/TR/2016/fixup.js"></script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#abstractworker">AbstractWorker</a><span>, in §3.6.1</span>
   <li><a href="#dom-sharedworkerglobalscope-applicationcache">applicationCache</a><span>, in §3.1.3</span>
   <li><a href="#dom-workerglobalscope-close">close()</a><span>, in §3.1.1</span>
   <li><a href="#closing">closing</a><span>, in §3.2</span>
   <li><a href="#dedicatedworkerglobalscope">DedicatedWorkerGlobalScope</a><span>, in §3.1.2</span>
   <li><a href="#dom-workerglobalscope-importscripts">importScripts()</a><span>, in §4</span>
   <li><a href="#dom-workerglobalscope-importscripts">importScripts(urls...)</a><span>, in §4</span>
   <li><a href="#dom-workerglobalscope-location">location</a><span>, in §3.1.1</span>
   <li><a href="#dom-sharedworkerglobalscope-name">name</a><span>, in §3.1.3</span>
   <li><a href="#dom-workerglobalscope-navigator">navigator</a><span>, in §4</span>
   <li>
    onconnect
    <ul>
     <li><a href="#dom-sharedworkerglobalscope-onconnect">attribute for SharedWorkerGlobalScope</a><span>, in §3.1.3</span>
     <li><a href="#handler-sharedworkerglobalscope-onconnect">definition of</a><span>, in §3.1.3</span>
    </ul>
   <li>
    onerror
    <ul>
     <li><a href="#dom-workerglobalscope-onerror">attribute for WorkerGlobalScope</a><span>, in §3.1.1</span>
     <li><a href="#handler-workerglobalscope-onerror">definition of</a><span>, in §3.1.1</span>
     <li><a href="#dom-abstractworker-onerror">attribute for AbstractWorker</a><span>, in §3.6.1</span>
    </ul>
   <li>
    onlanguagechange
    <ul>
     <li><a href="#dom-workerglobalscope-onlanguagechange">attribute for WorkerGlobalScope</a><span>, in §3.1.1</span>
     <li><a href="#handler-workerglobalscope-onlanguagechange">definition of</a><span>, in §3.1.1</span>
    </ul>
   <li>
    onmessage
    <ul>
     <li><a href="#dom-dedicatedworkerglobalscope-onmessage">attribute for DedicatedWorkerGlobalScope</a><span>, in §3.1.2</span>
     <li><a href="#handler-dedicatedworkerglobalscope-onmessage">definition of</a><span>, in §3.1.2</span>
     <li><a href="#dom-worker-onmessage">attribute for Worker</a><span>, in §3.6.3</span>
    </ul>
   <li>
    onoffline
    <ul>
     <li><a href="#dom-workerglobalscope-onoffline">attribute for WorkerGlobalScope</a><span>, in §3.1.1</span>
     <li><a href="#handler-workerglobalscope-onoffline">definition of</a><span>, in §3.1.1</span>
    </ul>
   <li>
    ononline
    <ul>
     <li><a href="#dom-workerglobalscope-ononline">attribute for WorkerGlobalScope</a><span>, in §3.1.1</span>
     <li><a href="#handler-workerglobalscope-ononline">definition of</a><span>, in §3.1.1</span>
    </ul>
   <li><a href="#dom-sharedworker-port">port</a><span>, in §3.6.4</span>
   <li>
    postMessage(message)
    <ul>
     <li><a href="#dom-dedicatedworkerglobalscope-postmessage">method for DedicatedWorkerGlobalScope</a><span>, in §3.1.2</span>
     <li><a href="#dom-worker-postmessage">method for Worker</a><span>, in §3.6.3</span>
    </ul>
   <li>
    postMessage(message, transfer)
    <ul>
     <li><a href="#dom-dedicatedworkerglobalscope-postmessage">method for DedicatedWorkerGlobalScope</a><span>, in §3.1.2</span>
     <li><a href="#dom-worker-postmessage">method for Worker</a><span>, in §3.6.3</span>
    </ul>
   <li><a href="#dfn-processing-equivalence">processing equivalence</a><span>, in §Unnumbered section</span>
   <li><a href="#dom-workerglobalscope-self">self</a><span>, in §3.1.1</span>
   <li><a href="#sharedworker">SharedWorker</a><span>, in §3.6.4</span>
   <li><a href="#sharedworkerglobalscope">SharedWorkerGlobalScope</a><span>, in §3.1.3</span>
   <li><a href="#dom-sharedworker-sharedworker">SharedWorker(scriptURL)</a><span>, in §3.6.4</span>
   <li><a href="#dom-sharedworker-sharedworker">SharedWorker(scriptURL, name)</a><span>, in §3.6.4</span>
   <li><a href="#dom-worker-terminate">terminate()</a><span>, in §3.6.3</span>
   <li><a href="#worker">Worker</a><span>, in §3.6.3</span>
   <li><a href="#workerglobalscope0">WorkerGlobalScope</a><span>, in §3.1.1</span>
   <li><a href="#workerlocation">WorkerLocation</a><span>, in §4.3</span>
   <li><a href="#workernavigator">WorkerNavigator</a><span>, in §4.2</span>
   <li><a href="#dom-worker-worker">Worker(scriptURL)</a><span>, in §3.6.3</span>
  </ul>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[DOM]</a> defines the following terms:
    <ul>
     <li><a href="https://dom.spec.whatwg.org/#document">Document</a>
     <li><a href="https://dom.spec.whatwg.org/#eventtarget">EventTarget</a>
     <li><a href="https://dom.spec.whatwg.org/#dom-eventtarget-addeventlistener">addEventListener(type, callback)</a>
    </ul>
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><a href="https://html.spec.whatwg.org/multipage/browsers.html#applicationcache">ApplicationCache</a>
     <li><a href="https://html.spec.whatwg.org/multipage/webappapis.html#errorevent">ErrorEvent</a>
     <li><a href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler">EventHandler</a>
     <li><a href="https://html.spec.whatwg.org/multipage/comms.html#messageevent">MessageEvent</a>
     <li><a href="https://html.spec.whatwg.org/multipage/comms.html#messageport">MessagePort</a>
     <li><a href="https://html.spec.whatwg.org/multipage/webappapis.html#navigatorid">NavigatorID</a>
     <li><a href="https://html.spec.whatwg.org/multipage/webappapis.html#navigatorlanguage">NavigatorLanguage</a>
     <li><a href="https://html.spec.whatwg.org/multipage/browsers.html#navigatoronline">NavigatorOnLine</a>
     <li><a href="https://html.spec.whatwg.org/multipage/webappapis.html#onerroreventhandler">OnErrorEventHandler</a>
     <li><a href="https://html.spec.whatwg.org/multipage/webappapis.html#windoworworkerglobalscope">WindowOrWorkerGlobalScope</a>
     <li><a href="https://html.spec.whatwg.org/multipage/workers.html#dom-workerglobalscope-closing">closing</a>
     <li><a href="https://html.spec.whatwg.org/multipage/workers.html#dom-workerglobalscope-importscripts">importScripts(urls)</a>
     <li><a href="https://html.spec.whatwg.org/multipage/comms.html#dom-messageport-start">start()</a>
    </ul>
   <li>
    <a data-link-type="biblio">[WebIDL-1]</a> defines the following terms:
    <ul>
     <li><a href="https://heycam.github.io/webidl/#idl-ArrayBuffer">ArrayBuffer</a>
     <li><a href="https://heycam.github.io/webidl/#Exposed">Exposed</a>
     <li><a href="https://heycam.github.io/webidl/#Global">Global</a>
     <li><a href="https://heycam.github.io/webidl/#networkerror">NetworkError</a>
     <li><a href="https://heycam.github.io/webidl/#NoInterfaceObject">NoInterfaceObject</a>
     <li><a href="https://heycam.github.io/webidl/#securityerror">SecurityError</a>
     <li><a href="https://heycam.github.io/webidl/#syntaxerror">SyntaxError</a>
     <li><a href="https://heycam.github.io/webidl/#urlmismatcherror">URLMismatchError</a>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-dom">[DOM]
   <dd>Anne van Kesteren. <a href="https://dom.spec.whatwg.org/">DOM Standard</a>. Living Standard. URL: <a href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org/</a>
   <dt id="biblio-html">[HTML]
   <dd>Ian Hickson. <a href="https://html.spec.whatwg.org/multipage/">HTML Standard</a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>. March 1997. Best Current Practice. URL: <a href="https://tools.ietf.org/html/rfc2119">https://tools.ietf.org/html/rfc2119</a>
   <dt id="biblio-webidl-1">[WebIDL-1]
   <dd>Cameron McCormack; Boris Zbarsky. <a href="https://heycam.github.io/webidl/">WebIDL Level 1</a>. 15 September 2016. PR. URL: <a href="https://heycam.github.io/webidl/">https://heycam.github.io/webidl/</a>
  </dl>
  <h3 class="no-num no-ref heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-ecma-262">[ECMA-262]
   <dd><a href="https://tc39.github.io/ecma262/">ECMAScript Language Specification</a>. URL: <a href="https://tc39.github.io/ecma262/">https://tc39.github.io/ecma262/</a>
   <dt id="biblio-fileapi">[FILEAPI]
   <dd>Arun Ranganathan; Jonas Sicking. <a href="https://w3c.github.io/FileAPI/">File API</a>. 21 April 2015. WD. URL: <a href="https://w3c.github.io/FileAPI/">https://w3c.github.io/FileAPI/</a>
   <dt id="biblio-url">[URL]
   <dd>Anne van Kesteren. <a href="https://url.spec.whatwg.org/">URL Standard</a>. Living Standard. URL: <a href="https://url.spec.whatwg.org/">https://url.spec.whatwg.org/</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="idl-index"><span class="content">IDL Index</span><a class="self-link" href="#idl-index"></a></h2>
<pre class="idl def">[<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed">Exposed</a>=<span class="n">Worker</span>]
<span class="kt">interface</span> <a class="nv" href="#workerglobalscope0">WorkerGlobalScope</a> : <a class="n" data-link-type="idl-name" href="https://dom.spec.whatwg.org/#eventtarget">EventTarget</a> {
  <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="#workerglobalscope0">WorkerGlobalScope</a> <a class="nv" data-readonly="" data-type="WorkerGlobalScope" href="#dom-workerglobalscope-self">self</a>;
  <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="#workerlocation">WorkerLocation</a> <a class="nv" data-readonly="" data-type="WorkerLocation" href="#dom-workerglobalscope-location">location</a>;

  <span class="kt">void</span> <a class="nv" href="#dom-workerglobalscope-close">close</a>();
           <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#onerroreventhandler">OnErrorEventHandler</a> <a class="nv" data-type="OnErrorEventHandler" href="#dom-workerglobalscope-onerror">onerror</a>;
           <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler">EventHandler</a> <a class="nv" data-type="EventHandler" href="#dom-workerglobalscope-onlanguagechange">onlanguagechange</a>;
           <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler">EventHandler</a> <a class="nv" data-type="EventHandler" href="#dom-workerglobalscope-onoffline">onoffline</a>;
           <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler">EventHandler</a> <a class="nv" data-type="EventHandler" href="#dom-workerglobalscope-ononline">ononline</a>;
};

[<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Global">Global</a>=<a class="n" data-link-type="idl-name" href="#worker">Worker</a>,<a class="nv idl-code" data-link-type="extended-attribute">DedicatedWorker</a>]
/*sealed*/ <span class="kt">interface</span> <a class="nv" href="#dedicatedworkerglobalscope">DedicatedWorkerGlobalScope</a> : <a class="n" data-link-type="idl-name" href="#workerglobalscope0">WorkerGlobalScope</a> {
  <span class="kt">void</span> <a class="nv" href="#dom-dedicatedworkerglobalscope-postmessage">postMessage</a>(<span class="kt">any</span> <a class="nv" href="#dom-dedicatedworkerglobalscope-postmessage-message-transfer-message">message</a>, <span class="kt">optional</span> <span class="kt">sequence</span>&lt;<a class="n" data-link-type="idl-name">Transferable</a>> <a class="nv" href="#dom-dedicatedworkerglobalscope-postmessage-message-transfer-transfer">transfer</a>);
           <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler">EventHandler</a> <a class="nv" data-type="EventHandler" href="#dom-dedicatedworkerglobalscope-onmessage">onmessage</a>;
};

[<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Global">Global</a>=<a class="n" data-link-type="idl-name" href="#worker">Worker</a>,<a class="nv idl-code" data-link-type="extended-attribute">SharedWorker</a>]
/*sealed*/ <span class="kt">interface</span> <a class="nv" href="#sharedworkerglobalscope">SharedWorkerGlobalScope</a> : <a class="n" data-link-type="idl-name" href="#workerglobalscope0">WorkerGlobalScope</a> {
  <span class="kt">readonly</span> <span class="kt">attribute</span> <span class="kt">DOMString</span> <a class="nv" data-readonly="" data-type="DOMString" href="#dom-sharedworkerglobalscope-name">name</a>;
  <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/browsers.html#applicationcache">ApplicationCache</a> <a class="nv" data-readonly="" data-type="ApplicationCache" href="#dom-sharedworkerglobalscope-applicationcache">applicationCache</a>;
           <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler">EventHandler</a> <a class="nv" data-type="EventHandler" href="#dom-sharedworkerglobalscope-onconnect">onconnect</a>;
};

[<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#NoInterfaceObject">NoInterfaceObject</a>, <a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed">Exposed</a>=<span class="n">Window</span>,<a class="nv idl-code" data-link-type="extended-attribute">Worker</a>]
<span class="kt">interface</span> <a class="nv" href="#abstractworker">AbstractWorker</a> {
           <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler">EventHandler</a> <a class="nv" data-type="EventHandler" href="#dom-abstractworker-onerror">onerror</a>;
};

[<a class="nv" href="#dom-worker-worker">Constructor</a>(<span class="kt">DOMString</span> <a class="nv" href="#dom-worker-worker-scripturl-scripturl">scriptURL</a>), <a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed">Exposed</a>=<span class="n">Window</span>,<a class="nv idl-code" data-link-type="extended-attribute">Worker</a>]
<span class="kt">interface</span> <a class="nv" href="#worker">Worker</a> : <a class="n" data-link-type="idl-name" href="https://dom.spec.whatwg.org/#eventtarget">EventTarget</a> {
  <span class="kt">void</span> <a class="nv" href="#dom-worker-terminate">terminate</a>();

  <span class="kt">void</span> <a class="nv" href="#dom-worker-postmessage">postMessage</a>(<span class="kt">any</span> <a class="nv" href="#dom-worker-postmessage-message-transfer-message">message</a>, <span class="kt">optional</span> <span class="kt">sequence</span>&lt;<a class="n" data-link-type="idl-name">Transferable</a>> <a class="nv" href="#dom-worker-postmessage-message-transfer-transfer">transfer</a>);
           <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler">EventHandler</a> <a class="nv" data-type="EventHandler" href="#dom-worker-onmessage">onmessage</a>;
};
<a class="n" data-link-type="idl-name" href="#worker">Worker</a> <span class="kt">implements</span> <a class="n" data-link-type="idl-name" href="#abstractworker">AbstractWorker</a> ;

[<a class="nv" href="#dom-sharedworker-sharedworker">Constructor</a>(<span class="kt">DOMString</span> <a class="nv" href="#dom-sharedworker-sharedworker-scripturl-name-scripturl">scriptURL</a>, <span class="kt">optional</span> <span class="kt">DOMString</span> <a class="nv" href="#dom-sharedworker-sharedworker-scripturl-name-name">name</a>), <a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed">Exposed</a>=<span class="n">Window</span>,<a class="nv idl-code" data-link-type="extended-attribute">Worker</a>]
<span class="kt">interface</span> <a class="nv" href="#sharedworker">SharedWorker</a> : <a class="n" data-link-type="idl-name" href="https://dom.spec.whatwg.org/#eventtarget">EventTarget</a> {
  <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/comms.html#messageport">MessagePort</a> <a class="nv" data-readonly="" data-type="MessagePort" href="#dom-sharedworker-port">port</a>;
};
<a class="n" data-link-type="idl-name" href="#sharedworker">SharedWorker</a> <span class="kt">implements</span> <a class="n" data-link-type="idl-name" href="#abstractworker">AbstractWorker</a> ;

[<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed">Exposed</a>=<span class="n">Worker</span>]
<span class="kt">partial</span> <span class="kt">interface</span> <a class="nv idl-code" data-link-type="interface" href="#workerglobalscope0">WorkerGlobalScope</a> {
  <span class="kt">void</span> <a class="nv" href="#dom-workerglobalscope-importscripts">importScripts</a>(<span class="kt">DOMString</span>... <a class="nv" href="#dom-workerglobalscope-importscripts-urls-urls">urls</a>);
  <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="#workernavigator">WorkerNavigator</a> <a class="nv" data-readonly="" data-type="WorkerNavigator" href="#dom-workerglobalscope-navigator">navigator</a>;
};
<a class="n" data-link-type="idl-name" href="#workerglobalscope0">WorkerGlobalScope</a> <span class="kt">implements</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#windoworworkerglobalscope">WindowOrWorkerGlobalScope</a>;

[<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed">Exposed</a>=<span class="n">Worker</span>]
<span class="kt">interface</span> <a class="nv" href="#workernavigator">WorkerNavigator</a> {};
<a class="n" data-link-type="idl-name" href="#workernavigator">WorkerNavigator</a> <span class="kt">implements</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#navigatorid">NavigatorID</a>;
<a class="n" data-link-type="idl-name" href="#workernavigator">WorkerNavigator</a> <span class="kt">implements</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#navigatorlanguage">NavigatorLanguage</a>;
<a class="n" data-link-type="idl-name" href="#workernavigator">WorkerNavigator</a> <span class="kt">implements</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/browsers.html#navigatoronline">NavigatorOnLine</a>;

[<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed">Exposed</a>=<span class="n">Worker</span>]
<span class="kt">interface</span> <a class="nv" href="#workerlocation">WorkerLocation</a> { };
<a class="n" data-link-type="idl-name" href="#workerlocation">WorkerLocation</a> <span class="kt">implements</span> <a class="n" data-link-type="idl-name">URLUtilsReadOnly</a>; // FIXME: This has been pulled up

</pre>
  <aside class="dfn-panel" data-for="workerglobalscope0">
   <b><a href="#workerglobalscope0">#workerglobalscope0</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-workerglobalscope0-1">3.1.1. The WorkerGlobalScope common interface</a> <a href="#ref-for-workerglobalscope0-2">(2)</a> <a href="#ref-for-workerglobalscope0-3">(3)</a> <a href="#ref-for-workerglobalscope0-4">(4)</a> <a href="#ref-for-workerglobalscope0-5">(5)</a> <a href="#ref-for-workerglobalscope0-6">(6)</a> <a href="#ref-for-workerglobalscope0-7">(7)</a> <a href="#ref-for-workerglobalscope0-8">(8)</a>
    <li><a href="#ref-for-workerglobalscope0-9">3.1.2. Dedicated workers and the DedicatedWorkerGlobalScope interface</a>
    <li><a href="#ref-for-workerglobalscope0-10">3.1.3. Shared workers and the SharedWorkerGlobalScope interface</a>
    <li><a href="#ref-for-workerglobalscope0-11">3.2. The event loop</a> <a href="#ref-for-workerglobalscope0-12">(2)</a>
    <li><a href="#ref-for-workerglobalscope0-13">3.3. The worker’s lifetime</a> <a href="#ref-for-workerglobalscope0-14">(2)</a> <a href="#ref-for-workerglobalscope0-15">(3)</a> <a href="#ref-for-workerglobalscope0-16">(4)</a> <a href="#ref-for-workerglobalscope0-17">(5)</a>
    <li><a href="#ref-for-workerglobalscope0-18">3.4. Processing model</a> <a href="#ref-for-workerglobalscope0-19">(2)</a> <a href="#ref-for-workerglobalscope0-20">(3)</a> <a href="#ref-for-workerglobalscope0-21">(4)</a> <a href="#ref-for-workerglobalscope0-22">(5)</a>
    <li><a href="#ref-for-workerglobalscope0-23">3.6.3. Dedicated workers and the Worker interface</a> <a href="#ref-for-workerglobalscope0-24">(2)</a>
    <li><a href="#ref-for-workerglobalscope0-25">3.6.4. Shared workers and the SharedWorker interface</a> <a href="#ref-for-workerglobalscope0-26">(2)</a> <a href="#ref-for-workerglobalscope0-27">(3)</a> <a href="#ref-for-workerglobalscope0-28">(4)</a>
    <li><a href="#ref-for-workerglobalscope0-29">4. APIs available to workers</a> <a href="#ref-for-workerglobalscope0-30">(2)</a>
    <li><a href="#ref-for-workerglobalscope0-31">4.1. Importing scripts and libraries</a>
    <li><a href="#ref-for-workerglobalscope0-32">4.2. The WorkerNavigator object</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-workerglobalscope-self">
   <b><a href="#dom-workerglobalscope-self">#dom-workerglobalscope-self</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-workerglobalscope-self-1">3.1.1. The WorkerGlobalScope common interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-workerglobalscope-location">
   <b><a href="#dom-workerglobalscope-location">#dom-workerglobalscope-location</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-workerglobalscope-location-1">3.1.1. The WorkerGlobalScope common interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-workerglobalscope-close">
   <b><a href="#dom-workerglobalscope-close">#dom-workerglobalscope-close</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-workerglobalscope-close-1">3.1.1. The WorkerGlobalScope common interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dedicatedworkerglobalscope">
   <b><a href="#dedicatedworkerglobalscope">#dedicatedworkerglobalscope</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dedicatedworkerglobalscope-1">3.1.2. Dedicated workers and the DedicatedWorkerGlobalScope interface</a> <a href="#ref-for-dedicatedworkerglobalscope-2">(2)</a> <a href="#ref-for-dedicatedworkerglobalscope-3">(3)</a> <a href="#ref-for-dedicatedworkerglobalscope-4">(4)</a> <a href="#ref-for-dedicatedworkerglobalscope-5">(5)</a>
    <li><a href="#ref-for-dedicatedworkerglobalscope-6">3.4. Processing model</a> <a href="#ref-for-dedicatedworkerglobalscope-7">(2)</a> <a href="#ref-for-dedicatedworkerglobalscope-8">(3)</a>
    <li><a href="#ref-for-dedicatedworkerglobalscope-9">3.6.3. Dedicated workers and the Worker interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-dedicatedworkerglobalscope-postmessage">
   <b><a href="#dom-dedicatedworkerglobalscope-postmessage">#dom-dedicatedworkerglobalscope-postmessage</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-dedicatedworkerglobalscope-postmessage-1">1.2.1. A background number-crunching worker</a>
    <li><a href="#ref-for-dom-dedicatedworkerglobalscope-postmessage-2">1.3.2. Communicating with a dedicated worker</a>
    <li><a href="#ref-for-dom-dedicatedworkerglobalscope-postmessage-3">3.1.2. Dedicated workers and the DedicatedWorkerGlobalScope interface</a>
    <li><a href="#ref-for-dom-dedicatedworkerglobalscope-postmessage-4">3.6.3. Dedicated workers and the Worker interface</a> <a href="#ref-for-dom-dedicatedworkerglobalscope-postmessage-5">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-dedicatedworkerglobalscope-onmessage">
   <b><a href="#dom-dedicatedworkerglobalscope-onmessage">#dom-dedicatedworkerglobalscope-onmessage</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-dedicatedworkerglobalscope-onmessage-1">1.2.1. A background number-crunching worker</a>
    <li><a href="#ref-for-dom-dedicatedworkerglobalscope-onmessage-2">1.3.2. Communicating with a dedicated worker</a> <a href="#ref-for-dom-dedicatedworkerglobalscope-onmessage-3">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="sharedworkerglobalscope">
   <b><a href="#sharedworkerglobalscope">#sharedworkerglobalscope</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-sharedworkerglobalscope-1">3.1.3. Shared workers and the SharedWorkerGlobalScope interface</a> <a href="#ref-for-sharedworkerglobalscope-2">(2)</a> <a href="#ref-for-sharedworkerglobalscope-3">(3)</a> <a href="#ref-for-sharedworkerglobalscope-4">(4)</a>
    <li><a href="#ref-for-sharedworkerglobalscope-5">3.3. The worker’s lifetime</a>
    <li><a href="#ref-for-sharedworkerglobalscope-6">3.4. Processing model</a> <a href="#ref-for-sharedworkerglobalscope-7">(2)</a>
    <li><a href="#ref-for-sharedworkerglobalscope-8">3.6.4. Shared workers and the SharedWorker interface</a> <a href="#ref-for-sharedworkerglobalscope-9">(2)</a> <a href="#ref-for-sharedworkerglobalscope-10">(3)</a> <a href="#ref-for-sharedworkerglobalscope-11">(4)</a> <a href="#ref-for-sharedworkerglobalscope-12">(5)</a> <a href="#ref-for-sharedworkerglobalscope-13">(6)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-sharedworkerglobalscope-onconnect">
   <b><a href="#dom-sharedworkerglobalscope-onconnect">#dom-sharedworkerglobalscope-onconnect</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-sharedworkerglobalscope-onconnect-1">1.2.4. Shared state using a shared worker</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="abstractworker">
   <b><a href="#abstractworker">#abstractworker</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-abstractworker-1">3.6.1. The AbstractWorker  abstract interface</a> <a href="#ref-for-abstractworker-2">(2)</a>
    <li><a href="#ref-for-abstractworker-3">3.6.3. Dedicated workers and the Worker interface</a>
    <li><a href="#ref-for-abstractworker-4">3.6.4. Shared workers and the SharedWorker interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-worker-worker">
   <b><a href="#dom-worker-worker">#dom-worker-worker</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-worker-worker-1">1.3.1. Creating a dedicated worker</a>
    <li><a href="#ref-for-dom-worker-worker-2">3.6.3. Dedicated workers and the Worker interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-worker-worker-scripturl-scripturl">
   <b><a href="#dom-worker-worker-scripturl-scripturl">#dom-worker-worker-scripturl-scripturl</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-worker-worker-scripturl-scripturl-1">3.6.4. Shared workers and the SharedWorker interface</a> <a href="#ref-for-dom-worker-worker-scripturl-scripturl-2">(2)</a> <a href="#ref-for-dom-worker-worker-scripturl-scripturl-3">(3)</a> <a href="#ref-for-dom-worker-worker-scripturl-scripturl-4">(4)</a> <a href="#ref-for-dom-worker-worker-scripturl-scripturl-5">(5)</a> <a href="#ref-for-dom-worker-worker-scripturl-scripturl-6">(6)</a> <a href="#ref-for-dom-worker-worker-scripturl-scripturl-7">(7)</a> <a href="#ref-for-dom-worker-worker-scripturl-scripturl-8">(8)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="worker">
   <b><a href="#worker">#worker</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-worker-1">1.1. Scope</a>
    <li><a href="#ref-for-worker-2">1.2.1. A background number-crunching worker</a> <a href="#ref-for-worker-3">(2)</a>
    <li><a href="#ref-for-worker-4">1.2.2. Worker used for background I/O</a>
    <li><a href="#ref-for-worker-5">1.3.2. Communicating with a dedicated worker</a> <a href="#ref-for-worker-6">(2)</a>
    <li><a href="#ref-for-worker-7">3.1.2. Dedicated workers and the DedicatedWorkerGlobalScope interface</a>
    <li><a href="#ref-for-worker-8">3.1.3. Shared workers and the SharedWorkerGlobalScope interface</a>
    <li><a href="#ref-for-worker-9">3.4. Processing model</a>
    <li><a href="#ref-for-worker-10">3.5. Runtime script errors</a> <a href="#ref-for-worker-11">(2)</a> <a href="#ref-for-worker-12">(3)</a> <a href="#ref-for-worker-13">(4)</a>
    <li><a href="#ref-for-worker-14">3.6.3. Dedicated workers and the Worker interface</a> <a href="#ref-for-worker-15">(2)</a> <a href="#ref-for-worker-16">(3)</a> <a href="#ref-for-worker-17">(4)</a> <a href="#ref-for-worker-18">(5)</a> <a href="#ref-for-worker-19">(6)</a>
    <li><a href="#ref-for-worker-20">4.3. Worker locations</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-worker-terminate">
   <b><a href="#dom-worker-terminate">#dom-worker-terminate</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-worker-terminate-1">3.6.3. Dedicated workers and the Worker interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-sharedworker-sharedworker">
   <b><a href="#dom-sharedworker-sharedworker">#dom-sharedworker-sharedworker</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-sharedworker-sharedworker-1">1.3.3. Shared workers</a>
    <li><a href="#ref-for-dom-sharedworker-sharedworker-2">3.6.4. Shared workers and the SharedWorker interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="sharedworker">
   <b><a href="#sharedworker">#sharedworker</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-sharedworker-1">3.1.3. Shared workers and the SharedWorkerGlobalScope interface</a>
    <li><a href="#ref-for-sharedworker-2">3.4. Processing model</a>
    <li><a href="#ref-for-sharedworker-3">3.6.4. Shared workers and the SharedWorker interface</a> <a href="#ref-for-sharedworker-4">(2)</a> <a href="#ref-for-sharedworker-5">(3)</a> <a href="#ref-for-sharedworker-6">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="workernavigator">
   <b><a href="#workernavigator">#workernavigator</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-workernavigator-1">4. APIs available to workers</a>
    <li><a href="#ref-for-workernavigator-2">4.2. The WorkerNavigator object</a> <a href="#ref-for-workernavigator-3">(2)</a> <a href="#ref-for-workernavigator-4">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="workerlocation">
   <b><a href="#workerlocation">#workerlocation</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-workerlocation-1">3.1.1. The WorkerGlobalScope common interface</a> <a href="#ref-for-workerlocation-2">(2)</a>
    <li><a href="#ref-for-workerlocation-3">4.3. Worker locations</a> <a href="#ref-for-workerlocation-4">(2)</a> <a href="#ref-for-workerlocation-5">(3)</a> <a href="#ref-for-workerlocation-6">(4)</a>
   </ul>
  </aside>
<script>/* script-dfn-panel */

        document.body.addEventListener("click", function(e) {
            var queryAll = function(sel) { return [].slice.call(document.querySelectorAll(sel)); }
            // Find the dfn element or panel, if any, that was clicked on.
            var el = e.target;
            var target;
            var hitALink = false;
            while(el.parentElement) {
                if(el.tagName == "A") {
                    // Clicking on a link in a <dfn> shouldn't summon the panel
                    hitALink = true;
                }
                if(el.classList.contains("dfn-paneled")) {
                    target = "dfn";
                    break;
                }
                if(el.classList.contains("dfn-panel")) {
                    target = "dfn-panel";
                    break;
                }
                el = el.parentElement;
            }
            if(target != "dfn-panel") {
                // Turn off any currently "on" or "activated" panels.
                queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(function(el){
                    el.classList.remove("on");
                    el.classList.remove("activated");
                });
            }
            if(target == "dfn" && !hitALink) {
                // open the panel
                var dfnPanel = document.querySelector(".dfn-panel[data-for='" + el.id + "']");
                if(dfnPanel) {
                    console.log(dfnPanel);
                    dfnPanel.classList.add("on");
                    var rect = el.getBoundingClientRect();
                    dfnPanel.style.left = window.scrollX + rect.right + 5 + "px";
                    dfnPanel.style.top = window.scrollY + rect.top + "px";
                    var panelRect = dfnPanel.getBoundingClientRect();
                    var panelWidth = panelRect.right - panelRect.left;
                    if(panelRect.right > document.body.scrollWidth && (rect.left - (panelWidth + 5)) > 0) {
                        // Reposition, because the panel is overflowing
                        dfnPanel.style.left = window.scrollX + rect.left - (panelWidth + 5) + "px";
                    }
                } else {
                    console.log("Couldn't find .dfn-panel[data-for='" + el.id + "']");
                }
            } else if(target == "dfn-panel") {
                // Switch it to "activated" state, which pins it.
                el.classList.add("activated");
                el.style.left = null;
                el.style.top = null;
            }

        });
        </script>